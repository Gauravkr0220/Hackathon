DPSW-Sketch: A Differentially Private Sketch Framework for
Frequency Estimation over Sliding Windows
Yiping Wang
East China Normal University
Shanghai, China
yipwang@stu.ecnu.edu.cnYanhao Wangâˆ—
East China Normal University
Shanghai, China
yhwang@dase.ecnu.edu.cnCen Chenâ€ 
East China Normal University
Shanghai, China
cenchen@dase.ecnu.edu.cn
ABSTRACT
The sliding window model of computation captures scenarios in
which data are continually arriving in the form of a stream, and
only the most recent ğ‘¤items are used for analysis. In this setting, an
algorithm needs to accurately track some desired statistics over the
sliding window using a small space. When data streams contain sen-
sitive information about individuals, the algorithm is also urgently
needed to provide a provable guarantee of privacy. In this paper, we
focus on the two fundamental problems of privately (1) estimating
the frequency of an arbitrary item and (2) identifying the most
frequent items (i.e., heavy hitters ), in the sliding window model.
We propose DPSW-Sketch, a sliding window framework based
on the count-min sketch that not only satisfies differential privacy
over the stream but also approximates the results for frequency
and heavy-hitter queries within bounded errors in sublinear time
and space w.r.t. ğ‘¤. Extensive experiments on five real-world and
synthetic datasets show that DPSW-Sketch provides significantly
better utility-privacy trade-offs than state-of-the-art methods.
CCS CONCEPTS
â€¢Theory of computation â†’Sketching and sampling.
KEYWORDS
Sliding window, Differential privacy, Frequency estimation, Heavy
hitters, Count-min sketch
ACM Reference Format:
Yiping Wang, Yanhao Wang, and Cen Chen. 2024. DPSW-Sketch: A Differ-
entially Private Sketch Framework for Frequency Estimation over Sliding
Windows. In Proceedings of the 30th ACM SIGKDD Conference on Knowledge
Discovery and Data Mining (KDD â€™24), August 25â€“29, 2024, Barcelona, Spain.
ACM, New York, NY, USA, 12 pages. https://doi.org/10.1145/3637528.3671694
1 INTRODUCTION
Many real-world applications, including Internet of Things (IoT),
location-based services, and public health surveillance, generate
âˆ—Corresponding author.
â€ Cen Chen is also affiliated with The State Key Laboratory of Blockchain and Data
Security, Zhejiang University, Hangzhou, China.
Permission to make digital or hard copies of all or part of this work for personal or
classroom use is granted without fee provided that copies are not made or distributed
for profit or commercial advantage and that copies bear this notice and the full citation
on the first page. Copyrights for components of this work owned by others than the
author(s) must be honored. Abstracting with credit is permitted. To copy otherwise, or
republish, to post on servers or to redistribute to lists, requires prior specific permission
and/or a fee. Request permissions from permissions@acm.org.
KDD â€™24, August 25â€“29, 2024, Barcelona, Spain
Â©2024 Copyright held by the owner/author(s). Publication rights licensed to ACM.
ACM ISBN 979-8-4007-0490-1/24/08
https://doi.org/10.1145/3637528.3671694large volumes of time-evolving data. These data are typically col-
lected continuously in the form of streams. Therefore, the design
and analysis of streaming algorithms [ 32], which primarily aim to
provide accurate estimations over the stream in real time using a
small space, has attracted much attention in the literature.
As data streams often contain sensitive information about in-
dividuals, such as browsing history, GPS coordinates, and health
status, releasing the estimates computed on them without adequate
protection can cause harmful privacy leakage. To address this is-
sue, differential privacy [ 15] (DP), the de facto standard for privacy
preservation, has been widely adopted in streaming analytics [ 9,16].
Informally, a randomized algorithm provides (event-level) DP if
the output distribution of the algorithm is approximately the same
when executed on a stream and any of its neighbors that differ from
it by one item. This condition prevents an attacker with access to
the output from inferring the existence of any individual item.
Furthermore, in practice, it is often essential to restrict the com-
putation to recent data. For example, Appleâ€™s DP team claims to
retain the collected data for a maximum of three months [ 38], and
Googleâ€™s privacy policy states that browser data can be stored for
up to nine months [ 22]. Such recency requirements are captured
by the sliding window model [ 6,13], where only the latest ğ‘¤items
in the stream are used for computation. In such scenarios, an algo-
rithm should maintain and release real-time statistics continuously
over the sliding window with differential privacy. Especially, we
focus on two fundamental data statistics with numerous applica-
tions, including anomaly detection [ 43], change detection [ 24], and
autocomplete suggestions [ 44], namely, frequency, i.e., the number
of occurrences of any given item, and heavy hitters, i.e., the set of
items that appear at least a given number of times.
For frequency estimation and heavy-hitter detection problems,
sketches, which are compact probabilistic data structures to sum-
marize streams [ 11], have been widely employed for their high ac-
curacy and efficiency. However, despite several attempts to extend
the sketches to work in the sliding window model while guaran-
teeing differential privacy [ 5,8,38], these approaches have two
main limitations that make them incapable of meeting the need
for real-time stream analysis. First, their theoretical analyses are
specific to heavy hitters and cannot provide any error bound for fre-
quency estimation on the remaining items. Second, even for heavy
hitters, these methods still fail to obtain accurate query results
within reasonable privacy budgets and sketch sizes in practice.
Our Contributions. In this work, we propose a novel sketch frame-
work with event-level differential privacy, called DPSW-Sketch ,
for frequency estimation in the sliding window model. Specifically,
DPSW-Sketch divides the stream into disjoint substreams of equal
length. Within each substream, it creates a series of checkpoints
3255
KDD â€™24, August 25â€“29, 2024, Barcelona, Spain Yiping Wang, Yanhao Wang, and Cen Chen
according to the idea of smooth histograms [6]. Then, it constructs a
Private Count-Min Sketch [ 42] (PCMS) for each checkpoint, which
corresponds to all items either from the beginning of the substream
to the checkpoint or from the checkpoint to the end of the sub-
stream. As such, it does not need to store any item after the item
is processed, and it can maintain each PCMS incrementally with-
out handling implicit item deletion over the sliding window. Fur-
thermore, we design an efficient scheme to allocate the privacy
budget across different PCMSs in each substream such that DPSW-
Sketch provides(ğœ€,ğ›¿)-differential privacy for any given ğœ€>0
andğ›¿âˆˆ(0,1)throughout the stream, owing to the reduction from
zero-Concentrated Differential Privacy (zCDP) [ 7] to DP and the
adaptive composition of zCDP. For any frequency or heavy-hitter
query on the sliding window ğ‘Šğ‘¡at any timeğ‘¡, it selects one PCMS
per substream so that the concatenation of their corresponding
items is closest to ğ‘Šğ‘¡and combines the item frequencies obtained
from all selected PCMSs to compute the result. Our theoretical anal-
ysis shows that DPSW-Sketch can estimate the frequency of an
arbitrary item in ğ‘Šğ‘¡within a bounded additive error. This approxi-
mation can be naturally extended to the problem of heavy-hitter
identification. Meanwhile, DPSW-Sketch has sublinear time and
space complexities w.r.t. the window size ğ‘¤. Finally, extensive exper-
imental findings on five real-world and synthetic datasets confirm
the superior performance of DPSW-Sketch compared to several
state-of-the-art differentially private sliding-window sketches for
frequency and heavy-hitter queries. In summary, the main contri-
butions of this paper include:
â€¢We present the DPSW-Sketch framework and thoroughly
analyze its approximation guarantees for frequency and
heavy-hitter queries as well as time and space complexi-
ties. In particular, we indicate that DPSW-Sketch achieves
improved theoretical results over existing methods [ 5,8,38]
with lower error bounds and/or complexities.
â€¢We demonstrate that DPSW-Sketch provides much more
accurate results for frequency and heavy-hitter queries using
a smaller space than the sketches proposed in [ 5,8,38] under
the same privacy budget.
Reproducibility. Our code and data are publicly available at https:
//github.com/wypsz/DP-Sliding-Window.
2 RELATED WORK
Sketching techniques [ 11] have attracted long-standing attention
in the literature. As for frequency estimation and heavy-hitter de-
tection problems, classic sketching methods include Count-Min
Sketch (CMS) [ 12], CountSketch [ 10], CU sketch [ 18], Misra-Gries
(MG) sketch [ 31], etc. On the basis of these sketches, numerous non-
private frameworks were proposed for frequency and heavy-hitter
queries over sliding windows, e.g., [ 2,3,23,34,36,40]. Unfortu-
nately, the above frameworks do not provide any privacy guarantee
and can potentially leak sensitive user data.
Differentially private sketches for frequency and heavy-hitter
queries were proposed in [ 1,19,26,28â€“30,33,41,42]. These sketches
can provide provable guarantees of both privacy and accuracy while
not reducing efficiency. However, they cannot handle implicit dele-
tions of items and thus cannot work in the sliding window model.
Among the existing literature, the works most related to ours are[5,8,38], which proposed sketching methods for heavy-hitter iden-
tification with event-level differential privacy in the sliding win-
dow model. Chan et al . [8] first proposed a differentially private
algorithm based on MG sketches for heavy-hitter identification in
the (distributed) sliding window model. Upadhyay [38] designed a
sliding-window framework to privately identify heavy hitters and
estimate their frequencies based on CountSketch and CMS. Blocki
et al. [5] proposed an improved method for private heavy-hitter
queries by combining MG sketches with hierarchical counters. Com-
pared to [ 5,8,38], our work achieves better theoretical results by (1)
providing approximations for the frequencies of all items, instead
of only those of heavy hitters, and (2) reducing the error bound
for heavy hitters and complexity (see Section 4.2 for a detailed
comparison). Our proposed method also demonstrates substantial
improvements in practical performance compared to the methods
proposed in [5, 8, 38], as will be shown in Section 5.
Differentially private sketches for other stream statistics, such as
quantiles [ 4,21,27,35], moments [ 17,39], and cardinality [ 20,25,
37], have also received significant attention. The sketches employed
in the above problems differ from those in frequency estimation
and thus are not comparable to our framework in this paper.
3 PRELIMINARIES
For a positive integer ğ‘›, we use[ğ‘›]to denote[1,...,ğ‘›]. A data
stream is an (ordered) sequence of ğ‘›itemsğ‘†=[ğ‘ 1,ğ‘ 2,...,ğ‘ ğ‘›], where
ğ‘ ğ‘–is theğ‘–-th item and is drawn from a domain Eof sizeğ‘šindexed
by[ğ‘š]. Then,ğ‘†ğ‘¡=[ğ‘ 1,...,ğ‘ ğ‘¡]denotes the prefix of ğ‘†until the
arrival ofğ‘ ğ‘¡at any time ğ‘¡â‰¤ğ‘›. Acount-based sliding window ğ‘Šğ‘¡of
lengthğ‘¤âˆˆZ+at timeğ‘¡is the union of the latest ğ‘¤items inğ‘†ğ‘¡, i.e.,
ğ‘Šğ‘¡={ğ‘ ğ‘–âˆˆğ‘†ğ‘¡:max(ğ‘¡âˆ’ğ‘¤+1,1)â‰¤ğ‘–â‰¤ğ‘¡}. Note that our framework
can be applied to other types of sliding windows, e.g., time-based
sliding windows that contain all the items in the last ğ‘¤time units.
For ease of presentation, we focus on count-based sliding windows
in this work. We consider two fundamental statistics over sliding
windows: frequency andheavy hitter. Specifically, the frequency
ğ‘“ğ‘’,ğ‘¡of an itemğ‘’âˆˆEinğ‘Šğ‘¡is the number of occurrences of ğ‘’inğ‘Šğ‘¡,
i.e.,ğ‘“ğ‘’,ğ‘¡=|{ğ‘ ğ‘–âˆˆğ‘Šğ‘¡:ğ‘ ğ‘–=ğ‘’}|. Items with high frequencies are often
called heavy hitters. Given a threshold ğ›¾âˆˆ(0,1), an item is a ğ›¾-
heavy hitter in ğ‘Šğ‘¡if its frequency in ğ‘Šğ‘¡is at leastğ›¾ğ‘¤. Formally, the
set ofğ›¾-heavy hitters in ğ‘Šğ‘¡is defined asHğ›¾,ğ‘¡={ğ‘’âˆˆE:ğ‘“ğ‘’,ğ‘¡â‰¥ğ›¾ğ‘¤}.
Smooth Histogram. The smooth histogram [ 6] is a sublinear
data structure to transform an insert-only streaming algorithm
to work in the sliding window model, based on the concept of
smooth functions. Let ğ´,ğµ, andğ¶be the substreams of ğ‘†such
thatğµis a suffix of ğ´andğ¶is adjacent to ğ´andğµ. A nonnegative
functionğ‘”defined on any substream of ğ‘†is(ğ›¼1,ğ›¼2)-smooth if
(1âˆ’ğ›¼2)ğ‘”(ğ´)â‰¤ğ‘”(ğµ)implies(1âˆ’ğ›¼1)ğ‘”(ğ´âˆªğ¶)â‰¤ğ‘”(ğµâˆªğ¶)for two
parameters 0<ğ›¼2â‰¤ğ›¼1<1and any above-defined ğ´,ğµ, andğ¶.
Our analysis in Section 4 will use the following theorem on the
approximation and complexity of the smooth histogram.
Theorem 3.1. Given an(ğ›¼1,ğ›¼2)-smooth function ğ‘”for two pa-
rameters 0<ğ›¼2â‰¤ğ›¼1<1, suppose that there is an insert-only
streaming algorithm Athat produces a ğ›¾-approximation of ğ‘”us-
ing spaceSand update timeT. Then, there exists a sliding-window
algorithm that outputs a (ğ›¾+ğ›¼1)-approximation of ğ‘”using space
ğ‘‚(logğ‘¤
ğ›¼2(S+ logğ‘¤))and update time ğ‘‚(1
ğ›¼2Tlogğ‘¤).
3256DPSW-Sketch: A Differentially Private Sketch Framework for Frequency Estimation over Sliding Windows KDD â€™24, August 25â€“29, 2024, Barcelona, Spain
Privacy Definition. In this work, we adopt the definition of event-
level differential privacy [15,16], where a server receives the stream
ğ‘†and builds a data structure to answer specific queries on ğ‘†subject
to the constraint that any single event in ğ‘†is indistinguishable
from query results. Formally, two streams ğ‘†=[ğ‘ 1,...,ğ‘ ğ‘›]and
ğ‘†â€²=[ğ‘ â€²
1,...,ğ‘ â€²ğ‘›]areneighboring if they differ only in the ğ‘–-th item,
i.e.,ğ‘ ğ‘–â‰ ğ‘ â€²
ğ‘–for someğ‘–âˆˆ[ğ‘›]andğ‘ ğ‘—=ğ‘ â€²
ğ‘—,âˆ€ğ‘—â‰ ğ‘–. For any parameters
ğœ€>0andğ›¿âˆˆ(0,1), a randomized mechanism Mprovides event-
level(ğœ€,ğ›¿)-differential privacy, or (ğœ€,ğ›¿)-DP for short, if for any two
neighboring streams ğ‘†,ğ‘†â€²and all sets of outputs ğ‘‚âŠ†Range(M) ,
Pr[M(ğ‘†) âˆˆğ‘‚] â‰¤ exp(ğœ€)Â·Pr[M(ğ‘†â€²) âˆˆğ‘‚]+ğ›¿. The notion of
(ğœ€,ğ›¿)-DP guarantees that the outputs of Monğ‘†andğ‘†â€²are almost
indistinguishable, as quantified by ğœ€andğ›¿: the closer they are to 0,
the lower the distinguishability and the higher the protection level,
and vice versa.
For simplicity of privacy analysis, we also consider an alter-
native notion of(ğœ€,ğ›¿)-DP, namely ğœŒ-zero-concentrated differen-
tial privacy ( ğœŒ-zCDP) [ 7]. Specifically, a mechanism Msatisfies
ğœŒ-zCDP if for any two neighboring streams ğ‘†,ğ‘†â€²and allğ›¼âˆˆ(1,âˆ),
ğ·ğ›¼(M(ğ‘†)âˆ¥M(ğ‘†â€²))â‰¤ğœŒğ›¼, whereğ·ğ›¼(Â·âˆ¥Â·) is theğ›¼-RÃ©nyi divergence
of two distributions. The definition of ğœŒ-zCDP satisfies several key
characteristics of differential privacy for analysis: (1) adaptive com-
position : ifMandMâ€²satisfyğœŒ-zCDP andğœŒâ€²-zCDP, their composite
mechanismMâ€²â€²(ğ‘†)=(M(ğ‘†),Mâ€²(ğ‘†))will satisfy(ğœŒ+ğœŒâ€²)-zCDP;
(2)parallel composition : for ağœŒ-zCDP mechanism Mthat operates
on disjoint substreams ğ‘†(1),...,ğ‘†(ğ‘™)ofğ‘†such thatğ‘†(1)âˆªÂ·Â·Â·âˆªğ‘†(ğ‘™)=
ğ‘†, the union of the outputs of M(ğ‘†(1)),...,M(ğ‘†(ğ‘™))will satisfy
ğœŒ-zCDP; (3) post-processing immunity : for ağœŒ-zCDP mechanism
Mand any function ğ‘”taking the output of Mas input, a new
mechanismMâ€²(ğ‘†)=ğ‘”(M(ğ‘†))satisfiesğœŒ-zCDP. The relationship
betweenğœŒ-zCDP and(ğœ€,ğ›¿)-DP is given below.
Theorem 3.2 (zCDP â‡’DP). IfMprovidesğœŒ-zCDP,Mwill also
provide(ğœŒ+2âˆšï¸
ğœŒln(1/ğ›¿),ğ›¿)-DP for any ğ›¿âˆˆ(0,1).
A prototypical example of a mechanism satisfying ğœŒ-zCDP is
the Gaussian mechanism [ 14]. It perturbs a real-valued result by
injecting Gaussian noise, the scale of which depends on the ğ‘™2-
sensitivity of the result. A function ğ‘”:Nğ‘šâ†¦â†’Rğ‘‘hasğ‘™2-sensitivity
Î”2if for all neighboring ğ‘†,ğ‘†â€²,âˆ¥ğ‘”(ğ‘†)âˆ’ğ‘”(ğ‘†â€²)âˆ¥2â‰¤Î”2. For a function
ğ‘”:Nğ‘šâ†¦â†’Rğ‘‘withğ‘™2-sensitivity Î”2, the Gaussian mechanism
is defined asMğº(ğ‘†)=ğ‘”(ğ‘†)+N( 0,ğœ2Â·Iğ‘‘), whereN(0,ğœ2Â·Iğ‘‘)
is ağ‘‘-dimensional Gaussian random variable with mean zero and
covariance matrix ğœ2Â·Iğ‘‘andIğ‘‘is the identity matrix. For any ğœŒ>0,
the Gaussian mechanism with ğœ2=Î”2
2/(2ğœŒ)satisfiesğœŒ-zCDP [7].
(Private) Count-Min Sketch. The Count-Min Sketch (CMS) [ 12]
is a common data structure for frequency estimation. It consists
of a two-dimensional array of counters, denoted as C[ğ‘,ğ‘], where
each counter is initialized to 0, and a set of ğ‘independent hash
functionsâ„1,...,â„ğ‘, each of which maps the items in Euniformly
to[ğ‘]. Upon receiving an item ğ‘ ğ‘–, it increments ğ‘counters by 1, one
per each row, based on the hash values of ğ‘ ğ‘–, i.e.,C[ğ‘Ÿ,â„ğ‘Ÿ(ğ‘ ğ‘–)]â†
C[ğ‘Ÿ,â„ğ‘Ÿ(ğ‘ ğ‘–)]+1for eachğ‘Ÿâˆˆ[ğ‘]. After processing all ğ‘›items inğ‘†, to
obtain the frequency of ğ‘’âˆˆE, a CMS computes the hash value â„ğ‘Ÿ(ğ‘’)
for eachğ‘Ÿâˆˆ[ğ‘], retrieves the corresponding counter C[ğ‘Ÿ,â„ğ‘Ÿ(ğ‘’)],
and takes the minimum value, i.e., Ëœğ‘“ğ‘’=minğ‘Ÿâˆˆ[ğ‘]C[ğ‘Ÿ,â„ğ‘Ÿ(ğ‘’)]. The-
oretically, when ğ‘=ğ‘‚(log1
ğœ‚)andğ‘=ğ‘‚(1
ğœ)for the parametersAlgorithm 1 Private Count-Min Sketch [42]
Input: Streamğ‘†, sketching parameters ğœ,ğœ‚âˆˆ(0,1), private budget ğœŒ>0
1:âŠ²PCMS construction âŠ³
2:Initialize an array bCof sizeğ‘Ã—ğ‘, whereğ‘=ğ‘‚ log1
ğœ‚andğ‘=ğ‘‚(1
ğœ),
with random variables drawn independently from N(0,ğ‘
ğœŒ)
3:forğ‘–=1toğ‘›do
4: forğ‘Ÿ=1toğ‘do
5: bC[ğ‘Ÿ,â„ğ‘Ÿ(ğ‘ ğ‘–)]â†bC[ğ‘Ÿ,â„ğ‘Ÿ(ğ‘ ğ‘–)]+ 1
6:r
eturn bC
7:âŠ²Frequency query on item ğ‘’âˆˆE using PCMS âŠ³
8:forğ‘Ÿ=1toğ‘do
9: Computeâ„ğ‘Ÿ(ğ‘’)and
obtain bC[ğ‘Ÿ,â„ğ‘Ÿ(ğ‘’)]
10:return bğ‘“ğ‘’=minğ‘Ÿâˆˆ[ğ‘]bC[ğ‘Ÿ,â„ğ‘Ÿ(ğ‘’)]
ğœ
,ğœ‚âˆˆ (0,1), a CMS uses ğ‘‚(1
ğœlog1
ğœ‚)space, takes ğ‘‚(log1
ğœ‚)time
to process each update and frequency query, and guarantees that
0â‰¤Ëœğ‘“ğ‘’âˆ’ğ‘“ğ‘’â‰¤ğœğ‘›with probability at least 1âˆ’ğœ‚.
A CMS can be modified to be differentially private [ 42] based on
the notion of ğœŒ-zCDP [ 7] and the Gaussian mechanism [ 14]. The
private CMS (PCMS) follows the same structure and procedures
for the construction and frequency queries as the original CMS,
as presented in Algorithm 1. In the construction process, the only
difference is that the PCMS initializes each counter with a random
variable drawn from the Gaussian distribution N(0,ğœ2). Since the
ğ‘™2-sensitivity of the counters in a CMS is Î”2=âˆš
2ğ‘, as each item
leads to at most 2ğ‘changes in the counters, the variance of the
Gaussian noise added to each counter is ğœ2=ğ‘/ğœŒto ensureğœŒ-zCDP.
According to [ 42], with the same ğ‘=ğ‘‚(log1
ğœ‚)andğ‘=ğ‘‚(1
ğœ), the
computational and space efficiencies of the PCMS remain the same
as the original CMS. The PCMS has higher errors in frequency
estimation than the original CMS due to Gaussian noise, as given
in the following theorem.
Theorem 3.3. [cf. [ 42, Theorem 3.1]] The estimated frequency bğ‘“ğ‘’
of eachğ‘’âˆˆEreturned by a PCMS bCsatisfies|bğ‘“ğ‘’âˆ’ğ‘“ğ‘’|â‰¤ğœğ‘›+ğœ‰, where
ğœ‰=âˆšï¸ƒ
2
ğœŒlog2
ğœ‚Â·âˆšï¸ƒ
log 4
ğœ
ğœ‚log2
ğœ‚,
with probability at least 1âˆ’ğœ‚.
Problem Formulation. We aim to maintain the frequency of any
item inEand the set of ğ›¾-heavy hitters at any time over a size-
ğ‘¤sliding window with (ğœ€,ğ›¿)-DP. Due to the randomized nature
of sketches and DP mechanisms, providing exact results for both
queries is infeasible in our setting. Therefore, we consider building
a (sublinear) data structure (i.e., sketch ) to provide approximate
results for frequency and heavy-hitter queries, as defined below.
Definition 3.4 ((ğœ‰,ğœ‚)-Approximate Frequency). Given anyğœ‰>0
andğœ‚âˆˆ(0,1), ifPr[|bğ‘“ğ‘’,ğ‘¡âˆ’ğ‘“ğ‘’,ğ‘¡|â‰¤ğœ‰]â‰¥1âˆ’ğœ‚, we call bğ‘“ğ‘’,ğ‘¡a(ğœ‰,ğœ‚)-
approximation for the frequency ğ‘“ğ‘’,ğ‘¡of an itemğ‘’âˆˆEinğ‘Šğ‘¡.
Definition 3.5 ((ğœ‰,ğœ‚)-Approximate ğ›¾-Heavy Hitters [ 5,12]).Given
anyğœ‰>0andğœ‚âˆˆ(0,1), a set bHğ›¾,ğ‘¡âŠ†E is a(ğœ‰,ğœ‚)-approximation
for the setHğ›¾,ğ‘¡ofğ›¾-heavy hitters in ğ‘Šğ‘¡if for each item ğ‘’âˆˆEwith
ğ‘“ğ‘’,ğ‘¡â‰¥ğ›¾ğ‘¤+ğœ‰, we haveğ‘’âˆˆbHğ›¾,ğ‘¡with probability at least 1âˆ’ğœ‚, and
for each item ğ‘’âˆˆE withğ‘“ğ‘’,ğ‘¡<ğ›¾ğ‘¤
2âˆ’ğœ‰, we haveğ‘’âˆ‰bHğ›¾,ğ‘¡with
probability at least 1âˆ’ğœ‚.
Before discussing technical details, we summarize the frequently
used notations in Table 1.
3257KDD â€™24, August 25â€“29, 2024, Barcelona, Spain Yiping Wang, Yanhao Wang, and Cen Chen
Table 1: List of Frequently Used Notations
Symbol Definition
ğ‘†;ğ‘› Data stream; size of the stream, i.e., ğ‘›=|ğ‘†|
E;ğ‘š Domain of items; domain size, i.e., ğ‘š=|E|
ğ‘†ğ‘¡ Prefix ofğ‘†until the arrival of ğ‘ ğ‘¡at timeğ‘¡
ğ‘Šğ‘¡;ğ‘¤ Sliding window at time ğ‘¡; window size
ğ‘“ğ‘’,ğ‘¡ Frequency of item ğ‘’âˆˆE inğ‘Šğ‘¡
Hğ›¾,ğ‘¡ Set ofğ›¾-heavy hitters in ğ‘Šğ‘¡for a threshold ğ›¾âˆˆ(0,1)
ğœ€,ğ›¿ Privacy parameters in DP
ğœŒ Privacy parameters in zCDP
ğœ,ğœ‚ Error and confidence parameters in CMS and PCMS
bğ‘“ğ‘’,ğ‘¡;bHğ›¾,ğ‘¡ Approximations of ğ‘“ğ‘’,ğ‘¡andHğ›¾,ğ‘¡with DP
ğœ‰ Error parameter in the approximations of ğ‘“ğ‘’,ğ‘¡andHğ›¾,ğ‘¡
C;bC (Non-private) CMS; PCMS
Figure 1: Overview of the DPSW-Sketch framework.
4 THE DPSW-SKETCH FRAMEWORK
In this section, we propose the DPSW-Sketch framework to pri-
vately maintain the two approximate sliding-window statistics in
Definitions 3.4 and 3.5. We first describe how DPSW-Sketch is
built and used for query processing in Section 4.1. Next, we analyze
its privacy guarantee, utility bound, and complexity in Section 4.2.
4.1 Algorithm Description
We illustrate the structure of the DPSW-Sketch framework in
Figure 1. Generally, DPSW-Sketch partitions the prefix ğ‘†ğ‘¡of the
streamğ‘†at any time ğ‘¡into non-overlapping substreams ğ‘†(1),...,
ğ‘†(ğ‘™)of equal length. Then, based on the idea of smooth histogram
[6], we establish two lists of checkpoints in each substream and
build a PCMS w.r.t. each checkpoint. For one list (in yellow), a PCMS
is built from the beginning of the substream to each checkpoint. For
the other list (in blue), a PCMS is constructed from each checkpoint
to the end of the substream. To reduce space usage, we only keep
PCMSs built in substreams that overlap with ğ‘Šğ‘¡, as expired items
are irrelevant to queries on ğ‘Šğ‘¡. Finally, to process any query, we
combine the results obtained from one PCMS per substream (in
green), so that the concatenation of the items on which they are
built is closest to ğ‘Šğ‘¡.
Sketch Construction. The detailed procedure to construct DPSW-
Sketch over the sliding window is presented in Algorithm 2. Gen-
erally, DPSW-Sketch uses two factors ğ›¼,ğ›½âˆˆ(0,1)to determine its
structure:ğ›¼controls the number of checkpoints in each substream
andğ›½specifies the size of each substream as âŒˆğ‘¤ğ›½âŒ‰. The first step
in the construction process is to pre-specify a list ğ¼of indices of
checkpoints fromâŒˆğ‘¤ğ›½âŒ‰to1following the maintenance procedure
ofsmooth histogram with the smooth factor ğ›½[6]. The resultant list
ğ¼has two properties: (1) ğ¼contains as few checkpoints as possible
(|ğ¼|=ğ‘‚(logğ‘¤
ğ›¼)according to [ 6]); and (2) it guarantees that for anyAlgorithm 2 DPSW-Sketch Construction
Input: Streamğ‘†, window size ğ‘¤âˆˆZ+, privacy budget ğœŒ>0, framework
factorsğ›¼,ğ›½âˆˆ(0,1), sketching parameters ğœ,ğœ‚âˆˆ(0,1)
Output: DPSW-Sketch bCğ‘¡at timeğ‘¡
1:Initializeğ¼,ğ¼â€²â†âˆ… andğ‘™â†0
2:âŠ²Pre-specify the indices of checkpoints in each substream âŠ³
3:forğ‘–=âŒˆğ‘¤ğ›½âŒ‰to1do
4: Append a new index ğ‘–to the end of ğ¼
5: forğ‘—=1to|ğ¼|âˆ’2do
6: Find the largest ğ‘˜>ğ‘—such thatğ¼[ğ‘˜]â‰¥( 1âˆ’ğ›¼)Â·ğ¼[ğ‘—]
7: Delete all indices between ğ‘—andğ‘˜(exclusive) from ğ¼and renum-
ber the remaining indices accordingly
8:forğ‘—=1to|ğ¼|do
9: App
end an indexâŒˆğ‘¤ğ›½âŒ‰âˆ’ğ¼[ğ‘—]+1asğ¼â€²[ğ‘—]
10:âŠ²Sketch update w.r.t. an item ğ‘ ğ‘¡âˆˆğ‘† âŠ³
11:forğ‘¡=1toğ‘›do
12: ifğ‘¡=1or|ğ‘†(ğ‘™)|
â‰¥âŒˆğ‘¤ğ›½âŒ‰then
13:ğ‘™â†ğ‘™+1and start a new substream ğ‘†(ğ‘™)
14: Build a PCMS bC(ğ‘™)
1withğœ,ğœ‚, andğœŒ1=ğœŒ(2ğ›¼âˆ’ğ›¼2)betweenğ‘¡
andğ‘£(ğ‘™)
1=ğ‘¡+âŒˆğ‘¤ğ›½âŒ‰âˆ’1
15: forğ‘—=2to|ğ¼|do
16: Build a PCMS bC(ğ‘™)
ğ‘—withğœ,ğœ‚andğœŒğ‘—=ğœŒğ›¼ğ‘—âˆ’2(1âˆ’ğ›¼)3/2
betweenğ‘¡andğ‘£(ğ‘™)
ğ‘—=ğ‘¡+ğ¼[ğ‘—]âˆ’1
17: Build a PCMS bCâ€²(ğ‘™)
ğ‘—withğœ,ğœ‚andğœŒğ‘—=ğœŒğ›¼ğ‘—âˆ’2(1âˆ’ğ›¼)3/2
betweenğ‘¢(ğ‘™)
ğ‘—=ğ‘¡+ğ¼â€²[ğ‘—]andğ‘¡+âŒˆğ‘¤ğ›½âŒ‰âˆ’1
18: forğ‘—=1to|ğ¼|do
19: ifğ‘£(ğ‘™)
ğ‘—â‰¥ğ‘¡thenbC(ğ‘™)
ğ‘—.add(ğ‘ ğ‘¡)
20: ifğ‘—>1andğ‘¢(ğ‘™)
ğ‘—â‰¤ğ‘¡thenbCâ€²
(ğ‘™)
ğ‘—.add(ğ‘ ğ‘¡)
21: Find the smallest ğ‘™â€²<ğ‘™withğ‘†(ğ‘™â€²)âˆ©ğ‘Šğ‘¡â‰ âˆ…and delete all PCMSs
built onğ‘†(ğ‘™â€²âˆ’1)and previous substreams
22: Use
the union of PCMSs on ğ‘†(ğ‘™â€²),...,ğ‘†(ğ‘™)asbCğ‘¡at timeğ‘¡
two neighboring checkpoints ğ¼[ğ‘˜],ğ¼[ğ‘˜âˆ’1](ğ‘˜=2,...,|ğ¼|),ğ¼[ğ‘˜]
must be either at least (1âˆ’ğ›¼)Â·ğ¼[ğ‘˜âˆ’1]orğ¼[ğ‘˜âˆ’1]âˆ’1. Then, we
reverse each index in ğ¼to obtain the other set ğ¼â€²of indices. As such,
we use each checkpoint in ğ¼orğ¼â€²to indicate the end point of a
PCMS that starts from the beginning of a substream or the start
point of a PCMS that finishes at the end of a substream, respectively,
both relative to the beginning of the substream.
After obtaining ğ¼andğ¼â€², the algorithm proceeds to maintain the
sketch framework when receiving a new item ğ‘ ğ‘¡in the stream ğ‘†at
timeğ‘¡(ğ‘¡=1,...,ğ‘› ). When the first item is received or the current
substream is full, we start a new substream ğ‘†(ğ‘™), initialize two sets
bC(ğ‘™),bCâ€²(ğ‘™)of PCMSs within ğ‘†(ğ‘™)according to ğ¼andğ¼â€², and allocate
the private budget ğœŒamong the PCMSs. Since the first indices in ğ¼
andğ¼â€²both correspond to the entire substream, we build only one
PCMS for them. Additionally, we allocate higher privacy budgets to
PCMSs maintained on more items to reduce total estimation errors.
Subsequently, the framework is updated by adding the current item
ğ‘ ğ‘¡to all PCMSs in bC(ğ‘™)andbCâ€²(ğ‘™)whose corresponding ranges
containğ‘ ğ‘¡, each following Lines 4â€“5 of Algorithm 1. Finally, we
check whether there is any obsolete substream, where all items
come before the beginning of ğ‘Šğ‘¡and are irrelevant to the statistics
onğ‘Šğ‘¡and in the future, and remove all PCMSs within them from
the framework. After that, the union of all PCMSs in substreams
that overlap with ğ‘Šğ‘¡serves as the sketch bCğ‘¡at timeğ‘¡.
3258DPSW-Sketch: A Differentially Private Sketch Framework for Frequency Estimation over Sliding Windows KDD â€™24, August 25â€“29, 2024, Barcelona, Spain
Algorithm 3 DPSW-Sketch Query Processing
Input: DPSW-Sketch bCğ‘¡at timeğ‘¡, window size ğ‘¤âˆˆZ+, itemğ‘’âˆˆE (for
frequency query) or threshold ğ›¾âˆˆ(0,1)(for heavy-hitter query)
Output: (Approximate) frequency bğ‘“ğ‘’,ğ‘¡or set bHğ›¾,ğ‘¡ofğ›¾-heavy hitters
1:âŠ²Frequency query on item ğ‘’âˆˆE using DPSW-Sketch âŠ³
2:ğ‘¥â†arg max1â‰¤ğ‘—â‰¤|ğ¼|ğ‘¢(ğ‘™â€²)
ğ‘—â‰¤max(ğ‘¡âˆ’ğ‘¤+1,1)
3:ğ‘¦â†arg max1â‰¤ğ‘—â‰¤|ğ¼|ğ‘£(ğ‘™)
ğ‘—â‰¤ğ‘¡
4:bğ‘“(ğ‘™â€²)
ğ‘’â†bCâ€²(ğ‘™)
ğ‘¥.query(ğ‘’)andbğ‘“(ğ‘™)
ğ‘’â†bC(ğ‘™)
ğ‘¦.query(ğ‘’)
5:forğ‘˜=ğ‘™â€²+1toğ‘™âˆ’1do
6:bğ‘“(ğ‘˜)
ğ‘’â†bC(ğ‘˜)
1.query(ğ‘’)
7:return bğ‘“ğ‘’,ğ‘¡â†Ãğ‘™
ğ‘˜=ğ‘™â€²bğ‘“(ğ‘˜)
ğ‘’
8:âŠ²Heavy-hitter query using DPSW-Sketch âŠ³
9:Initialize bHğ›¾,ğ‘¡â†âˆ…
10:for allğ‘’âˆˆEdo
11: Compute bğ‘“ğ‘’,ğ‘¡as Lines 2â€“7
12: ifbğ‘“ğ‘’,ğ‘¡â‰¥(ğ›¾âˆ’ğœ)ğ‘¤thenbHğ›¾,ğ‘¡â†bHğ›¾,ğ‘¡âˆª{ğ‘’}
13:return bHğ›¾,ğ‘¡
Query Processing. The methods to compute the results for fre-
quency estimation and heavy-hitter identification on ğ‘Šğ‘¡using
DPSW-Sketch are presented in Algorithm 3. To obtain the fre-
quency of a query item ğ‘’inğ‘Šğ‘¡, the algorithm finds and queries one
PCMS within each substream that overlaps with ğ‘Šğ‘¡. For any inter-
mediate substream that is fully covered by ğ‘Šğ‘¡, the PCMS w.r.t. the
whole substream is selected. For the first substream that might
contain expired items, it chooses the PCMS that starts before, but is
closest to, the beginning of ğ‘Šğ‘¡. Similarly, for the current substream,
it identifies the PCMS that is closest to ğ‘¡and has already been com-
pleted. Finally, the estimated frequency bğ‘“ğ‘’,ğ‘¡of itemğ‘’onğ‘Šğ‘¡is the
sum of frequencies queried from all selected PCMSs according to
Lines 8â€“10 of Algorithm 1. The method can also be extended to find
an (approximate) set of ğ›¾-heavy hitters for a threshold ğ›¾âˆˆ(0,1).
It first queries the frequency bğ‘“ğ‘’,ğ‘¡of each item ğ‘’âˆˆEaccording to
Lines 2-7. Then, each item ğ‘’âˆˆEis checked one by one: If bğ‘“ğ‘’,ğ‘¡is
greater than or equal to (ğ›¾âˆ’ğœ)ğ‘¤,ğ‘’will be added to bHğ›¾,ğ‘¡. After
processing all items, bHğ›¾,ğ‘¡is returned for the heavy-hitter query.
4.2 Theoretical Analysis
We first provide a formal privacy guarantee for DPSW-Sketch.
Lemma 4.1. DPSW-Sketch bCğ‘¡at any timeğ‘¡constructed by Algo-
rithm 2 satisfies ğœŒ-zCDP.
Proof. According to [42, Theorem 3.1], each PCMS in bCğ‘¡satis-
fies zCDP w.r.t. the privacy parameter with which it is initialized.
That is, for any ğ‘˜â‰¥1,bC(ğ‘˜)
1providesğœŒ1-zCDP, where ğœŒ1=ğœŒ(2ğ›¼âˆ’
ğ›¼2);bC(ğ‘˜)
ğ‘—andbCâ€²(ğ‘˜)
ğ‘—provideğœŒğ‘—-zCDP, where ğœŒğ‘—=ğœŒğ›¼ğ‘—âˆ’2(1âˆ’ğ›¼)3/2,
for eachğ‘—=2,...,|ğ¿|. Since all of these PCMSs are built in the same
substreamğ‘†(ğ‘˜), their total privacy cost ğœŒğ‘ğ‘™ğ‘™is calculated by apply-
ing the adaptive composition of zCDP as:
ğœŒğ‘ğ‘™ğ‘™=ğœŒ(2ğ›¼âˆ’ğ›¼2)+2|ğ¿|âˆ‘ï¸
ğ‘—=2ğœŒ
2ğ›¼ğ‘—âˆ’2(1âˆ’ğ›¼)3
=ğœŒâˆ’ğœŒ(1âˆ’ğ›¼)2+ğœŒ(1âˆ’ğ›¼)2(1âˆ’ğ›¼|ğ¿|âˆ’1)<ğœŒ.Consequently, the output in each substream consisting of the union
of all PCMSs satisfies ğœŒ-zCDP. Finally, since all substreams are mu-
tually disjoint, DPSW-Sketch bCğ‘¡at any timeğ‘¡built by Algorithm 2
satisfiesğœŒ-zCDP due to the parallel composition of zCDP. â–¡
According to [ 42], a PCMS can only guarantee zCDP for queries.
That is, it assumes that an adversary has no access to the internal
sketch structure and is allowed to query a PCMS after the PCMS
has been built on all items in the dataset. As such, any query can be
regarded as a post-processing step without additional privacy losses.
DPSW-Sketch follows the same setting as [ 42]: By dividing the
stream into disjoint substreams and using smooth histograms to
pre-specify the range in which each PCMS is built, we ensure that
all PCMSs are queried only after they have been built without up-
dates. Therefore, DPSW-Sketch can answer an unlimited number
of queries at all times with DP. We consider how to convert ğœŒ-zCDP
to(ğœ€,ğ›¿)-DP according to Theorem 3.2. Specifically, to guarantee
(ğœ€,ğ›¿)-DP for any ğœ€>0andğ›¿âˆˆ(0,1), the value of ğœŒis set as:
ğœŒ=ğœ€+2 ln(1/ğ›¿)âˆ’2âˆšï¸ƒ
ğœ€ln(1/ğ›¿)+ln2(1/ğ›¿). (1)
Next, we analyze the error of the DPSW-Sketch framework for
frequency estimation.
Lemma 4.2. The frequency bğ‘“ğ‘’,ğ‘¡by Algorithm 3 satisfies Pr
|bğ‘“ğ‘’,ğ‘¡âˆ’
ğ‘“ğ‘’,ğ‘¡|â‰¤ğœğ‘¤+ğœ‰
â‰¥1âˆ’ğ‘‚(âˆšğ‘¤ğœ‚), whereğœ‰=ğ‘‚ âˆšğ‘¤(ğœ+1âˆšğœŒlog1
ğœğœ‚).
Proof. We compute the error bound of bğ‘“ğ‘’,ğ‘¡for estimating ğ‘“ğ‘’,ğ‘¡
by summing the upper bounds of its errors in all substreams. For
each substream ğ‘†(ğ‘˜)(ğ‘™â€²<ğ‘˜<ğ‘™) that is fully covered by ğ‘Šğ‘¡, we
always obtain bğ‘“(ğ‘˜)
ğ‘’frombC(ğ‘˜)
1. According to Theorem 3.3, we have
Pr
|bğ‘“(ğ‘˜)
ğ‘’âˆ’ğ‘“(ğ‘˜)
ğ‘’|â‰¤ğœÂ·âŒˆğ‘¤ğ›½âŒ‰+ğœ‰(ğ‘˜)
â‰¥1âˆ’ğœ‚, (2)
whereğœ‰(ğ‘˜)=âˆšï¸‚
2 log(2/ğœ‚)
ğœŒ(2ğ›¼âˆ’ğ›¼2)Â·âˆšï¸‚
log 4 log(2/ğœ‚)
ğœğœ‚. Forğ‘†(ğ‘™â€²)andğ‘†(ğ‘™)that
partially overlap with ğ‘Šğ‘¡, the errors come from the estimates of
PCMSs and the misalignments between ğ‘Šğ‘¡and the ranges of the
PCMSs used for query processing. Specifically, we have
Pr
|bğ‘“(ğ‘™â€²)
ğ‘’âˆ’ğ‘“(ğ‘™â€²)
ğ‘’|â‰¤(ğ›¼+ğœ)Â·ğ¼[ğ‘¥]+ğœ‰(ğ‘™â€²)
â‰¥1âˆ’ğœ‚; (3)
Pr
|bğ‘“(ğ‘™)
ğ‘’âˆ’ğ‘“(ğ‘™)
ğ‘’|â‰¤(ğ›¼+ğœ)Â·ğ¼[ğ‘¦]+ğœ‰(ğ‘™)
â‰¥1âˆ’ğœ‚, (4)
whereğœ‰(ğ‘™â€²)=âˆšï¸ƒ
2 log(2/ğœ‚)
ğœŒğ‘¥Â·âˆšï¸‚
log 4 log(2/ğœ‚)
ğœğœ‚andğœ‰(ğ‘™)=âˆšï¸‚
2 log(2/ğœ‚)
ğœŒğ‘¦Â·
âˆšï¸‚
log 4 log(2/ğœ‚)
ğœğœ‚. Since there are at most ğ‘™âˆ’ğ‘™â€²+1â‰¤âŒˆğ‘¤1âˆ’ğ›½âŒ‰+1
active substreams, by combining Eqs. 2â€“4 and applying the union
bound and the triangle inequality, we obtain with probability at
least 1âˆ’(âŒˆğ‘¤1âˆ’ğ›½âŒ‰+1)ğœ‚,
|bğ‘“ğ‘’,ğ‘¡âˆ’ğ‘“ğ‘’,ğ‘¡|â‰¤ğ‘™âˆ‘ï¸
ğ‘˜=ğ‘™â€²|bğ‘“(ğ‘˜)
ğ‘’âˆ’ğ‘“(ğ‘˜)
ğ‘’|â‰¤ğ‘™âˆ’1âˆ‘ï¸
ğ‘˜=ğ‘™â€²+1
ğœâŒˆğ‘¤ğ›½âŒ‰+ğœ‰(ğ‘˜)
+(ğ›¼+ğœ)(ğ¼[ğ‘¥]+ğ¼[ğ‘¦])+ğœ‰(ğ‘™â€²)+ğœ‰(ğ‘™).(5)
Takingğ›½=1
2andğ›¼=ğ‘‚(1), Eq. 5 can be simplified as
|bğ‘“ğ‘’,ğ‘¡âˆ’ğ‘“ğ‘’,ğ‘¡|â‰¤ğœğ‘¤+ğ‘‚âˆšğ‘¤ ğœ+1âˆšğœŒlog1
ğœğœ‚
,
3259KDD â€™24, August 25â€“29, 2024, Barcelona, Spain Yiping Wang, Yanhao Wang, and Cen Chen
becauseğœ‰(ğ‘˜)=ğ‘‚ 1âˆšğœŒlog1
ğœğœ‚for eachğ‘˜âˆˆ[ğ‘™â€²,...,ğ‘™]andğ¼[ğ‘¥]=
ğ¼[ğ‘¦]=ğ‘‚(âˆšğ‘¤), and the proof is concluded. â–¡
Then, we extend the error bound to heavy-hitter identification.
Lemma 4.3. The set bHğ›¾,ğ‘¡returned by Algorithm 3 satisfies (1) for
any itemğ‘’âˆˆE withğ‘“ğ‘’,ğ‘¡â‰¥ğ›¾ğ‘¤+ğ‘‚ âˆšğ‘¤(ğœ+1âˆšğœŒlog1
ğœğœ‚),ğ‘’âˆˆbHğ›¾,ğ‘¡
with probability at least 1âˆ’ğ‘‚(ğ‘šâˆšğ‘¤ğœ‚); (2) for any item ğ‘’âˆˆEwith
ğ‘“ğ‘’,ğ‘¡<(ğ›¾âˆ’2ğœ)ğ‘¤âˆ’ğ‘‚ âˆšğ‘¤(ğœ+1âˆšğœŒlog1
ğœğœ‚),ğ‘’âˆ‰bHğ›¾,ğ‘¡with probability
at least 1âˆ’ğ‘‚(ğ‘šâˆšğ‘¤ğœ‚).
Proof. According to Lemma 4.2, for any item ğ‘’âˆˆEwithğ‘“ğ‘’,ğ‘¡â‰¥
ğ›¾ğ‘¤+ğœ‰, whereğœ‰=ğ‘‚ âˆšğ‘¤(ğœ+1âˆšğœŒlog1
ğœğœ‚), we have bğ‘“ğ‘’,ğ‘¡â‰¥ğ‘“ğ‘’,ğ‘¡âˆ’ğœğ‘¤âˆ’
ğœ‰â‰¥(ğ›¾âˆ’ğœ)ğ‘¤andğ‘’is included in bHğ›¾,ğ‘¡with probability 1âˆ’ğ‘‚(âˆšğ‘¤ğœ‚).
Similarly, for any item ğ‘’âˆˆEwithğ‘“ğ‘’,ğ‘¡<(ğ›¾âˆ’2ğœ)ğ‘¤âˆ’ğœ‰, we have
bğ‘“ğ‘’,ğ‘¡â‰¤ğ‘“ğ‘’,ğ‘¡+ğœğ‘¤+ğœ‰<(ğ›¾âˆ’ğœ)ğ‘¤andğ‘’is not included in bHğ›¾,ğ‘¡with
probability 1âˆ’ğ‘‚(âˆšğ‘¤ğœ‚). By applying the union bound w.r.t. all the
ğ‘šitems inE, it guarantees that the above results hold for all items
with probability at least 1âˆ’ğ‘‚(ğ‘šâˆšğ‘¤ğœ‚). â–¡
Finally, the main theoretical results of the DPSW-Sketch frame-
work are summarized as follows.
Theorem 4.4. For any window size ğ‘¤, framework factors ğ›½=1
2
andğ›¼=ğ‘‚(1), sketching parameters ğœ,ğœ‚âˆˆ(0,1), privacy parameters
ğœ€>0andğ›¿âˆˆ(0,1), the following results hold:
1.DPSW-Sketch is(ğœ€,ğ›¿)-differentially private.
2.It provides an
ğ‘‚ ğœğ‘¤+âˆš
ğ‘¤log(1/ğ›¿)
ğœ€logğ‘¤ğ‘š
ğœğœ‚,ğœ‚
-approximate
frequency bğ‘“ğ‘’,ğ‘¡for each item ğ‘’âˆˆE.
3.It gives an
ğ‘‚ ğœâˆšğ‘¤+âˆš
ğ‘¤log(1/ğ›¿)
ğœ€logğ‘¤ğ‘š
ğœğœ‚,ğœ‚
-approximate
setbHğ›¾,ğ‘¡ofğ›¾-heavy hitters for any threshold ğ›¾â‰¥4ğœ.
4.It usesğ‘‚(âˆšğ‘¤logğ‘¤
ğœlogğ‘¤ğ‘š
ğœ‚)space andğ‘‚(logğ‘¤logğ‘¤ğ‘š
ğœ‚)time
per update and processes a frequency query and a heavy-hitter
query inğ‘‚(âˆšğ‘¤logğ‘¤ğ‘š
ğœ‚)andğ‘‚(ğ‘šâˆšğ‘¤logğ‘¤ğ‘š
ğœ‚)time.
Proof. First of all, by setting the value of ğœŒaccording to Eq. 1
for any given ğœ€>0andğ›¿âˆˆ(0,1),DPSW-Sketch satisfies(ğœ€,ğ›¿)-DP.
Eq. 1 implies1
ğœŒ=ğœ€+2 ln(1/ğ›¿)+2âˆš
ğœ€ln(1/ğ›¿)+ln2(1/ğ›¿)
ğœ€2 =ğ‘‚ log(1/ğ›¿)
ğœ€2. By
replacing1
ğœŒwithğ‘‚ log(1/ğ›¿)
ğœ–2and scaling ğœ‚toğ‘‚(ğœ‚
ğ‘šâˆšğ‘¤)for each
PCMS in Lemmas 4.2 and 4.3, we obtain the approximation bounds
for frequency estimation and heavy-hitter identification.
In terms of space complexity, we can see that there exist ğ‘‚(âˆšğ‘¤)
active substreams that overlap with ğ‘Šğ‘¡for anyğ‘¡âˆˆZ+, the number
of PCMSs maintained in each active substream is ğ‘‚(logğ‘¤), and the
size of each PCMS is ğ‘‚(1
ğœlogğ‘¤ğ‘š
ğœ‚). In total, the space complexity
ofDPSW-Sketch isğ‘‚(âˆšğ‘¤logğ‘¤
ğœlogğ‘¤ğ‘š
ğœ‚). In terms of time complex-
ity, we can see that Algorithm 2 uses ğ‘‚(âˆšğ‘¤)time to decide the
two lists of checkpoints in a smooth histogram, initializes ğ‘‚(logğ‘¤)
PCMSs at the beginning of each substream, inserts an item into
at mostğ‘‚(logğ‘¤)PCMSs, and requires ğ‘‚(logğ‘¤ğ‘š
ğœ‚)hash computa-
tions and counter updates for each insertion. Since the checkpoints
are computed only once before stream processing, the (amortized)
time complexity per update is ğ‘‚(logğ‘¤logğ‘¤ğ‘š
ğœ‚). For a frequencyTable 2: Dataset Information
Dataset ğ‘› ğ‘š Description
AOL210.7M 38,411 Web search query logs
MovieLens325M 62,423 Movie ratings
WorldCup41.3B 82,592 Web server logs
Gaussian 10M 25,600 Synthetic Gaussian-distributed items
Zipf 10M 25,600 Synthetic Zipf-distributed items
query, Algorithm 3 selects ğ‘‚(âˆšğ‘¤)PCMSs from DPSW-Sketch and
takesğ‘‚(logğ‘¤ğ‘š
ğœ‚)time to query each PCMS. Thus, the time com-
plexity of each frequency query is ğ‘‚(âˆšğ‘¤logğ‘¤ğ‘š
ğœ‚). A heavy-hitter
query requires to perform ğ‘šfrequency queries and thus has a time
complexity of ğ‘‚(ğ‘šâˆšğ‘¤logğ‘¤ğ‘š
ğœ‚). â–¡
Comparison with Existing Private Sketches in [ 5,8,38].We
show how the theoretical results of DPSW-Sketch improve over
those of the existing private sliding-window sketches [ 5,8,38]. First,
the sketches in [ 5,8,38] are all specific to the identification of heavy
hitters and the estimation of their frequencies with bounded errors,
while DPSW-Sketch can approximate the frequencies of all items.
Second, DPSW-Sketch either provides better approximations for
heavy-hitter identification or has a lower space complexity than
the sketches in [ 5,8,38]. Compared to PCC-MG in [8], which
requiresğ‘‚(ğ‘¤)space for an additive error of ğ‘‚(âˆšğ‘¤), and U-Sketch
in [38], which has an additive error of Ëœğ‘‚(ğ‘¤3/4)inËœğ‘‚(âˆšğ‘¤)space1,
the additive error and space complexity of DPSW-Sketch are both
Ëœğ‘‚(âˆšğ‘¤).BLMZ-Sketch [5] achieves the same Ëœğ‘‚(âˆšğ‘¤)additive error
asDPSW-Sketch. However, its update time and space usage, both
of which are ğ‘‚(âˆšğ‘¤log4ğ‘¤
ğœ€ğ›¾), are much higher than those of DPSW-
Sketch. Finally, we note that all private sketches have higher errors
and use more space than non-private sketches in the sliding window
model, e.g., [23, 40], due to the noise added to satisfy DP.
5 EXPERIMENTS
In this section, we conducted extensive experiments on five real-
world and synthetic datasets to evaluate the performance of DPSW-
Sketch compared to the state-of-the-art baselines.
Datasets. We employed three real-world and two synthetic datasets
in the experiments. Their statistics are reported in Table 2, where ğ‘›
is the dataset size and ğ‘šis the domain size. For synthetic datasets,
the skewness parameter for the Zipf distribution is 1; the mean
and standard deviation of the Gaussian distribution are 50and
25, respectively. More detailed information on these datasets is
provided in Appendix A due to space limitations.
Baselines. We adopted U-Sketch [38],PCC-MG [8], and BLMZ-
Sketch [5] as baselines for frequency estimation and heavy-hitter
identification with DP in the sliding window model. We also used a
non-private sliding-window sketch, Microscope-Sketch [40], as a
baseline to measure â€œthe price of privacy. â€ More details about these
baselines are also deferred to Appendix B.
1We use Ëœğ‘‚(Â·)to omit all the factors poly-logarithmic w.r.t. ğ‘¤and independent of ğ‘¤.
2https://www.cim.mcgill.ca/~dudek/206/Logs/AOL-user-ct-collection/
3https://grouplens.org/datasets/movielens/latest/
4https://ita.ee.lbl.gov/html/contrib/WorldCup.html
3260DPSW-Sketch: A Differentially Private Sketch Framework for Frequency Estimation over Sliding Windows KDD â€™24, August 25â€“29, 2024, Barcelona, Spain
Figur
e 2: Performance for frequency queries on high-frequency items by varying privacy parameter ğœ€âˆˆ{0.1,0.2,0.4,..., 2.0}.
Figur
e 3: Performance for frequency queries on low-frequency items by varying privacy parameter ğœ€âˆˆ{0.1,0.2,0.4,..., 2.0}.
Implementation. All the algorithms we compared were imple-
mented in C++ and compiled with the â€œ-O3â€ flag. We ran each
experiment with a single thread on a server with an Intel Xeon
Gold 6428 processor @2.5GHz and 32GB RAM. For each baseline,
we either used the implementation published by the original au-
thors or followed the idea of the original paper for implementation
and fine-tuned the parameters. We set the window size ğ‘¤to106by
default. The default parameters in DPSW-Sketch are as follows:
(1) number of checkpoints |ğ¼|=3; (2) length of each substream
0.1ğ‘¤; and (3) height ğ‘âˆˆ[2,..., 5]and widthğ‘âˆˆ[500,..., 5000]for
each PCMS. The parameter sensitivity of DPSW-Sketch is further
analyzed in Appendix C.
Metrics. The query workload on each dataset was generated by ran-
domly sampling 1%timestamps from time ğ‘¡=ğ‘¤toğ‘›and perform-
ing a set of 100frequency queries and a heavy-hitter query at each
sampled timestamp. We divided the items into two groups accord-
ing to their ground-truth frequencies as high- and low-frequency
items (top-50 most frequent vs. all remaining items) and each set
Qof queries has an equal number of items from each group. The
following metrics are used for performance evaluation:
â€¢Mean Absolute Error (MAE),1
|
Q|Ã
ğ‘’âˆˆQ|bğ‘“ğ‘’,ğ‘¡âˆ’ğ‘“ğ‘’,ğ‘¡|, is used
to measure the performance for frequency queries.â€¢Mean Relative Error (MRE),1
|
Q|Ã
ğ‘’âˆˆQ|bğ‘“ğ‘’,ğ‘¡âˆ’ğ‘“ğ‘’,ğ‘¡|
ğ‘“ğ‘’
,ğ‘¡, is also
used to measure the performance for frequency queries.
â€¢F1-score, which is the harmonic mean of the precision score,
i.e., the ratio of|bHğ‘’,ğ‘¡âˆ©Hğ‘’,ğ‘¡|to|bHğ‘’,ğ‘¡|, and the recall score,
i.e., the ratio of|bHğ‘’,ğ‘¡âˆ©Hğ‘’,ğ‘¡|to|Hğ‘’,ğ‘¡|, is used to measure
the performance for heavy-hitter queries.
â€¢Throughput, i.e., the average number of items to insert
per second (in Kops), and Sketch Size (in KB) are used to
measure the time and space efficiency of each method.
5.1 Frequency Estimation
Figures 2 and 3 illustrate the performance of different sketches for
frequency queries on high- and low-frequency items by varying
the privacy parameter ğœ€from 0.1to2. For sketches satisfying (ğœ€,ğ›¿)-
DP andğœŒ-zCDP, we fix ğ›¿to1/ğ‘›1.5and compute the value of ğœŒ
according to Eq. 1. Here, we restrict the selection of low-frequency
items to those with frequencies of at least 100. This is because PCC-
MGandBLMZ-Sketch , which use Misra-Gries sketches [ 31] as
building blocks, cannot answer queries on low-frequency items.
For the above query workload, PCC-MG andBLMZ-Sketch still
do not report the results for many frequency queries. In such cases,
we treat their results as 0in the calculation of MAE and MRE.
3261KDD â€™24, August 25â€“29, 2024, Barcelona, Spain Yiping Wang, Yanhao Wang, and Cen Chen
Figur
e 4: Performance for heavy-hitter queries by varying privacy parameter ğœ€and threshold ğ›¾.
Our results show that the MAEs and MREs of all sketches, ex-
cept (non-private) Microscope-Sketch, generally decrease with
increasingğœ€in all datasets. For both high- and low-frequency items,
DPSW-Sketch achieves significantly lower MAE and MRE than all
other private sketches across different values of ğœ€. Especially, DPSW-
Sketch is the only method among them whose MREs are always
within 10%for high-frequency items and 100% for low-frequency
items when ğœ€â‰¥1. The results confirm that DPSW-Sketch strikes a
better balance between frequency estimation accuracy and privacy
than state-of-the-art private sketches in the sliding-window model.
Furthermore, U-Sketch, PCC-MG, and BLMZ-Sketch generally
exhibit performance similar to each other on high-frequency items,
andPCC-MG is slightly better when ğœ€is smaller, while U-Sketch
becomes better for a larger value of ğœ€. For low-frequency items, U-
Sketch sometimes performs much worse than PCC-MG andBLMZ-
Sketch because its estimation errors are even higher than simply
treating all missing frequencies as 0. In all datasets, the three private
baselines always have at least 4Ã—higher MAE and 2Ã—higher MRE
than those of DPSW-Sketch. Finally, the performance of all private
sketches for frequency estimation is not comparable to that of the
state-of-the-art non-private sketch, Microscope-Sketch, especially
on low-frequency items, because (1) they introduce substantial
noise in the counters to satisfy DP and (2) their sketch structures
are modified for ease of privacy accounting, which further leads
to estimation errors due to the misalignment between the sliding
window and the sketch used for query processing.
5.2 Heavy-Hitter Identification
Figure 4 shows the performance of different sketches for heavy-
hitter identification by varying the privacy parameter ğœ€when the
thresholdğ›¾=0.005or0.01and the threshold ğ›¾whenğœ€=1. We
observe that DPSW-Sketch achieves higher F1-scores than other
DP sketches in almost all cases. Its performance is mostly close
to that of (non-private) Microscope-Sketch whenğœ€â‰¥1. These
results verify its good trade-off between accuracy for heavy-hitter
identification and privacy. The performance of BLMZ-Sketch and
U-Sketch improves with increasing ğœ€. However, they are inferior
toDPSW-Sketch due to much larger noise. The F1-score of PCC-
MGremains constant for all values of ğœ€. This is because PCC-MGis built directly on MG sketches, which only guarantee to return
heavy hitters but cannot filter out non-heavy hitters. As such, it has
achieved a recall score of 1whenğœ€=0.1(i.e., no false negatives)
while inevitably including some false positives in all its results,
regardless of the value of ğœ€. In contrast, BLMZ-Sketch only uses
MG sketches for pre-screening and builds additional counters to
decide whether a candidate item is a heavy hitter, thus achieving
better performance for heavy-hitter queries.
5.3 Performance vs. Window Size
Figure 5 presents the performance of different sketches for fre-
quency and heavy-hitter queries by varying the window size ğ‘¤
from 105to106. We observe that DPSW-Sketch has better query
accuracies than other private sketches in almost all cases across
different window sizes. The MAEs of DPSW-Sketch for frequency
estimation increase with the window size ğ‘¤. This can be attributed
to a greater number of distinct elements within a larger window,
which leads to more hash collisions. Note that the MAEs grow
much lower than ğ‘¤and thus the MREs of DPSW-Sketch drop
with increasing ğ‘¤. Furthermore, the F1-scores of DPSW-Sketch
for heavy-hitter queries also increase with ğ‘¤. Therefore, the perfor-
mance of DPSW-Sketch generally degrades in smaller windows.
This is because the variance of Gaussian noise added to PCMSs is
nearly independent of ğ‘¤. As such, queries in smaller windows are
more severely disturbed by noise than those in larger windows.
5.4 Space and Time Efficiency
Figure 6 illustrates the performance of different sketches for fre-
quency and heavy-hitter queries when their sizes range from 4KB
to 4MB and ğœ€=1. We observe that for CMS-based methods, i.e.,
U-Sketch, DPSW-Sketch, and Microscope-Sketch, their query
performance first decreases with increasing sketch sizes and then
becomes steady when the sketch sizes are sufficiently large because
larger sketches naturally lead to fewer hash collisions and more
accurate counters. On the contrary, MG sketch-based methods, i.e.,
PCC-MG andBLMZ-Sketch, generally perform better when their
sketch sizes are smaller because larger sketches introduce much
more noise while having little benefit.
3262DPSW-Sketch: A Differentially Private Sketch Framework for Frequency Estimation over Sliding Windows KDD â€™24, August 25â€“29, 2024, Barcelona, Spain
Figur
e 5: Performance of different sketches for frequency and heavy-hitter queries by varying window size ğ‘¤.
Figur
e 6: Performance of different sketches for frequency and heavy-hitter queries by varying sketch size from 4KB to 4MB.
Figur
e 7: Throughput of each sketch in the default setting.
Figure 7 presents the throughputs of different sketches in the
default setting (i.e., for ğœ€=1andğ‘¤=106with all the sketch parame-
ters fine-tuned). DPSW-Sketch has a throughput of about 100Kops
(i.e., processing 100K items per second) across all datasets, which
satisfies the requirement for real-world stream processing and is
similar to that of U-Sketch. However, Microscope-Sketch, BLMZ-
Sketch, and PCC-MG have higher throughputs (500â€“1000Kops)
than DPSW-Sketch. For Microscope-Sketch, this is because it
utilizes a more efficient structure without considering privacy. For
BLMZ-Sketch andPCC-MG, this can be attributed to the fact that
MG sketches are much smaller than CMSs.6 CONCLUSION
In this paper, we propose DPSW-Sketch, a novel sketch frame-
work for frequency and heavy-hitter queries with event-level dif-
ferential privacy (DP) in the sliding-window model. Theoretically,
DPSW-Sketch satisfies DP, provides results for both queries within
bounded errors, and has sublinear time and space complexities w.r.t.
the size of the sliding window. These results improve upon those
of existing private sliding-window sketches. Experimental results
also indicate that DPSW-Sketch achieves better trade-offs between
utility and privacy than state-of-the-art baselines.
In future work, we would like to extend DPSW-Sketch to satisfy
more rigorous notions of DP, such as user-level DP and local DP
(LDP). We are also interested in the design of private federated
sketches for distributed data streams.
ACKNOWLEDGMENTS
We thank anonymous reviewers for their constructive comments to
help improve this work. This work was supported by the National
Natural Science Foundation of China (Grant No. 62202169 and
62202170) and the Open Research Fund of The State Key Laboratory
of Blockchain and Data Security, Zhejiang University.
3263KDD â€™24, August 25â€“29, 2024, Barcelona, Spain Yiping Wang, Yanhao Wang, and Cen Chen
REFERENCES
[1]Joel Daniel Andersson and Rasmus Pagh. 2023. A Smooth Binary Mechanism
for Efficient Private Continual Observation. Advances in Neural Information
Processing Systems 36 (2023), 49133â€“49145.
[2]Arvind Arasu and Gurmeet Singh Manku. 2004. Approximate Counts and Quan-
tiles over Sliding Windows. In Proceedings of the Twenty-Third ACM SIGMOD-
SIGACT-SIGART Symposium on Principles of Database Systems (PODS â€™04). Asso-
ciation for Computing Machinery, New York, NY, USA, 286â€“296.
[3]Ran Ben-Basat, Gil Einziger, Roy Friedman, and Yaron Kassner. 2016. Heavy
hitters in streams and sliding windows. In IEEE INFOCOM 2016 - The 35th Annual
IEEE International Conference on Computer Communications. IEEE, 1â€“9.
[4]Omri Ben-Eliezer, Dan Mikulincer, and Ilias Zadik. 2022. Archimedes Meets
Privacy: On Privately Estimating Quantiles in High Dimensions Under Minimal
Assumptions. Advances in Neural Information Processing Systems 35 (2022), 32450â€“
32464.
[5]Jeremiah Blocki, Seunghoon Lee, Tamalika Mukherjee, and Samson Zhou. 2023.
Differentially Private ğ¿2-Heavy Hitters in the Sliding Window Model. In The
Eleventh International Conference on Learning Representations. OpenReview.net.
[6]Vladimir Braverman and Rafail Ostrovsky. 2007. Smooth Histograms for Sliding
Windows. In 48th Annual IEEE Symposium on Foundations of Computer Science.
IEEE, 283â€“293.
[7]Mark Bun and Thomas Steinke. 2016. Concentrated Differential Privacy: Sim-
plifications, Extensions, and Lower Bounds. In Theory of Cryptography - 14th
International Conference, TCC 2016-B, Beijing, China, October 31-November 3, 2016,
Proceedings, Part I. Springer, Berlin, Heidelberg, 635â€“658.
[8]T.-H. Hubert Chan, Mingfei Li, Elaine Shi, and Wenchang Xu. 2012. Differentially
Private Continual Monitoring of Heavy Hitters from Distributed Streams. In
Privacy Enhancing Technologies - 12th International Symposium, PETS 2012, Vigo,
Spain, July 11-13, 2012, Proceedings. Springer, Berlin, Heidelberg, 140â€“159.
[9]T.-H. Hubert Chan, Elaine Shi, and Dawn Song. 2011. Private and Continual
Release of Statistics. ACM Transactions on Information and System Security 14, 3,
Article 26 (2011), 24 pages.
[10] Moses Charikar, Kevin C. Chen, and Martin Farach-Colton. 2004. Finding frequent
items in data streams. Theoretical Computer Science 312, 1 (2004), 3â€“15.
[11] Graham Cormode, Minos N. Garofalakis, Peter J. Haas, and Chris Jermaine. 2012.
Synopses for Massive Data: Samples, Histograms, Wavelets, Sketches. Foundations
and Trends in Databases 4, 1-3 (2012), 1â€“294.
[12] Graham Cormode and S. Muthukrishnan. 2005. An improved data stream sum-
mary: the count-min sketch and its applications. Journal of Algorithms 55, 1
(2005), 58â€“75.
[13] Mayur Datar, Aristides Gionis, Piotr Indyk, and Rajeev Motwani. 2002. Main-
taining Stream Statistics over Sliding Windows. SIAM J. Comput. 31, 6 (2002),
1794â€“1813.
[14] Cynthia Dwork, Krishnaram Kenthapadi, Frank McSherry, Ilya Mironov, and
Moni Naor. 2006. Our Data, Ourselves: Privacy Via Distributed Noise Generation.
InAdvances in Cryptology â€“ EUROCRYPT 2006. Springer, Berlin, Heidelberg,
486â€“503.
[15] Cynthia Dwork, Frank McSherry, Kobbi Nissim, and Adam D. Smith. 2006. Cali-
brating Noise to Sensitivity in Private Data Analysis. In Theory of Cryptography.
Springer, Berlin, Heidelberg, 265â€“284.
[16] Cynthia Dwork, Moni Naor, Toniann Pitassi, and Guy N. Rothblum. 2010. Dif-
ferential privacy under continual observation. In Proceedings of the 42nd ACM
Symposium on Theory of Computing (STOC â€™10). Association for Computing
Machinery, New York, NY, USA, 715â€“724.
[17] Alessandro Epasto, Jieming Mao, Andres Munoz Medina, Vahab Mirrokni, Sergei
Vassilvitskii, and Peilin Zhong. 2023. Differentially Private Continual Releases
of Streaming Frequency Moment Estimations. In 14th Innovations in Theoretical
Computer Science Conference (ITCS 2023). Schloss Dagstuhl â€“ Leibniz-Zentrum
fÃ¼r Informatik, Dagstuhl, Germany, 48:1â€“48:24.
[18] Cristian Estan and George Varghese. 2002. New directions in traffic measurement
and accounting. In Proceedings of the 2002 Conference on Applications, Technolo-
gies, Architectures, and Protocols for Computer Communications (SIGCOMM â€™02).
Association for Computing Machinery, New York, NY, USA, 323â€“336.
[19] Hendrik Fichtenberger, Monika Henzinger, and Jalaj Upadhyay. 2023. Constant
Matters: Fine-grained Error Bound on Differentially Private Continual Obser-
vation. In Proceedings of the 40th International Conference on Machine Learning.
PMLR, 10072â€“10092.
[20] Badih Ghazi, Ravi Kumar, Jelani Nelson, and Pasin Manurangsi. 2023. Private
Counting of Distinct and k-Occurring Items in Time Windows. In 14th Innova-
tions in Theoretical Computer Science Conference (ITCS 2023). Schloss Dagstuhl â€“
Leibniz-Zentrum fÃ¼r Informatik, Dagstuhl, Germany, 55:1â€“55:24.
[21] Jennifer Gillenwater, Matthew Joseph, and Alex Kulesza. 2021. Differentially
Private Quantiles. In Proceedings of the 38th International Conference on Machine
Learning. PMLR, 3713â€“3722.
[22] Google. 2024. How Google retains data we collect. https://policies.google.com/
technologies/retention.[23] Xiangyang Gou, Long He, Yinda Zhang, Ke Wang, Xilai Liu, Tong Yang, Yi
Wang, and Bin Cui. 2020. Sliding Sketches: A Framework using Time Zones
for Data Stream Processing in Sliding Windows. In Proceedings of the 26th ACM
SIGKDD International Conference on Knowledge Discovery & Data Mining (KDD
â€™20). Association for Computing Machinery, New York, NY, USA, 1015â€“1025.
[24] Johannes Haug, Alexander Braun, Stefan ZÃ¼rn, and Gjergji Kasneci. 2022. Change
Detection for Local Explainability in Evolving Data Streams. In Proceedings of
the 31st ACM International Conference on Information & Knowledge Management
(CIKM â€™22). Association for Computing Machinery, New York, NY, USA, 706â€“716.
[25] Jonathan Hehir, Daniel Ting, and Graham Cormode. 2023. Sketch-Flip-Merge:
Mergeable Sketches for Private Distinct Counting. In Proceedings of the 40th
International Conference on Machine Learning. PMLR, 12846â€“12865.
[26] Ziyue Huang, Yuan Qiu, Ke Yi, and Graham Cormode. 2022. Frequency Estimation
Under Multiparty Differential Privacy: One-shot and Streaming. Proceedings of
the VLDB Endowment 15, 10 (2022), 2058â€“2070.
[27] Haim Kaplan, Shachar Schnapp, and Uri Stemmer. 2022. Differentially Private
Approximate Quantiles. In Proceedings of the 39th International Conference on
Machine Learning. PMLR, 10751â€“10761.
[28] Christian Janos Lebeda and Jakub Tetek. 2023. Better Differentially Private
Approximate Histograms and Heavy Hitters using the Misra-Gries Sketch. In
Proceedings of the 42nd ACM SIGMOD-SIGACT-SIGAI Symposium on Principles of
Database Systems (PODS â€™23). Association for Computing Machinery, New York,
NY, USA, 79â€“88.
[29] Luca Melis, George Danezis, and Emiliano De Cristofaro. 2016. Efficient Private
Statistics with Succinct Sketches. In 23rd Annual Network and Distributed System
Security Symposium (NDSS â€™16). The Internet Society, 15 pages.
[30] Darakhshan J. Mir, S. Muthukrishnan, Aleksandar Nikolov, and Rebecca N.
Wright. 2011. Pan-private algorithms via statistics on sketches. In Proceedings of
the Thirtieth ACM SIGMOD-SIGACT-SIGART Symposium on Principles of Database
Systems (PODS â€™11). Association for Computing Machinery, New York, NY, USA,
37â€“48.
[31] Jayadev Misra and David Gries. 1982. Finding Repeated Elements. Science of
Computer Programming 2, 2 (1982), 143â€“152.
[32] S. Muthukrishnan. 2005. Data Streams: Algorithms and Applications. Foundations
and Trends in Theoretical Computer Science 1, 2 (2005), 117â€“236.
[33] Rasmus Pagh and Mikkel Thorup. 2022. Improved Utility Analysis of Private
CountSketch. Advances in Neural Information Processing Systems 35 (2022), 25631â€“
25643.
[34] Odysseas Papapetrou, Minos N. Garofalakis, and Antonios Deligiannakis. 2012.
Sketch-based Querying of Distributed Sliding-Window Data Streams. Proceedings
of the VLDB Endowment 5, 10 (2012), 992â€“1003.
[35] Victor Perrier, Hassan Jameel Asghar, and Dali Kaafar. 2019. Private Continual
Release of Real-Valued Data Streams. In 26th Annual Network and Distributed
System Security Symposium (NDSS â€™19). The Internet Society, 13 pages.
[36] Nicolo Rivetti, Yann Busnel, and Achour MostÃ©faoui. 2015. Efficiently Sum-
marizing Data Streams over Sliding Windows. In 2015 IEEE 14th International
Symposium on Network Computing and Applications. IEEE, 151â€“158.
[37] Adam D. Smith, Shuang Song, and Abhradeep Thakurta. 2020. The Flajolet-Martin
Sketch Itself Preserves Differential Privacy: Private Counting with Minimal Space.
Advances in Neural Information Processing Systems 33 (2020), 19561â€“19572.
[38] Jalaj Upadhyay. 2019. Sublinear Space Private Algorithms Under the Sliding
Window Model. In Proceedings of the 36th International Conference on Machine
Learning. PMLR, 6363â€“6372.
[39] Lun Wang, Iosif Pinelis, and Dawn Song. 2022. Differentially Private Fractional
Frequency Moments Estimation with Polylogarithmic Space. In The Tenth Inter-
national Conference on Learning Representations. OpenReview.net.
[40] Yuhan Wu, Shiqi Jiang, Siyuan Dong, Zheng Zhong, Jiale Chen, Yutong Hu,
Tong Yang, Steve Uhlig, and Bin Cui. 2023. MicroscopeSketch: Accurate Sliding
Estimation Using Adaptive Zooming. In Proceedings of the 29th ACM SIGKDD
Conference on Knowledge Discovery and Data Mining (KDD â€™23). Association for
Computing Machinery, New York, NY, USA, 2660â€“2671.
[41] Sinan Yildirim, Kamer Kaya, Soner Aydin, and Hakan Bugra Erentug. 2020. Dif-
ferentially Private Frequency Sketches for Intermittent Queries on Large Data
Streams. In 2020 IEEE International Conference on Big Data. IEEE, 4083â€“4092.
[42] Fuheng Zhao, Dan Qiao, Rachel Redberg, Divyakant Agrawal, Amr El Abbadi,
and Yu-Xiang Wang. 2022. Differentially Private Linear Sketches: Efficient Imple-
mentations and Applications. Advances in Neural Information Processing Systems
35 (2022), 12691â€“12704.
[43] Zheng Zhong, Shen Yan, Zikun Li, Decheng Tan, Tong Yang, and Bin Cui. 2021.
BurstSketch: Finding Bursts in Data Streams. In Proceedings of the 2021 Interna-
tional Conference on Management of Data (SIGMOD â€™21). Association for Comput-
ing Machinery, New York, NY, USA, 2375â€“2383.
[44] Wennan Zhu, Peter Kairouz, Brendan McMahan, Haicheng Sun, and Wei Li. 2020.
Federated Heavy Hitters Discovery with Differential Privacy. In Proceedings of
the Twenty Third International Conference on Artificial Intelligence and Statistics.
PMLR, 3837â€“3847.
3264DPSW-Sketch: A Differentially Private Sketch Framework for Frequency Estimation over Sliding Windows KDD â€™24, August 25â€“29, 2024, Barcelona, Spain
A DATASET INFORMATION
We describe the datasets used in our experiments and the pre-
processing steps applied to them below.
â€¢AOL5comprises 36,389,567 web queries over three months
on the AOL website. Each record has several fields such as
AnonID ,Query ,QueryTime ,ItemRank , and ClickURL . We
pre-processed the dataset as follows: (1) removing all du-
plicate and incomplete records; (2) sorting the records by
QueryTime ; (3) acquiring keywords from the Query field of
each record after stopword removal and lemmatization; (4)
filtering out typos and meaningless keywords. After all pre-
processing steps, the dataset contains 10,710,880 items with
38,411 unique query keywords. We aim to keep track of
the number of times each keyword is queried and the top
trending keywords in the latest ğ‘¤queries.
â€¢MovieLens6consists of 25,000,095 ratings on 62,423 movies
contributed by 162,541 users from January 1995 to Novem-
ber 2019. Each record has several fields such as userId ,
movieId ,rating , and timestamp . The original data set has
been sorted chronologically without missing fields. We ex-
tract the movieId field for statistics to track the number of
times each movie is rated and the most popular movies in
the latestğ‘¤user interactions.
â€¢WorldCup7encompasses all 1,352,804,107 requests made to
the 1998 FIFA World Cup website from April 30, 1998 to July
26, 1998. Each request has the following fields: timestamp ,
clientID ,objectID ,size ,method ,status ,type , as well
asserver . Pre-processing steps include (1) removing incom-
plete and duplicate requests and (2) sorting the requests
bytimestamp . After pre-processing, the dataset contains
1,267,670,951 requests for 82,592 distinct URLs. We aim to
track the number of times each URL is requested and the top
trending URLs in the latest ğ‘¤requests.
â€¢Gaussian is a synthetic dataset consisting of 10,000,000
items with a domain size of 25,600, in which 95% items are
drawn from a Gaussian distribution with mean ğœ‡=50and
standard deviation ğœ=25(negative numbers are ignored)
and rounded to the nearest positive integers, and the remain-
ing 5% items are drawn from a discrete uniform distribution
in the range[1,25600] .
â€¢Zipf is also a synthetic dataset consisting of 10,000,000 items
with a domain size of 25,600, in which 95% items are drawn
from a Zipf distribution with the skewness parameter 1and
the remaining 5% items are drawn from a discrete uniform
distribution in the range [1,25600] .
We illustrate the distribution of item frequencies in the above five
datasets in Figure 8, where each point (ğ‘¥,ğ‘¦)in a plot denotes that
the ratio of the number of items with a frequency of at least ğ‘¥and
the total number of items in the domain is ğ‘¦.
B BASELINE IMPLEMENTATION
In the following, we provide some implementation details of differ-
ent sketches in the experiments.
5https://www.cim.mcgill.ca/~dudek/206/Logs/AOL-user-ct-collection/
6https://grouplens.org/datasets/movielens/latest/
7https://ita.ee.lbl.gov/html/contrib/WorldCup.htmlâ€¢PCC-MG [8]: There is no publicly available implementation
ofPCC-MG. Thus, we follow the specifications in [ 8] to
implement PCC-MG. Given a parameter ğœ†âˆˆ(0,1), it builds
a binary tree with ğ‘™=âŒˆln4
ğœ†âŒ‰levels, each of which consists
of equal-length and disjoint blocks. For each block at the
ğ‘–ğ‘¡â„level, a (private) Misra-Gries sketch is constructed with
the privacy parameter ğœ€ğ‘–=ğœ€
2ğ‘™âˆ’ğ‘–+1and the sketch parameter
ğœ†ğ‘–=1
2ğ‘–(ğ‘™+1). In each experiment, we test different values of
ğœ†and report the best result achieved by PCC-MG among all
values ofğœ†.
â€¢U-Sketch [38]: To the best of our knowledge, U-Sketch has
not been implemented for experimentation. We first tried
to reproduce U-Sketch following the specifications in [38].
However, this leads to large sketch sizes (typically several
times the size of the sliding window), which is deemed un-
acceptable for stream processing. Therefore, we implement
U-Sketch based on the general idea of [ 38] but modify the
parameter setting. To reduce space usage, we divide the slid-
ing window into 100blocks and limit the number of sketches
built in each block to 2. Other parameters are fine-tuned for
the best performance in each experiment.
â€¢BLMZ-Sketch [5]: To the best of our knowledge, BLMZ-
Sketch has also not been implemented for experimentation.
We found that the specifications in [ 5] imply an excessively
small block size (even less than 1in some cases). Therefore,
similar to U-Sketch, we implement BLMZ-Sketch based
on the general idea of [ 5] but modify the parameter setting.
In particular, we fix the number ğ‘™of levels to 4and the
size of each block toğ‘¤
16. Other parameters are determined
accordingly, and, in each experiment, we also fine-tune them
and report the best result among all tested settings.
â€¢Microscope-Sketch [40]: We use the code published by the
authors on GitHub8. We test the variants of Microscope-
Sketch using CMS, CU-Sketch, and CountSketch and find
that the CMS version shows the best performance in most
cases. Therefore, we only employ its CMS version in our
experiments. Finally, in each experiment, we also report the
best result among all the parameter settings.
C PARAMETER SENSITIVITY
Figure 9 illustrates how the number of checkpoints in each smooth
histogram affects the MAE for frequency estimation of DPSW-
Sketch. By setting the privacy parameter ğœ€to1and the length of
each substream to 0.1ğ‘¤and limiting the total sketch size to at most
100KB, we adjust the value of ğ›¼from 0.99to0.1so that|ğ¼|is varied
over{2,3,4,5,8,10,15}. Our results indicate a significant growth
in MAE across all datasets as the number of checkpoints increases.
This is because more checkpoints lead to fewer privacy budgets
assigned to all PCMSs. Accordingly, larger Gaussian noise should
be added to each counter, which naturally causes higher MAEs.
Figure 10 illustrates the impact of the number of substreams
in each window on the MAE of frequency estimation of DPSW-
Sketch. We fix ğœ€=1and|ğ¼|=3and limit the total sketch size to
at most 100KB. We then vary the value of ğ›½to adjust the length of
8https://github.com/MicroscopeSketch/MicroscopeSketch
3265KDD â€™24, August 25â€“29, 2024, Barcelona, Spain Yiping Wang, Yanhao Wang, and Cen Chen
Figure 8: Distribution of item frequencies in each dataset.
Figure 9: Effect of the number of checkpoints in each smooth histogram on the performance of DPSW-Sketch.
Figure 10: Effect of the number of substreams in each window on the performance of DPSW-Sketch.
Figure 11: Effect of the number of hash functions in each PCMS on the performance of DPSW-Sketch.
each substream from 0.02ğ‘¤to0.5ğ‘¤. Consequently, the number of
substreams in each window is set to {2,5,10,15,20,30,50}. We find
that, as the number of substreams increases, the MAE first decreases,
reaching its lowest point around 10substreams per window, and
then increases. On the one hand, the misalignment between the
current window and the sketch used for query processing increases
the MAE when the length of a substream is too large. On the other
hand, the restriction on the total sketch size makes the size of each
PCMS smaller when the length of a substream is too small, thus
leading to more hash collisions and a higher MAE.Figure 11 shows how the values of ğ‘andğ‘for each PCMS affect
the MAE for frequency estimation of DPSW-Sketch. We also fix
ğœ€=1,|ğ¼|=3, and the length of each substream to 0.1ğ‘¤. Then,
by limiting the total sketch size to 100KB, we vary the number
ğ‘of hash functions in each PCMS from 2to10and, accordingly,
the range of each hash function from 5,000to1,000. The results
show that no single value of ğ‘guarantees good performance in all
datasets because each dataset has a different frequency distribution
of items and domain size. Since the MAE does not decrease when
ğ‘>5in most cases, we only use ğ‘=2,3,4,5in the experiments.
3266