Is Aggregation the Only Choice? Federated Learning via
Layer-wise Model Recombination
Ming Hu
hu.ming.work@gmail.com
Singapore Management University
Singapore, SingaporeZhihao Yue
51215902034@stu.ecnu.edu.cn
East China Normal University
Shanghai, ChinaXiaofei Xie
xfxie@smu.edu.sg
Singapore Management University
Singapore, Singapore
Cheng Chen
chchen@sei.ecnu.edu.cn
East China Normal University
Shanghai, ChinaYihao Huang
huangyihao22@gmail.com
Nanyang Technological University
Singapore, SingaporeXian Wei
xwei@sei.ecnu.edu.cn
East China Normal University
Shanghai, China
Xiang Lian
xlian@kent.edu
Kent State University
Ohio, USAYang Liu
yangliu@ntu.edu.sg
Nanyang Technological University
Singapore, SingaporeMingsong Chenâˆ—
mschen@sei.ecnu.edu.cn
East China Normal University
Shanghai, China
Abstract
Although Federated Learning (FL) enables global model training
across clients without compromising their raw data, due to the un-
evenly distributed data among clients, existing Federated Averaging
(FedAvg)-based methods suffer from the problem of low inference
performance. Specifically, different data distributions among clients
lead to various optimization directions of local models. Aggregat-
ing local models usually results in a low-generalized global model,
which performs worse on most of the clients. To address the above
issue, inspired by the observation from a geometric perspective
that a well-generalized solution is located in a flat area rather than
a sharp area, we propose a novel and heuristic FL paradigm named
FedMR (Federated Model Recombination). The goal of FedMR is
to guide the recombined models to be trained towards a flat area.
Unlike conventional FedAvg-based methods, in FedMR, the cloud
server recombines collected local models by shuffling each layer of
them to generate multiple recombined models for local training on
clients rather than an aggregated global model. Since the area of the
flat area is larger than the sharp area, when local models are located
in different areas, recombined models have a higher probability of
locating in a flat area. When all recombined models are located in
the same flat area, they are optimized towards the same direction.
We theoretically analyze the convergence of model recombination.
Experimental results show that, compared with state-of-the-art FL
methods, FedMR can significantly improve the inference accuracy
without exposing the privacy of each client.
âˆ—Corresponding author.
Permission to make digital or hard copies of all or part of this work for personal or
classroom use is granted without fee provided that copies are not made or distributed
for profit or commercial advantage and that copies bear this notice and the full citation
on the first page. Copyrights for components of this work owned by others than the
author(s) must be honored. Abstracting with credit is permitted. To copy otherwise, or
republish, to post on servers or to redistribute to lists, requires prior specific permission
and/or a fee. Request permissions from permissions@acm.org.
KDD â€™24, August 25â€“29, 2024, Barcelona, Spain.
Â©2024 Copyright held by the owner/author(s). Publication rights licensed to ACM.
ACM ISBN 979-8-4007-0490-1/24/08
https://doi.org/10.1145/3637528.3671722CCS Concepts
â€¢Computing methodologies â†’Distributed artificial intelligence .
Keywords
Federated Learning, Model Recombination, Non-IID, Generalization
ACM Reference Format:
Ming Hu, Zhihao Yue, Xiaofei Xie, Cheng Chen, Yihao Huang, Xian Wei,
Xiang Lian, Yang Liu, and Mingsong Chen. 2024. Is Aggregation the Only
Choice? Federated Learning via Layer-wise Model Recombination. In Pro-
ceedings of the 30th ACM SIGKDD Conference on Knowledge Discovery and
Data Mining (KDD â€™24), August 25â€“29, 2024, Barcelona, Spain. ACM, New
York, NY, USA, 12 pages. https://doi.org/10.1145/3637528.3671722
1 Introduction
Federated Learning (FL) [ 25,32,40] has been widely acknowledged
as a promising means to design large-scale distributed Artificial
Intelligence (AI) applications, e.g., Artificial Intelligence of Things
(AIoT) systems [ 13,37,47], healthcare systems [ 2,46], and recom-
mender systems [ 35,42]. Unlike conventional Deep Learning (DL)
methods, the cloud-client architecture based FL supports the col-
laborative training of a global DL model among clients without
compromising their raw data [ 3]. In each FL training round, the
cloud server first dispatches the global model to its selected clients
for local training and then gathers the corresponding gradients of
trained models from clients for aggregation. In this way, clients can
train a global model without sharing data.
Although FL enables effective collaborative training among mul-
tiple clients while protecting data privacy, existing FL methods
suffer from the problem of â€œweight divergenceâ€ [ 21]. Especially
when the data on the clients are non-IID (Identically and Indepen-
dently Distributed) [ 1,38], the optimal directions of local models
on clients and the aggregated global model on the cloud server
are significantly inconsistent, resulting in serious inference per-
formance degradation of the global model. To improve FL per-
formance in non-IID scenarios, various FL methods have been
studied, e.g., client grouping-based methods [ 45], global control
 
1096
KDD â€™24, August 25â€“29, 2024, Barcelona, Spain. Ming Hu et al.
variable-based methods [ 17,22,28], Knowledge Distillation (KD)-
based methods[ 30,39,48], and mutation-based methods [ 14]. The
basic ideas of these solutions are to guide the local training on
clients [ 17,22] or adjust parameter weights for model aggrega-
tion [30, 48].
Although these methods are promising in alleviating the impact
of data heterogeneity, most of them adopt the well-known Feder-
ated Averaging (FedAvg)-based paradigm, which may potentially
reduce generalization performance. This is mainly because FedAvg
paradigm only aggregates the parameters of collected local mod-
els and initializes local training by clients with the same global
models. Specifically, since the data distribution among clients is
different, the optimal directions of the local models are diverse.
On the one hand, although the aggregation operation can achieve
knowledge sharing among multiple local models, it can still neglect
the specific knowledge learned by local models, which seriously
limits the inference performance of the global model. On the other
hand, since FedAvg only uses the same global model for local train-
ing, FL training inevitably results in notorious stuck-at-local-search
problems during local training. As a result, the global model based
on simple statistical averaging cannot accurately reflect both in-
dividual efforts and the potential of local models in the search for
optimal global models. Therefore, how to overcome the shortcomings
of the FedAvg-based paradigm and improve the performance of FL in
non-IID scenarios is an important challenge.
Some recent research on model training indicates that, from
the perspective of the loss landscapes of DL models, optimal solu-
tions with well generalization performance often lie in flat valleys,
while the inferior ones are always located in sharp ravines [ 11,24].
Inspired by the above observation, to collaboratively train a well-
generalized model, FL needs to guide the local training towards a
more flat area. Since the direction of gradient descent is stochastic,
compared to using the same global model, using multiple global
models for local training has a greater probability that the existing
model can optimize to a flatter area. Since flat areas are usually
larger than sharp areas, intuitively, the exchange of the correspond-
ing parameters among multiple models rather than aggregation
can allow them to be displaced in the solution space. When a model
is stuck in a sharp area, the parameter exchange may make it es-
cape from the sharp area. With continuous training and parameter
exchange, when multiple models are located in the same flat area,
these models will optimize in the same direction, that is, the center
of the flat area.
Inspired by the above intuition, this paper proposes a novel FL
paradigm called FedMR (Federated Model Recombination), which
can effectively help the training of local models escape from sharp
area. Unlike FedAvg that aggregates all the collected local models in
each FL training round, FedMR randomly shuffles the parameters of
different local models within the same layers, and recombines them
to form new local models. In this way, FedMR can derive diversified
models that can effectively escape local optimal solutions for the
local training of clients. The main contributions of this paper can
be summarized as follows:
â€¢We propose a novel FL paradigm named FedMR, which con-
tains a newly layer-wise model recombination method to
replace the traditional FedAvg-based model aggregation with
the aim of improving FL inference performance.â€¢We introduce a two-stage training scheme for FedMR, which
combines the merits of both model recombination and ag-
gregation to accelerate the overall FL training process.
â€¢We theoretically prove the convergence of FedMR in convex
scenarios and conduct empirical experiments to validate the
convergence of FedMR in non-convex scenarios.
â€¢We conduct extensive experiments on various well-known
models and datasets to show both the effectiveness and com-
patibility of FedMR.
2 Related Work
To address the problem of uneven data distributions, exiting so-
lutions can be mainly classified into four categories, i.e., client
grouping-based methods, global control variable-based methods,
knowledge distillation-based methods, and mutation-based meth-
ods. The device grouping-based methods group and select clients for
aggregation based on the data similarity between clients. For ex-
ample, FedCluster [ 8] divides clients into multiple clusters and per-
forms multiple cycles of meta-update to boost the overall FL conver-
gence. Based on either sample size or model similarity, CluSamp [ 9]
groups clients to achieve a better client representativity and a re-
duced variance of client stochastic aggregation parameters in FL.
By modifying the penalty terms of loss functions during FL training,
theglobal control variable-based methods can be used to smooth
the FL convergence process. For example, FedProx [ 28] regularizes
local loss functions with the squared distance between local models
and the global model to stabilize the model convergence. Similarly,
SCAFFOLD [ 22] uses global control variables to correct the â€œclient-
driftâ€ problem in the local training process. Knowledge Distillation
(KD)-based methods adopt soft targets generated by the â€œteacher
modelâ€ to guide the training of â€œstudent modelsâ€. For example, by
leveraging a proxy dataset, Zhu et al. [ 48] proposed a data-free
knowledge distillation method named FedGen to address the het-
erogeneous FL problem using a built-in generator. With ensemble
distillation, FedDF [ 30] accelerates the FL training by training the
global model through unlabeled data on the outputs of local models.
Mutation-based methods attempt to mutate the global model to gen-
erate multiple mutated intermediate models for local training. For
example, FedMut [ 14] utilizes the gradients to mutate the global
model and dispatches the mutated models for local training.
Although the above methods can optimize FL performance from
different perspectives, since coarse-grained model aggregation is
performed, the inference capabilities of local models are still strongly
restricted. Furthermore, most of them cannot avoid non-negligible
communication and computation overheads or the risk of data
privacy exposure. In addition, many FL methods have been pro-
posed to address device heterogeneity problems. To effectively
train on devices with different hardware resources, some meth-
ods [ 4,18,20,41] utilize heterogeneous models for local training.
To avoid stragglers caused by uneven computing capability or un-
certainty [ 15], existing methods [ 16,44] attempt to perform a wise
client scheduling to achieve asynchronous FL training. Note that
this paper only focuses on the data heterogeneity problem.
To the best of our knowledge, FedMR is the first attempt using
model recombination rather than aggregation for FL. Since FedMR
considers the specific characteristics and efforts of local models, it
 
1097Is Aggregation the Only Choice? Federated Learning via Layer-wise Model Recombination KDD â€™24, August 25â€“29, 2024, Barcelona, Spain.
can further mitigate the weight divergence problem, thus achieving
better inference performance than state-of-the-art FL methods.
3 Motivation
3.1 Intuition
Comparison between FedAvg and Independent Training. Fig-
ure 1 illustrates the FL training processes on the same loss landscape
using FedAvg and Independent training (Indep), respectively, where
the server of Indep just shuffles the received local models and then
randomly dispatches them to clients without aggregation. In each
subfigure, the local optima are located within the areas surrounded
by solid red lines. Note that since the upper surrounded area is
flatter than the lower surrounded area in the loss landscape, the
solutions within it will exhibit better generalization.
LocalModelGlobalModelLocalTraining
(a)FedAvg(b)IndependentTraining
Figure 1: Training processes on the same loss landscape.
As shown in Figure 1(a), along with the training process, the
aggregated global models denoted by red circles gradually move
toward the lower sharp area with inferior solutions, though the op-
timizations of some local models head toward the upper surrounded
area with better solutions. Such biased training is mainly because
the local training starts from the same global model in each FL
round. As an alternative, due to the lack of aggregation operation,
the local models of Indep may converge in different directions as
shown in Figure 1(b). In this case, even if some local training in
Idep achieves a better solution than the one obtained by FedAvg,
due to the diversified optimization directions of local models, such
an important finding can be eclipsed by the results of other local
models. Clearly, there is a lack of mechanisms for Indep that can
guide the overall training toward such superior solutions.
Intuition of Model Recombination. Based on the Indep train-
ing results shown in Figure 1(b), Figure 2 illustrates the intuition
of our model recombination method, where the FL training starts
from the three local models (denoted by yellow diamonds in round
1) obtained in figure 1(b). At the beginning of round 1, two of the
three local models are located in the sharp ravine. In other words,
without model recombination, the training of such two local mod-
els may get stuck in the lower surrounded area. However, due to
the weight adjustment by shuffling the layers among local models,
we can find that the three recombined models (denoted by yellow
squares) are sparsely scattered in the loss landscape, which enables
the local training escape from local optima. According to [ 10,43],
a small perturbation of the model weights can make it easier for
ModelRecombinationModelRecombinationModelRecombinationLocalModelRecombinedModelLocalTrainingModelRecombination
Round1Round2Round3Figure 2: An example of model recombination.
local training to jump out of sharp ravines rather than flat valleys.
In other words, the recombined models are more likely to converge
toward flat valleys along the local training. For example, in the end
of round 3, we can find that all three local models are located in the
upper surrounded area, where their aggregated model has better
generalization performance than the one achieved in Figure 1(a).
â€¦â€¦ğ’ğŸ"ğ’ğŸ"ğ’ğ‘²"ğ’ğŸğ’ğŸğ’ğ‘²Shuffle
ModelModelModelDataDataDataLocalModelLocalModelLocalModelClientğŸClientğŸClientğ‘²ModelRecombinationModelDispatchingModelUpload123
LocalClientsâ€¦CloudServerUploadedModelsRecombinedModelsGlobalModelFLTrainingProcess
ModelDeploymentAggregation
Figure 3: Our FedMR approach
4 FedMR Approach
4.1 Overview of FedMR
Figure 3 presents the framework and workflow of FedMR, which
consists of two process, i.e., FL training process and the model
deployment process. In FL training process, unlike FedAvg-based
methods that use the same global model for local training, FedMR
adopts multiple homogeneous intermediate models for local train-
ing, where each client model is dispatched one model. Specifically,
each training round involves three specific steps as follows:
â€¢Step 1 (Model Dispatching): The cloud server dispatches
ğ¾intermediate models to ğ¾selected clients, respectively,
according to their indices, where ğ¾denotes the number of
activated clients participating in each FL training round.
Note that in FedMR different clients will receive different
models for the local training.
â€¢Step 2 (Model Upload): Once its local training is finished,
a client needs to upload the parameters of its newly updated
local model to the cloud server.
â€¢Step 3 (Model Recombination): The cloud server decom-
poses received local models into multiple layers individually
in the same manner and conducts the random shuffling of
 
1098KDD â€™24, August 25â€“29, 2024, Barcelona, Spain. Ming Hu et al.
Algorithm 1 Implementation of FedMR
Input: i)ğ‘Ÿğ‘›ğ‘‘, # of training rounds; ii) ğ‘†ğ‘, the set of clients; iii) ğ¾, #
of clients participating in each FL round.
Output:ğ‘¤ğ‘”ğ‘™ğ‘, the parameters of trained global model.
FedMR(ğ‘Ÿğ‘›ğ‘‘,ğ‘†ğ‘‘ğ‘’ğ‘£,ğ¾)
1:ğ¿ğ‘šâ†[ğ‘¤1
1,ğ‘¤2
1,...,ğ‘¤ğ¾
1]// initialize model list
2:forğ‘Ÿ= 1, ...,ğ‘Ÿğ‘›ğ‘‘do
3:ğ¿ğ‘Ÿâ†Random select ğ¾clients from ğ‘†ğ‘
/*parallel for block*/
4: forğ‘–= 1, ...,ğ¾do
5:ğ‘£ğ‘–
ğ‘Ÿ+1â†ClientUpdate(ğ¿ğ‘š[ğ‘–],ğ¿ğ‘Ÿ[ğ‘–])
6:ğ¿ğ‘š[ğ‘–]â†ğ‘£ğ‘–
ğ‘Ÿ+1
7: end for
8:[ğ‘¤1
ğ‘Ÿ+1,ğ‘¤2
ğ‘Ÿ+1,...,ğ‘¤ğ¾
ğ‘Ÿ+1]â†ModelRcombine (ğ¿ğ‘š)
9:ğ¿ğ‘šâ†[ğ‘¤1
ğ‘Ÿ+1,ğ‘¤2
ğ‘Ÿ+1,...,ğ‘¤ğ¾
ğ‘Ÿ+1]
10:end for
11:ğ‘¤ğ‘”ğ‘™ğ‘â†1
ğ¾Ãğ¾
ğ‘–=1ğ‘¤ğ‘–
ğ‘Ÿğ‘›ğ‘‘+1
12:returnğ‘¤ğ‘”ğ‘™ğ‘
the same layers among different local models. Then, by con-
catenating layers from different sources in order, a new local
model can be reconstructed. Note that any decomposed layer
of the uploaded model will eventually be used by one and
only one of the recombined models.
In the model deployment process, the cloud server aggregates
all the intermediate models to generate a global model and deploys
the global model to all the local clients for specific tasks.
4.2 Implementation of FedMR
Algorithm 1 details the implementation of FedMR. Line 1 initializes
the model list ğ¿ğ‘š, which includes ğ¾initial models. Lines 2-10 per-
formsğ‘Ÿğ‘›ğ‘‘rounds of FedMR training. In each round, Line 3 selects
ğ¾random clients to participate in the model training and creates
a client list ğ¿ğ‘Ÿ. Lines 4-7 conduct the local training on clients in
parallel, where Line 5 applies the local model ğ¿ğ‘š[ğ‘–]on clientğ¿ğ‘Ÿ[ğ‘–]
for local training by using the function ClientUpdate, and Line 6
achieves a new local model after the local training. After the cloud
server receives all the ğ¾local models, Line 8 uses the function
ModelRcombine to recombine local models and generate ğ¾new
local models, which are saved in ğ¿ğ‘šas shown in Line 9. Finally,
Lines 11-12 will report an optimal global model that is generated
based onğ¿ğ‘š. Note that the cloud server will dispatch the global
model to all the clients for the purpose of inference rather than
local training. The following parts will detail the key components
of FedMR. Since FedMR cannot adapt to the secure aggregation
mechanism [ 5], to further protect privacy, we present an extended
secure recombination mechanism in Appendix B, which enables
the exchange of partial layers among clients before local training
or model uploading to ensure that the cloud server cannot directly
obtain the gradients of each local model.
4.2.1 Local Model Training. Unlike conventional FL methods that
conduct local training on clients starting from the same aggregated
model, in each training round FedMR uses different recombined
models (i.e., ğ¾models in the model list ğ¿ğ‘š) for the local training
â€¦ğ’ğŸğ’ğŸğ’ğ‘²ğ’ğŸ"ğ’ğŸ"ğ’ğ‘²"â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦Shuffleğ‘™!"!ğ‘™#"!ğ‘™$"!ğ‘™%"!ğ‘™!""ğ‘™#""ğ‘™$""ğ‘™%""ğ‘™!"#ğ‘™#"#ğ‘™$"#ğ‘™%"#ğ‘™ğ‘–ğ‘ ğ‘¡!ğ‘™ğ‘–ğ‘ ğ‘¡"ğ‘™ğ‘–ğ‘ ğ‘¡#ğ‘™ğ‘–ğ‘ ğ‘¡$(b)ExampleofModelRecombinationâ€¦ğ’ğŸğ’ğŸğ’ğ‘²ğ’ğŸ"ğ’ğŸ"ğ’ğ‘²"â€¦â€¦â€¦â€¦â€¦Aggregationğ‘™!"!ğ‘™#"!ğ‘™$"!ğ‘™%"!ğ‘™!""ğ‘™#""ğ‘™$""ğ‘™%""ğ‘™!"#ğ‘™#"#ğ‘™$"#ğ‘™%"#ğ‘™ğ‘–ğ‘ ğ‘¡!ğ‘™ğ‘–ğ‘ ğ‘¡"ğ‘™ğ‘–ğ‘ ğ‘¡#ğ‘™ğ‘–ğ‘ ğ‘¡$(a)ExampleofModelAggregationFigure 4: Example of model aggregation and recombination
purpose. Note that, in the whole training phase, FedMR only uses
ğ¾(ğ¾â‰¤|ğ‘†ğ‘|) models, since there are only ğ¾devices activated in
each training round. Let ğ‘¤ğ‘ğ‘Ÿbe the parameters of some model that
is dispatched to the ğ‘ğ‘¡â„client in the ğ‘Ÿğ‘¡â„training round. In the ğ‘Ÿğ‘¡â„
training round, we dispatch the ğ‘–ğ‘¡â„model inğ¿ğ‘što its correspond-
ing client using ğ‘¤ğ¿ğ‘Ÿ[ğ‘–]
ğ‘Ÿ =ğ¿ğ‘š[ğ‘–]. Based on the recombined model,
FedMR conducts the local training on client ğ¿ğ‘Ÿ[ğ‘–]as follows:
ğ‘£ğ¿ğ‘Ÿ[ğ‘–]
ğ‘Ÿ+1=ğ‘¤ğ¿ğ‘Ÿ[ğ‘–]
ğ‘Ÿâˆ’ğœ‚âˆ‡ğ‘“ğ¿ğ‘Ÿ[ğ‘–](ğ‘¤ğ¿ğ‘Ÿ[ğ‘–]
ğ‘Ÿ),
ğ‘ .ğ‘¡., ğ‘“ğ¿ğ‘Ÿ[ğ‘–](ğ‘¤ğ¿ğ‘Ÿ[ğ‘–]
ğ‘Ÿ)=1
|ğ·ğ¿ğ‘Ÿ[ğ‘–]||ğ·ğ¿ğ‘Ÿ[ğ‘–]|âˆ‘ï¸
ğ‘—=1â„“(ğ‘¤ğ¿ğ‘Ÿ[ğ‘–]
ğ‘Ÿ ;ğ‘¥ğ‘—;ğ‘¦ğ‘—),
whereğ‘£ğ¿ğ‘Ÿ[ğ‘–]
ğ‘Ÿ indicates parameters of the trained local model, ğ·ğ¿ğ‘Ÿ[ğ‘–]
denotes the dataset of client ğ¿ğ‘Ÿ[ğ‘–],ğœ‚is the learning rate, â„“(Â·)is the
loss function, ğ‘¥ğ‘—is theğ‘—ğ‘¡â„sample inğ·ğ¿ğ‘Ÿ[ğ‘–], andğ‘¦ğ‘—is the label of
ğ‘¥ğ‘—. Once the local training is finished, the client needs to upload the
parameters of its trained local model to the cloud server by updating
ğ¿ğ‘šusingğ¿ğ‘š[ğ‘–]=ğ‘£ğ¿ğ‘Ÿ[ğ‘–]
ğ‘Ÿ+1. Similar to traditional FL methods, in each
training round, FedMR needs to transmit the parameters of 2ğ¾
models between the cloud server and its selected clients.
4.2.2 Model Recombination. Typically, a DL model consists of mul-
tiple layers, e.g., convolutional layers, pooling layers, and Fully
Connected (FC) layers. To simplify the description of our model
recombination method, we do not explicitly present the layer types
here. Letğ‘¤ğ‘¥={ğ‘™ğ‘¥
1,ğ‘™ğ‘¥
2,...,ğ‘™ğ‘¥ğ‘›}be the parameters of model ğ‘¥, where
ğ‘™ğ‘¥
ğ‘–(ğ‘–âˆˆ[ğ‘›]) denotes the parameters of the ğ‘–ğ‘¡â„layer of model ğ‘¥.
In each FL round, FedMR needs to perform model recombina-
tion based on ğ¿ğ‘što obtain new models for local training. Figure 4
presents an example of model aggregation and model recombina-
tion. When clients receive all the trained local models (i.e., ğ‘š1,
ğ‘š2, ...,ğ‘šğ¾), the cloud server needs to decouple the layers of these
models individually. Note that since all the local models are ho-
mogeneous, the corresponding layers of the local models have the
 
1099Is Aggregation the Only Choice? Federated Learning via Layer-wise Model Recombination KDD â€™24, August 25â€“29, 2024, Barcelona, Spain.
same structure. For example, the model ğ‘š1can be decomposed
into four layers. Assuming that the local models are with an ar-
chitecture of ğ‘¤, to enable recombination, FedMR then constructs
ğ‘›lists, where the ğ‘˜ğ‘¡â„(ğ‘˜âˆˆ[ğ‘›]) list contains all the ğ‘˜ğ‘¡â„layers of
the models in ğ¿ğ‘š. As an example shown in Figure 4(b), FedMR
constructs four lists (i.e., ğ‘™ğ‘–ğ‘ ğ‘¡ 1-ğ‘™ğ‘–ğ‘ ğ‘¡ 4) for theğ¾models (i.e., ğ‘š1-ğ‘šğ¾),
where each list consists of ğ¾elements (i.e., ğ¾layers with the same
index). After shuffling each list, FedMR generates |ğ¿ğ‘š|recombined
models based on shuffled results. For example, the top three layers
of the recombined model ğ‘šâ€²
1come from the models ğ‘š1,ğ‘š2and
ğ‘šğ¾, respectively. For comparison, Figure 4(a) presents an example
of model aggregation, which aggregates the layers of each list to
generate an aggregated model. The aggregation-based methods dis-
patch the aggregated model to ğ¾clients, while FedMR dispatches a
different recombined model to each client.
4.3 Two-Stage Training Scheme for FedMR
Although FedMR enables finer FL training, when starting from
blank models, FedMR converges more slowly than traditional FL
methods at the beginning. This is mainly because, due to the low
matching degree between layers in the recombined models, the
model recombination operation in this stage requires more local
training time to re-construct the new dependencies between layers.
To accelerate the overall convergence, we propose a two-stage
training scheme for FedMR, consisting of the aggregation-based pre-
training stage andmodel recombination stage. In the first stage, we
train the local models coarsely using the FedAvg-based aggregation,
which can quickly form a pre-trained global model. In the second
stage, from the pre-trained models, FedMR dispatches recombined
models to clients for local training. Due to the synergy of both FL
paradigms, the overall FedMR training time can be reduced.
4.4 Convergence Analysis
Based on the assumptions posed on the loss functions of local clients
in FedAvg [ 29], this subsection performs the convergence analysis
for FedMR.
Assumption 4.1. Forğ‘–âˆˆ{1,2,Â·Â·Â·,ğ¾},ğ‘“ğ‘–is L-smooth satisfying
||âˆ‡ğ‘“ğ‘–(ğ‘¥)âˆ’âˆ‡ğ‘“ğ‘–(ğ‘¦)||â‰¤ğ¿||ğ‘¥âˆ’ğ‘¦||.
Assumption 4.2. Forğ‘–âˆˆ{1,2,Â·Â·Â·,ğ¾},ğ‘“ğ‘–isğœ‡-strongly convex
satisfyingğ‘“(ğ‘¥)â‰¥ğ‘“(ğ‘¦)+(ğ‘¥âˆ’ğ‘¦)ğ‘‡âˆ‡ğ‘“(ğ‘¦)+ğœ‡
2||ğ‘¥âˆ’ğ‘¦||2, whereğœ‡â‰¥0.
Assumption 4.3. The variance of stochastic gradients is upper
bounded by ğœƒ2, and the expectation of squared norm of stochastic
gradients is upper bounded by ğº2, i.e.,E||âˆ‡ğ‘“ğ‘˜(ğ‘¤;ğœ‰)âˆ’âˆ‡ğ‘“ğ‘˜(ğ‘¤)||2â‰¤
ğœƒ2,E||âˆ‡ğ‘“ğ‘˜(ğ‘¤;ğœ‰)||2â‰¤ğº2, whereğœ‰is a data batch of the ğ‘˜ğ‘¡â„client
in theğ‘¡ğ‘¡â„FL round.
Based on the implementation of function ModelRecombine(Â·), we
derive the following two lemmas for the model recombination:
Lemma 4.4. Assume that in FedMR there are ğ¾clients participating
in every FL training round. Let {ğ‘£1ğ‘Ÿ,ğ‘£2ğ‘Ÿ,..,ğ‘£ğ¾ğ‘Ÿ}and{ğ‘¤1ğ‘Ÿ,ğ‘¤2ğ‘Ÿ,..,ğ‘¤ğ¾ğ‘Ÿ}be
the set of trained local model weights and the set of recombined model
weights generated in the (ğ‘Ÿâˆ’1)ğ‘¡â„round, respectively. Assume ğ‘¥is a
vector with the same size as that of ğ‘£ğ‘˜ğ‘Ÿ. We have
ğ¾âˆ‘ï¸
ğ‘˜=1ğ‘£ğ‘˜
ğ‘Ÿ=ğ¾âˆ‘ï¸
ğ‘˜=1ğ‘¤ğ‘˜
ğ‘Ÿ,ğ‘ğ‘›ğ‘‘ğ¾âˆ‘ï¸
ğ‘˜=1||ğ‘£ğ‘˜
ğ‘Ÿâˆ’ğ‘¥||2=ğ¾âˆ‘ï¸
ğ‘˜=1||ğ‘¤ğ‘˜
ğ‘Ÿâˆ’ğ‘¥||2.We prove Theorem 1 based on Lemmas 4.4. Please refer to Ap-
pendix A for the proof. Note that different from FedAvg, Lemmas 4.4
is the key lemma for the proof of FedMR.
Theorem 1. (Convergence of FedMR) Let Assumption 4.1, 4.2, and
4.3 hold. Assume that ğ¸is the number of SGD iterations conducted
within one FL round, model recombination is conducted at the end of
each FL round, and the whole training terminates after ğ‘›FL rounds.
Letğ‘‡=ğ‘›Ã—ğ¸be the total number of SGD iterations conducted so far,
andğœ‚ğ‘˜=2
ğœ‡(ğ‘‡+ğ›¾)be the learning rate. We can have
E[ğ‘“(ğ‘¤ğ‘‡)]âˆ’ğ‘“â˜…â‰¤ğ¿
2ğœ‡(ğ‘‡+ğ›¾)[4ğµ
ğœ‡+ğœ‡(ğ›¾+1)
2Î”1],
whereğµ=10ğ¿Î“+4(ğ¸âˆ’1)2ğº2,ğ‘¤ğ‘‡=Ãğ¾
ğ‘˜=1ğ‘¤ğ‘˜
ğ‘‡.
Theorem 1 indicates that the difference between the current
lossğ‘“(ğ‘¤ğ‘‡)and the optimal loss ğ‘“â˜…is inversely related to ğ‘¡. From
Theorem 1, we can find that the convergence rate of FedMR is
similar to that of FedAvg, which has been analyzed in [29].
5 Experimental Results
5.1 Experimental Settings
To evaluate the effectiveness of FedMR, we implemented FedMR on
top of a cloud-based architecture. Since it is impractical to allow all
the clients to get involved in the training processes simultaneously,
we assumed that there are only 10% of clients participating in the
local training in each FL round. To enable fair comparison, all the
investigated FL methods including FedMR set SGD optimizer with
a learning rate of 0.01 and a momentum of 0.9. For each client, we
set the batch size of local training to 50, and performed five epochs
for each local training. All the experimental results were obtained
from an Ubuntu workstation with Intel i9 CPU, 32GB memory, and
NVIDIA RTX 3080 GPU.
Baseline Method Settings. We compared the test accuracy of
FedMR with seven baseline methods, i.e., FedAvg [ 32], FedProx [ 28],
FedGen [ 48], CluSamp [ 9], FedExP [ 19], FedASAM [ 6], and Fed-
Mut [14]. Here, FedAvg is the most classical FL method, while the
other five methods are state-of-the-art (SOTA) representations of
the four kinds of FL optimization methods introduced in the re-
lated work section. Specifically, FedProx, FedExP, and FedASAM are
global control variable-based methods, FedGen is a KD-based ap-
proach, CluSamp is a device grouping-based method, and FedMut is
a mutation-based method. For FedProx, we used a hyper-parameter
ğœ‡to control the weight of its proximal term, where the best values
ofğœ‡for CIFAR-10, CIFAR-100, and FEMNISTvare 0.01, 0.001, and
0.1, respectively. For FedGen, we adopted the same server settings
in [48]. For CluSamp, the clients were clustered based on the model
gradient similarity described in [9].
Dataset Settings. We investigated the performance of our ap-
proach on three well-known datasets, i.e., CIFAR-10, CIFAR-100
[23], and FMNIST [ 7]. We adopted the Dirichlet distribution [ 12]
to control the heterogeneity of client data for both CIFAR-10 and
CIFAR-100. Here, the notation ğ·ğ‘–ğ‘Ÿ(ğ›¼)indicates a different Dirich-
let distribution controlled by ğ›¼, where a smaller ğ›¼means higher
data heterogeneity of clients. Note that, different from datasets
CIFAR-10 and CIFAR-100, the raw data of FEMNIST are naturally
 
1100KDD â€™24, August 25â€“29, 2024, Barcelona, Spain. Ming Hu et al.
non-IID distributed. Since FEMNIST takes various kinds of data het-
erogeneity into account, we did not apply the Dirichlet distribution
on FEMNIST. For both CIFAR-10 and CIFAR-100, we assumed that
there are 100 clients in total participating in FL. For FEMNIST, we
only considered one non-IID scenario involving 180 clients, where
each client hosts more than 100 local data samples.
Model Settings. To demonstrate the pervasiveness of our ap-
proach, we developed different FedMR implementations based on
three different models (i.e., CNN, ResNet-20, VGG-16). Here, we
obtained the CNN model from [ 32], which consists of two convo-
lutional layers and two FC layers. When conducting FedMR based
on the CNN model, we directly applied the model recombination
for local training on it without pre-training a global model, since
CNN here only has four layers. We obtained both ResNet-20 and
VGG-16 models from Torchvision [ 36].Â·When performing FedMR
based on ResNet-20 and VGG-16, due to the deep structure of both
models, we adopted the two-stage training scheme, where the first
stage lasts for 100 rounds to obtain a pre-trained global model.
5.2 Validation for Intuitions
Independent Training. Based on the settings presented in Sec-
tion 5.1, we conducted the experiments to evaluate the effectiveness
of each local model in Indep. The FL training is based on the ResNet-
20 model and dataset CIFAR-10, where we set ğ›¼=0.5for non-IID
scenarios. Figures 5 compares Indep with FedAvg from the per-
spectives of both test loss and inference accuracy. Due to the space
limitation, for Indep here we only present the results of its four
random local models (denoted by Model-1, Model-2, Model-3, and
Model-4). To enable a fair comparison with FedAvg, although there
is no aggregated global model in Indep, we considered the aggre-
gated model of all its local models for each FL round, whose results
are indicated by the notion â€œIndepAggrâ€. From Figure 5, we can
find all the local models in Indep can achieve higher accuracy and
lower loss than those of FedAvg, though their loss and accuracy
curves fluctuate more sharply. Moreover, IndepAggr exhibits much
worse performance than the other references. This is mainly be-
cause, according to the definition of Indep, each local model needs
to traverse multiple clients along with the FL training processes,
where the optimization directions of client models differ in the
corresponding loss landscape.
 0 1 2 3 4 5 6 7 8 9 10
 0 100  200  300  400  500  600  700  800  900  1000Loss
Communication RoundsFedAvg
Model-1
Model-2
Model-3
Model-4
IndepAggr
(a) Test Loss
 10 20 30 40 50 60 70
 0 100  200  300  400  500  600  700  800  900  1000Accuracy (%)
Communication RoundsFedAvg
Model-1
Model-2
Model-3
Model-4
IndepAggr (b) Accuracy
Figure 5: FedAvg vs. Indep.
Model Recombination. To validate the intuition about the
impacts of model recombination as presented in Section 3, we con-
ducted three experiments on CIFAR-10 dataset using ResNet-20model. Our goal is to figure out the following three questions: i)
by using model recombination, can all the models eventually have
the same optimization direction; ii) compared with FedAvg, can the
global model of FedMR eventually converge into a more flat solu-
tion; and iii) can the global model of FedMR eventually converge
to a more generalized solution?
 0.95 0.96 0.97 0.98 0.99 1
 0 200  400  600  800  1000  1200  1400  1600  1800  2000Similarity
Communication RoundsDir(0.1)
Dir(0.5)
Dir(1.0)
IID
Figure 6: Cosine similarity of local models in FedMR.
Figure 6 presents the average cosine similarity between all the
intermediate models, taking four different client data distributions
into account. We can observe that the model similarity decreases
first and gradually increases in all the investigated IID and non-IID
scenarios. Due to the nature of Stochastic Gradient Descent (SGD)
mechanism and the data heterogeneity among clients, all local
models are optimized toward different directions at the beginning of
training. However, as the training progresses, most local models will
be located in the same flat valleys, leading to similar optimization
directions for local models. These results are consistent with our
intuition as shown in Figure 2.
246810
(a) FedAvg w/ ğ›¼=0.1
246810 (b) FedMR w/ ğ›¼=0.1
246810
(c) FedAvg w/ ğ›¼=1.0
246810 (d) FedMR w/ ğ›¼=1.0
Figure 7: Comparison of loss landscapes with different FL
and client data settings.
Figure 7 compares the loss landscapes of final global models
obtained by FedAvg and FedMR with different client data settings,
respectively. We can find that, compared with FedMR counterparts,
 
1101Is Aggregation the Only Choice? Federated Learning via Layer-wise Model Recombination KDD â€™24, August 25â€“29, 2024, Barcelona, Spain.
 0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5
 0 200  400  600  800  1000  1200  1400  1600  1800  2000Loss
Communication RoundsFedAvg
FedMR
(a)ğ›¼=0.1
 0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5
 0 200  400  600  800  1000  1200  1400  1600  1800  2000Loss
Communication RoundsFedAvg
FedMR (b)ğ›¼=0.5
 0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5
 0 200  400  600  800  1000  1200  1400  1600  1800  2000Loss
Communication RoundsFedAvg
FedMR
(c)ğ›¼=1.0
 0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5
 0 200  400  600  800  1000  1200  1400  1600  1800  2000Loss
Communication RoundsFedAvg
FedMR (d) IID
Figure 8: Comparison of test losses of FedAvg and FedMR
with different client data settings.
the global models trained by FedAvg are located in sharper solutions,
indicating the generalization superiority of final global models
achieved by FedMR.
Figure 8 compares the test losses for the global models of FedAvg
and FedMR (without using two-stage training) within different
IID and non-IID scenarios. Note that here, the global models of
FedMR are only for the purpose of fair comparison rather than
local model initialization. Due to the superiority in generalization,
we can observe that the models trained by FedMR outperform those
by FedAvg for all four cases.
5.3 Performance Comparison
We compared the performance of our FedMR approach with seven
SOTA baselines. For datasets CIFAR-10 and CIFAR-100, we consid-
ered both IID and non-IID scenarios (with ğ›¼=0.1,0.5,1.0, respec-
tively). For dataset FEMNIST, we considered its original non-IID
settings [7].
5.3.1 Comparison of Test Accuracy. Table 1 compares FedMR with
the SOTA FL methods, considering both non-IID and IID scenarios
based on three different DL models. The first two columns denote
the model type and dataset type, respectively. Note that to enable
fair comparison, we cluster the test accuracy results generated
by the FL methods based on the same type of local models. The
third column shows different distribution settings for client data,
indicating the data heterogeneity of clients. The fourth column has
eight sub-columns, which present the test accuracy information
together with its standard deviation for all the investigated FL
methods, respectively.
From Table 1, we can observe that FedMR can achieve the highest
test accuracy in all the scenarios regardless of model type, dataset
type, and data heterogeneity. For CIFAR-10 and CIFAR-100, we can
find that FedMR outperforms the seven baseline methods signifi-
cantly in both non-IID and IID scenarios. For example, when dealingwith a non-IID CIFAR-10 scenario ( ğ›¼=0.1) using ResNet-20-based
models, FedMR achieves test accuracy with an average of 58.40%,
while the second highest average test accuracy obtained by FedMut
is only 50.75%. Note that the performance of FedMR on FEMNIST
is not as notable as the one on both CIFAR-10 and CIFAR-100. This
is mainly because the classification task on FEMNIST is much sim-
pler than the ones applied on datasets CIFAR-10 and CIFAR-100,
which leads to the high test accuracy of the seven baseline methods.
However, even in this case, FedMR can still achieve the best test
accuracy among all the investigated FL methods.
5.3.2 Comparison of Model Convergence. Figure 9 presents the
convergence trends of the seven FL methods (including FedMR)
on the CIFAR-100 dataset. Note that here the training of FedMR is
based on our proposed two-stage training scheme, where the first
stage uses 100 FL training rounds to achieve a pre-trained model.
Here, to enable fair comparison, the test accuracy of FedMR at some
FL training rounds is calculated by an intermediate global model,
which is an aggregated version of all the local models within that
round. The four sub-figures show the results for different data dis-
tributions of clients. This figure shows that FedMR outperforms the
other six FL methods consistently in both non-IID and IID scenarios.
This is mainly because FedMR can easily escape from the stuck-at-
local-search due to the model recombination operation in each FL
round. Moreover, due to the fine-grained training, we can observe
that the learning curves in each sub-figure are much smoother
than the ones of other FL methods. We also compared CNN- and
VGG-16-based FL methods and found similar observations.
5.4 Ablation Study
5.4.1 Impacts of Activated Clients . Figure 10 compares the learn-
ing trends between FedMR and six baselines for a non-IID scenario
(ğ›¼=0.1) with both ResNet-20 model and CIFAR-10 dataset, where
the numbers of activated clients are 5,10,20,50, and 100, respec-
tively. From Figure 10, we can observe that FedMR achieves the
best inference performance for all cases. We can also observe that
too few activated clients (i.e., ğ¾=5) result in a degradation of the
accuracy of the global model in all the FL methods. We find that
when the number of activated clients increases, the convergence
fluctuations reduce significantly and FedMR achieves the smallest
fluctuations compared to all the baselines for all cases.
5.4.2 Impacts of Model Layer Partitioning. To show the effective-
ness of our layer-wise model recombination scheme, we evaluated
the FedMR performance using different model layer partitioning
strategies. We use â€œFedMR-p ğ‘¥â€ to denote that the model is divided
intoâŒˆ1
ğ‘¥âŒ‰(ğ‘¥âˆˆ(0,1.0]) segments, where the model recombination
is based on segments rather than layers. Note that FedMR does
not divide a single layer into multiple segments. Instead, in FedMR
each segment involves multiple layers (i.e., one or more layers), and
the FedMR takes the recombination over segments among different
clients. Specifically, for the ğ‘—ğ‘¡â„layer, it belongs to âŒˆğ‘—
ğ‘¥Ã—ğ‘âŒ‰ğ‘¡â„seg-
ment. Since ğ‘¥âˆˆ(0,1.0], each segment contains at least one layer.
Note thatğ‘¥=1.0indicates an extreme case, where local models are
randomly dispatched to clients without recombination.
Figure 11 presents the ablation study results on CIFAR-10 dataset
using ResNet-20-based and VGG-16-based FedMR, where the data
 
1102KDD â€™24, August 25â€“29, 2024, Barcelona, Spain. Ming Hu et al.
Table 1: Test accuracy comparison for both non-IID and IID scenarios using three DL models
Model Datas.Heter. Test Accuracy (%)
Set. FedAvg FedProx FedGen CluSamp FedExP FedASAM FedMut FedMR
CNNCifar-100.150.66Â±1.1850.61Â±1.2150.27Â±2.0350.24Â±1.0453.20Â±1.3348.83Â±1.8652.88Â±0.5954.63Â±0.55
0.554.42Â±0.7654.28Â±1.2953.66Â±0.6855.07Â±0.9355.12Â±0.5752.02Â±0.4357.29Â±0.6159.81Â±0.60
1.057.03Â±0.6256.44Â±0.6856.19Â±0.5456.16Â±0.5657.12Â±0.3455.08Â±0.6158.88Â±0.4760.77Â±0.48
ğ¼ğ¼ğ· 57.21Â±0.2757.00Â±0.1157.35Â±0.1958.13Â±0.3557.05Â±0.1554.60Â±0.1158.81Â±0.2163.74Â±0.18
Cifar-1000.129.12Â±0.5229.44Â±0.7326.14Â±0.9228.51Â±1.1430.43Â±0.3928.95Â±0.4831.23Â±0.3534.47Â±0.54
0.532.41Â±0.7732.48Â±0.8129.19Â±0.6732.63Â±0.6033.12Â±0.5132.06Â±0.9834.46Â±0.6937.41Â±0.30
1.032.66Â±0.5133.10Â±0.4129.94Â±0.5132.65Â±0.4833.32Â±0.3832.45Â±0.6135.12Â±0.4239.15Â±0.30
ğ¼ğ¼ğ· 32.75Â±0.2032.57Â±0.2130.95Â±0.3232.77Â±0.1132.48Â±0.1432.35Â±0.2934.49Â±0.2340.64Â±0.17
FEMNISTâˆ’ 82.97Â±0.3783.15Â±0.4182.35Â±0.4082.31Â±0.3283.28Â±0.2983.49Â±0.2783.62Â±0.3383.76Â±0.24
ResNet-20Cifar-100.142.14Â±3.9143.25Â±3.1844.19Â±2.4241.64Â±2.0445.18Â±2.4345.22Â±4.0650.75Â±1.8559.20Â±1.22
0.558.70Â±0.8659.33Â±0.7760.64Â±0.8358.74Â±0.8259.74Â±0.9263.49Â±1.1063.34Â±0.7072.41Â±0.17
1.064.33Â±0.2564.75Â±0.3364.41Â±0.2963.42Â±0.4564.48Â±0.3167.62Â±0.4168.09Â±0.2575.16Â±0.31
ğ¼ğ¼ğ· 65.72Â±0.2265.95Â±0.2366.31Â±0.2365.36Â±0.1865.58Â±0.2469.65Â±0.1069.77Â±0.1977.48Â±0.10
Cifar-1000.134.22Â±1.0134.52Â±0.6835.76Â±1.1133.23Â±0.7836.09Â±0.7137.31Â±0.6638.79Â±0.5544.61Â±1.48
0.542.16Â±0.4341.37Â±0.4945.03Â±0.9641.54Â±0.5241.96Â±0.5644.29Â±0.5246.55Â±0.5554.26Â±0.45
1.043.32Â±0.3843.00Â±0.4546.60Â±0.3943.63Â±0.3943.68Â±0.2346.74Â±0.3148.41Â±0.2555.72Â±0.36
ğ¼ğ¼ğ· 45.14Â±0.2845.40Â±0.2748.33Â±0.2544.76Â±0.2445.04Â±0.2448.59Â±0.2048.65Â±0.1759.24Â±0.32
FEMNISTâˆ’ 79.09Â±0.5478.89Â±0.5079.56Â±0.3478.75Â±0.2779.15Â±0.3481.20Â±0.4178.98Â±0.4581.27Â±0.31
VGG-16Cifar-100.162.28Â±5.7263.19Â±5.1565.97Â±3.8262.00Â±3.1964.78Â±5.6965.52Â±4.9669.15Â±2.1674.49Â±0.92
0.578.82Â±0.2178.49Â±0.2678.98Â±0.1178.09Â±0.4879.30Â±0.4379.12Â±0.2580.07Â±0.1984.24Â±0.37
1.079.53Â±0.3479.52Â±0.3080.08Â±0.2479.67Â±0.4579.76Â±0.2080.08Â±0.3280.85Â±0.9985.12Â±0.13
ğ¼ğ¼ğ· 79.96Â±0.0579.79Â±0.0780.13Â±0.0579.66Â±0.0679.89Â±0.0580.66Â±0.0982.20Â±0.0585.66Â±0.15
Cifar-1000.147.29Â±0.9648.02Â±0.6849.11Â±1.6047.38Â±1.4749.36Â±0.5548.78Â±1.0351.30Â±1.0055.33Â±0.72
0.555.60Â±0.5555.45Â±0.7056.29Â±0.8454.45Â±0.5856.40Â±0.4756.73Â±0.4158.02Â±0.3165.07Â±0.25
1.056.05Â±0.4555.75Â±0.3657.96Â±0.3255.70Â±0.3756.69Â±0.2557.46Â±0.2558.53Â±0.3165.66Â±0.15
ğ¼ğ¼ğ· 57.22Â±0.2856.65Â±0.2358.47Â±0.1657.33Â±0.1757.55Â±0.1657.96Â±0.1158.62Â±0.0866.33Â±0.10
FEMNISTâˆ’ 83.96Â±0.4384.27Â±0.3284.39Â±0.2883.64Â±0.2783.99Â±0.3284.59Â±0.2183.97Â±0.5785.36Â±0.21
 10 15 20 25 30 35 40 45
 0 200  400  600  800 1000  1200  1400  1600  1800  2000Accuracy(%)
Communication RoundsFedAvg
FedProx
FedGen
CluSamp
FedExP
FedASAM
FedMut
FedMR
(a)ğ›¼=0.1
 10 15 20 25 30 35 40 45 50 55
 0 200  400  600  800 1000  1200  1400  1600  1800  2000Accuracy(%)
Communication RoundsFedAvg
FedProx
FedGen
CluSamp
FedExP
FedASAM
FedMut
FedMR (b)ğ›¼=0.5
 10 15 20 25 30 35 40 45 50 55 60
 0 200  400  600  800 1000  1200  1400  1600  1800  2000Accuracy(%)
Communication RoundsFedAvg
FedProx
FedGen
CluSamp
FedExP
FedASAM
FedMut
FedMR (c)ğ›¼=1.0
 10 15 20 25 30 35 40 45 50 55 60
 0 200  400  600  800 1000  1200  1400  1600  1800  2000Accuracy(%)
Communication RoundsFedAvg
FedProx
FedGen
CluSamp
FedExP
FedASAM
FedMut
FedMR (d) IID
Figure 9: Learning curves of FL methods based on ResNet-20 model for CIFAR-100 dataset.
on clients are non-IID distributed ( ğ›¼=1.0). Note that all the cases
here did not use the two-stage training scheme. From this figure, we
can find that FedMR outperforms the other variants significantly.
Moreover, when the granularity of partitioning goes coarser, the
classification performance of FedMR becomes worse.
5.4.3 Two-stage Training Scheme. To demonstrate the effective-
ness of our proposed two-stage training scheme, we conducted
experiments on CIFAR-10 dataset using ResNet-20-based and VGG-
16-based FedMR, where the data on clients are non-IID distributed
(ğ›¼=1.0). Figure 12 presents the learning trends of FedMR withfive different two-stage training settings. Here, we use the nota-
tion â€œFedMR- ğ‘›â€ to denote that the first stage involves ğ‘›rounds
of model aggregation-based local training to obtain a pre-trained
global model, while the remaining rounds conduct local training
based on our proposed model recombination-based method. From
Figure 12, we can observe that the two-stage training-based FedMR
methods (i.e., FedMR-50 and FedMR-100) achieve the best perfor-
mance from the perspectives of test accuracy and convergence
rate. Note that our two-stage training scheme can achieve a more
significant improvement on the case using VGG-16 model, which
has a much larger size than ResNet-20 model. This is because the
 
1103Is Aggregation the Only Choice? Federated Learning via Layer-wise Model Recombination KDD â€™24, August 25â€“29, 2024, Barcelona, Spain.
 10 15 20 25 30 35 40 45 50 55 60
 0 200  400  600  800 1000  1200  1400  1600  1800  2000Accuracy(%)
Communication RoundsFedAvg
FedProx
FedGen
CluSamp
FedExP
FedASAM
FedMut
FedMR
(a)ğ¾=5
 10 15 20 25 30 35 40 45 50 55 60
 0 200  400  600  800 1000  1200  1400  1600  1800  2000Accuracy(%)
Communication RoundsFedAvg
FedProx
FedGen
CluSamp
FedExP
FedASAM
FedMut
FedMR (b)ğ¾=10
 10 15 20 25 30 35 40 45 50 55 60 65
 0 200  400  600  800 1000  1200  1400  1600  1800  2000Accuracy(%)
Communication RoundsFedAvg
FedProx
FedGen
CluSamp
FedExP
FedASAM
FedMut
FedMR (c)ğ¾=20
 10 15 20 25 30 35 40 45 50 55 60 65
 0 200  400  600  800 1000  1200  1400  1600  1800  2000Accuracy(%)
Communication RoundsFedAvg
FedProx
FedGen
CluSamp
FedExP
FedASAM
FedMut
FedMR (d)ğ¾=50
 10 15 20 25 30 35 40 45 50 55 60 65
 0 200  400  600  800 1000  1200  1400  1600  1800  2000Accuracy(%)
Communication RoundsFedAvg
FedProx
FedGen
CluSamp
FedExP
FedASAM
FedMut
FedMR (e)ğ¾=100
Figure 10: Comparison of FL methods using ResNet-20 model on CIFAR-10 dataset with ğ›¼=0.1.
 10 15 20 25 30 35 40 45 50 55 60 65 70 75 80
 0 200  400  600  800 1000  1200  1400  1600  1800  2000Accuracy(%)
Communication RoundsFedMR
FedMR-p0.1
FedMR-p0.2
FedMR-p0.5
FedMR-p1.0
(a) ResNet-20
 10 15 20 25 30 35 40 45 50 55 60 65 70 75 80 85
 0  200  400  600  800  1000Accuracy(%)
Communication RoundsFedMR
FedMR-p0.1
FedMR-p0.2
FedMR-p0.5
FedMR-p1.0 (b) VGG-16
Figure 11: Learning curves for partitioning strategies.
 40 45 50 55 60 65 70 75 80
 0 200  400  600  800 1000  1200  1400  1600  1800  2000Accuracy(%)
Communication RoundsFedMR-0
FedMR-50
FedMR-100
FedMR-200
FedMR-300
(a) ResNet-20
 40 45 50 55 60 65 70 75 80 85
 0 100  200  300  400  500  600  700  800  900 1000Accuracy(%)
Communication RoundsFedMR-0
FedMR-50
FedMR-100
FedMR-200
FedMR-300 (b) VGG-16
Figure 12: Learning curves for two-stage training settings.
fine-grained FedMR without the first-stage training is not good
at dealing with large-size models at the beginning of FL training,
which requires many more training rounds than the coarse-grained
aggregation-based methods to achieve a given preliminary clas-
sification accuracy target. By resorting to the two-stage training
scheme, such a slow convergence problem can be greatly mitigated.
5.5 Discussions
5.5.1 Privacy Preserving. Similar to traditional FedAvg-based FL
methods, FedMR does not require clients to send their data to the
cloud server, thus the data privacy can be mostly guaranteed by
the secure clients themselves. Since our model recombination oper-
ation breaks the dependencies between model layers and conducts
the shuffling of layers among models, in practice, it is hard for
adversaries to restore the confidential data from a fragmentary re-
combined model without knowing the sources of layers. We present
a secure recombination mechanism to avoid privacy leakage from
the cloud server. Please see Appendix B for more details. Our se-
cure recombination mechanism ensures that the cloud server onlyreceives recombined models from clients, which means that the
cloud server cannot restore the model of each client.
5.5.2 Limitations. As a novel FL paradigm, FedMR shows much
better inference performance than most SOTA FL methods. Al-
though this paper proposed an efficient two-stage training scheme
to accelerate the overall FL training processes, there still exist nu-
merous chances (e.g., client selection strategies, dynamic combina-
tion of model aggregation and model recombination operations)
to enable further optimization on the current version of FedMR.
Meanwhile, the current version of FedMR does not consider person-
alization [ 31,33] and fairness [ 26,27], two very important topics
that deserve to be studied in the future.
6 Conclusion
Due to the coarse-grained aggregation of FedAvg as well as the
uniform client model initialization, when dealing with uneven data
distribution among clients, existing Federated Learning (FL) meth-
ods greatly suffer from the problem of low inference performance.
To address this problem, this paper presented a new FL paradigm
named FedMR, which enables different layers of local models to be
trained on different clients. Since FedMR supports both fine-grained
model recombination and diversified local training initialization,
it enables effective and efficient search for superior generalized
models for all clients. Comprehensive experimental results show
both the effectiveness and pervasiveness of our proposed method
in terms of inference accuracy and convergence rate.
7 Acknowledgement
This work was supported by Natural Science Foundation of China
(62272170), and â€œDigital Silk Roadâ€ Shanghai International Joint Lab
of Trustworthy Intelligent Software (22510750100), the National
Research Foundation, Singapore, and DSO National Laboratories
under the AI Singapore Programme (AISG Award No: AISG2-GC-
2023-008), the National Research Foundation, Singapore, and the
Cyber Security Agency under its National Cybersecurity R&D Pro-
gramme (NCRP25-P04-TAICeN), Natural Science Foundation (NSF
CCF-2217104) and National Natural Science Foundation of China
(62306116). Any opinions, findings and conclusions or recommen-
dations expressed in this material are those of the author(s) and do
not reflect the views of National Research Foundation, Singapore
and Cyber Security Agency of Singapore.
 
1104KDD â€™24, August 25â€“29, 2024, Barcelona, Spain. Ming Hu et al.
References
[1]Durmus Alp Emre Acar, Yue Zhao, Ramon Matas, Matthew Mattina, Paul What-
mough, and Venkatesh Saligrama. 2020. Federated Learning Based on Dynamic
Regularization. In Proc. of International Conference on Learning Representations.
[2]Mohammed Adnan, Shivam Kalra, Jesse C Cresswell, Graham W Taylor, and
Hamid R Tizhoosh. 2022. Federated learning and differential privacy for medical
image analysis. Scientific reports 12, 1 (2022), 1953.
[3]Naman Agarwal, Peter Kairouz, and Ziyu Liu. 2021. The skellam mechanism
for differentially private federated learning. Advances in Neural Information
Processing Systems 34 (2021), 5052â€“5064.
[4]Samiul Alam, Luyang Liu, Ming Yan, and Mi Zhang. 2022. Fedrolex: Model-
heterogeneous federated learning with rolling sub-model extraction. Advances
in neural information processing systems 35 (2022), 29677â€“29690.
[5]Keith Bonawitz, Vladimir Ivanov, Ben Kreuter, Antonio Marcedone, H Brendan
McMahan, Sarvar Patel, Daniel Ramage, Aaron Segal, and Karn Seth. 2017. Practi-
cal secure aggregation for privacy-preserving machine learning. In Proc. of ACM
SIGSAC Conference on Computer and Communications Security. 1175â€“1191.
[6]Debora Caldarola, Barbara Caputo, and Marco Ciccone. 2022. Improving gen-
eralization in federated learning by seeking flat minima. In Proc. of European
Conference on Computer Vision. 654â€“672.
[7]Sebastian Caldas, Sai Meher Karthik Duddu, Peter Wu, Tian Li, Jakub KoneÄn `y,
H Brendan McMahan, Virginia Smith, and Ameet Talwalkar. 2018. Leaf: A
benchmark for federated settings. arXiv preprint arXiv:1812.01097 (2018).
[8]Cheng Chen, Ziyi Chen, Yi Zhou, and Bhavya Kailkhura. 2020. Fedcluster:
Boosting the convergence of federated learning via cluster-cycling. In Proc. of
IEEE International Conference on Big Data. 5017â€“5026.
[9]Yann Fraboni, Richard Vidal, Laetitia Kameni, and Marco Lorenzi. 2021. Clustered
sampling: Low-variance and improved representativity for clients selection in
federated learning. In Proc. of International Conference on Machine Learning.
3407â€“3416.
[10] Moritz Hardt, Ben Recht, and Yoram Singer. 2016. Train faster, generalize better:
Stability of stochastic gradient descent. In Proc. of International Conference on
Machine Learning. 1225â€“1234.
[11] Sepp Hochreiter and JÃ¼rgen Schmidhuber. 1997. Flat minima. Neural computation
9, 1 (1997), 1â€“42.
[12] Tzu-Ming Harry Hsu, Hang Qi, and Matthew Brown. 2019. Measuring the effects
of non-identical data distribution for federated visual classification. arXiv preprint
arXiv:1909.06335 (2019).
[13] Ming Hu, E Cao, Hongbing Huang, Min Zhang, Xiaohong Chen, and Mingsong
Chen. 2023. AIoTML: A Unified Modeling Language for AIoT-Based Cyber-
Physical Systems. IEEE Transactions on Computer-Aided Design of Integrated
Circuits and Systems (2023).
[14] Ming Hu, Yue Cao, Anran Li, Zhiming Li, Chengwei Liu, Tianlin Li, Mingsong
Chen, and Yang Liu. 2024. FedMut: Generalized Federated Learning via Stochastic
Mutation. In Proc. of the AAAI Conference on Artificial Intelligence, Vol. 38. 12528â€“
12537.
[15] Ming Hu, Wenxue Duan, Min Zhang, Tongquan Wei, and Mingsong Chen. 2020.
Quantitative timing analysis for cyber-physical systems using uncertainty-aware
scenario-based specifications. IEEE Transactions on Computer-Aided Design of
Integrated Circuits and Systems 39, 11 (2020), 4006â€“4017.
[16] Ming Hu, Zeke Xia, Dengke Yan, Zhihao Yue, Jun Xia, Yihao Huang, Yang Liu,
and Mingsong Chen. 2023. GitFL: Uncertainty-Aware Real-Time Asynchronous
Federated Learning Using Version Control. In Proc. of IEEE Real-Time Systems
Symposium. 145â€“157.
[17] Yutao Huang, Lingyang Chu, Zirui Zhou, Lanjun Wang, Jiangchuan Liu, Jian Pei,
and Yong Zhang. 2021. Personalized Cross-Silo Federated Learning on Non-IID
Data. In Proc. of the AAAI Conference on Artificial Intelligence.
[18] Fatih Ilhan, Gong Su, and Ling Liu. 2023. Scalefl: Resource-adaptive federated
learning with heterogeneous clients. In Proc. of the IEEE/CVF Conference on
Computer Vision and Pattern Recognition. 24532â€“24541.
[19] Divyansh Jhunjhunwala, Shiqiang Wang, and Gauri Joshi. 2023. Fedexp: Speeding
up federated averaging via extrapolation. arXiv preprint arXiv:2301.09604 (2023).
[20] Chentao Jia, Ming Hu, Zekai Chen, Yanxin Yang, Xiaofei Xie, Yang Liu, and
Mingsong Chen. 2024. AdaptiveFL: Adaptive Heterogeneous Federated Learning
for Resource-Constrained AIoT Systems. In Proc. of Design Automation Conference.
1â€“6.
[21] Peter Kairouz, H Brendan McMahan, Brendan Avent, AurÃ©lien Bellet, Mehdi Ben-
nis, Arjun Nitin Bhagoji, Kallista Bonawitz, Zachary Charles, Graham Cormode,
Rachel Cummings, et al .2021. Advances and open problems in federated learning.
Foundations and TrendsÂ® in Machine Learning 14, 1â€“2 (2021), 1â€“210.
[22] Sai Praneeth Karimireddy, Satyen Kale, Mehryar Mohri, Sashank Reddi, Sebastian
Stich, and Ananda Theertha Suresh. 2020. SCAFFOLD: Stochastic controlled
averaging for federated learning. In Proc. of International Conference on Machine
Learning. 5132â€“5143.
[23] Alex Krizhevsky. 2009. Learning Multiple Layers of Features from Tiny Images.
Masterâ€™s thesis, University of Tront (2009).[24] Jungmin Kwon, Jeongseop Kim, Hyunseo Park, and In Kwon Choi. 2021. Asam:
Adaptive sharpness-aware minimization for scale-invariant learning of deep
neural networks. In Proc. of International Conference on Machine Learning. PMLR,
5905â€“5914.
[25] Anran Li, Rui Liu, Ming Hu, Luu Anh Tuan, and Han Yu. 2023. Towards inter-
pretable federated learning. arXiv preprint arXiv:2302.13473 (2023).
[26] Tianlin Li, Qing Guo, Aishan Liu, Mengnan Du, Zhiming Li, and Yang Liu. 2023.
FAIRER: fairness as decision rationale alignment. In Proc. of International Confer-
ence on Machine Learning. 19471â€“19489.
[27] Tianlin Li, Zhiming Li, Anran Li, Mengnan Du, Aishan Liu, Qing Guo, Guozhu
Meng, and Yang Liu. 2023. Fairness via group contribution matching. In Proc. of
International Joint Conference on Artificial Intelligence. 436â€“445.
[28] Tian Li, Anit Kumar Sahu, Manzil Zaheer, Maziar Sanjabi, Ameet Talwalkar, and
Virginia Smith. 2020. Federated optimization in heterogeneous networks. Proc.
of Machine Learning and Systems 2 (2020), 429â€“450.
[29] Xiang Li, Kaixuan Huang, Wenhao Yang, Shusen Wang, and Zhihua Zhang.
2020. On the Convergence of FedAvg on Non-IID Data. In Proc. of International
Conference on Learning Representations.
[30] Tao Lin, Lingjing Kong, Sebastian U Stich, and Martin Jaggi. 2020. Ensemble
distillation for robust model fusion in federated learning. Advances in Neural
Information Processing Systems 33 (2020), 2351â€“2363.
[31] Xiaosong Ma, Jie Zhang, Song Guo, and Wenchao Xu. 2022. Layer-wised model ag-
gregation for personalized federated learning. In Proc. of the IEEE/CVF conference
on computer vision and pattern recognition. 10092â€“10101.
[32] Brendan McMahan, Eider Moore, Daniel Ramage, Seth Hampson, and
Blaise Aguera y Arcas. 2017. Communication-efficient learning of deep net-
works from decentralized data. In Proc. of Artificial intelligence and statistics.
1273â€“1282.
[33] Krishna Pillutla, Kshitiz Malik, Abdel-Rahman Mohamed, Mike Rabbat, Maziar
Sanjabi, and Lin Xiao. 2022. Federated learning with partial model personalization.
InProc. of International Conference on Machine Learning. 17716â€“17758.
[34] Sebastian Urban Stich. 2019. Local SGD Converges Fast and Communicates Little.
InProc. of International Conference on Learning Representations.
[35] Ben Tan, Bo Liu, Vincent Zheng, and Qiang Yang. 2020. A federated recommender
system for online services. In Proc. of ACM Conference on Recommender Systems.
579â€“581.
[36] TorchvisionModel. 2019. Models and pre-trained weight. https://pytorch.org/
vision/stable/models.html.
[37] Haozhao Wang, Yabo Jia, Meng Zhang, Qinghao Hu, Hao Ren, Peng Sun, Yong-
gang Wen, and Tianwei Zhang. 2024. FedDSE: Distribution-aware Sub-model
Extraction for Federated Learning over Resource-constrained Devices. In Proc. of
the ACM on Web Conference. 2902â€“2913.
[38] Hao Wang, Zakhary Kaplan, Di Niu, and Baochun Li. 2020. Optimizing federated
learning on non-iid data with reinforcement learning. In Proc. of IEEE Conference
on Computer Communications. 1698â€“1707.
[39] Haozhao Wang, Yichen Li, Wenchao Xu, Ruixuan Li, Yufeng Zhan, and Zhigang
Zeng. 2023. Dafkd: Domain-aware federated knowledge distillation. In Proc. of the
IEEE/CVF conference on Computer Vision and Pattern Recognition. 20412â€“20421.
[40] Haozhao Wang, Haoran Xu, Yichen Li, Yuan Xu, Ruixuan Li, and Tianwei Zhang.
2023. FedCDA: Federated Learning with Cross-rounds Divergence-aware Aggre-
gation. In Proc. of International Conference on Learning Representations.
[41] Jiaqi Wang, Suhan Cui, and Fenglong Ma. 2023. FedLEGO: Enabling Heterogenous
Model Cooperation via Brick Reassembly in Federated Learning. In Proc. of
International Workshop on Federated Learning for Distributed Data Mining.
[42] Jie Wen, Zhixia Zhang, Yang Lan, Zhihua Cui, Jianghui Cai, and Wensheng Zhang.
2023. A survey on federated learning: challenges and applications. International
Journal of Machine Learning and Cybernetics 14, 2 (2023), 513â€“535.
[43] Dongxian Wu, Shu-Tao Xia, and Yisen Wang. 2020. Adversarial weight pertur-
bation helps robust generalization. Advances in Neural Information Processing
Systems 33 (2020), 2958â€“2969.
[44] Zeke Xia, Ming Hu, Dengke Yan, Xiaofei Xie, Tianlin Li, Anran Li, Junlong
Zhou, and Mingsong Chen. 2024. CaBaFL: Asynchronous Federated Learning via
Hierarchical Cache and Feature Balance. arXiv preprint arXiv:2404.12850 (2024).
[45] Ming Xie, Guodong Long, Tao Shen, Tianyi Zhou, Xianzhi Wang, Jing Jiang,
and Chengqi Zhang. 2020. Multi-center federated learning. arXiv preprint
arXiv:2005.01026 (2020).
[46] Qian Yang, Jianyi Zhang, Weituo Hao, Gregory P Spell, and Lawrence Carin. 2021.
Flop: Federated learning on medical datasets using partial networks. In Proc. of
the ACM SIGKDD Conference on Knowledge Discovery & Data Mining. 3845â€“3853.
[47] Xinqian Zhang, Ming Hu, Jun Xia, Tongquan Wei, Mingsong Chen, and Shiyan
Hu. 2020. Efficient federated learning for cloud-based AIoT applications. IEEE
Transactions on Computer-Aided Design of Integrated Circuits and Systems 40, 11
(2020), 2211â€“2223.
[48] Zhuangdi Zhu, Junyuan Hong, and Jiayu Zhou. 2021. Data-free knowledge distil-
lation for heterogeneous federated learning. In Proc. of International Conference
on Machine Learning. 12878â€“12889.
 
1105Is Aggregation the Only Choice? Federated Learning via Layer-wise Model Recombination KDD â€™24, August 25â€“29, 2024, Barcelona, Spain.
A Proof of FedMR Convergence
A.1 Notations
In our FedMR approach, the global model is aggregated from all
the recombined models and all the models have the same weight.
Letğ‘¡exhibit the ğ‘¡ğ‘¡â„SGD iteration on the local device, ğ‘£is the
intermediate variable that represents the result of SGD update after
exactly one iteration. The update of FedMR is as follows:
ğ‘£ğ‘˜
ğ‘¡+1=ğ‘¤ğ‘˜
ğ‘¡âˆ’ğœ‚ğ‘¡âˆ‡ğ‘“ğ‘˜(ğ‘¤ğ‘˜
ğ‘¡,ğœ‰ğ‘˜
ğ‘¡), (1)
ğ‘¤ğ‘˜
ğ‘¡+1=ğ‘£ğ‘˜
ğ‘¡+1, ğ‘–ğ‘“ ğ¸ âˆ¤ğ‘¡+1
ğ‘…ğ‘€(ğ‘£ğ‘˜
ğ‘¡+1), ğ‘–ğ‘“ ğ¸|ğ‘¡+1, (2)
whereğ‘¤ğ‘˜
ğ‘¡represents the model of the ğ‘˜ğ‘¡â„client in the ğ‘¡ğ‘¡â„iteration.
ğ‘¤ğ‘¡+1denotes the global model of the (ğ‘¡+1)ğ‘¡â„iteration.ğ‘…ğ‘€(ğ‘£ğ‘˜
ğ‘¡+1)
denotes the recombined model.
Since FedMR recombines all the local models in each round and
the recombination only shuffles layers of models, the parameters of
recombined models are all from the models before recombination,
and no parameters are discarded. Therefore, when ğ¸|ğ‘¡+1, we
can obtain the following invariants:
ğ¾âˆ‘ï¸
ğ‘˜=1ğ‘£ğ‘˜
ğ‘¡+1=ğ¾âˆ‘ï¸
ğ‘˜=1ğ‘…ğ‘€(ğ‘£ğ‘˜
ğ‘¡+1)=ğ¾âˆ‘ï¸
ğ‘˜=1ğ‘¤ğ‘˜
ğ‘¡+1, (3)
ğ¾âˆ‘ï¸
ğ‘˜=1||ğ‘£ğ‘˜
ğ‘¡+1âˆ’ğ‘¥||2=ğ¾âˆ‘ï¸
ğ‘˜=1||ğ‘¤ğ‘˜
ğ‘¡+1âˆ’ğ‘¥||2, (4)
whereğ‘¤ğ‘˜
ğ‘¡is theğ‘˜ğ‘¡â„recombined model in (ğ‘¡âˆ’1)ğ‘¡â„iteration, which
is as the local model to be dispatched to ğ‘˜ğ‘¡â„client inğ‘¡ğ‘¡â„iteration,
ğ‘¥can any vector with the same size as ğ‘£ğ‘˜
ğ‘¡. Similar to [ 34], we define
two variables ğ‘£ğ‘¡andğ‘¤ğ‘¡:
ğ‘£ğ‘¡=1
ğ¾ğ¾âˆ‘ï¸
ğ‘˜=1ğ‘£ğ‘˜
ğ‘¡,ğ‘¤ğ‘¡=1
ğ¾ğ‘˜âˆ‘ï¸
ğ‘˜=1ğ‘¤ğ‘˜
ğ‘¡. (5)
Inspired by [29], we make the following definition:
ğ‘”ğ‘˜
ğ‘¡=âˆ‡ğ‘“ğ‘˜(ğ‘¤ğ‘˜
ğ‘¡;ğœ‰ğ‘˜
ğ‘¡). (6)
A.2 Proof of Lemma 4.4
Proof. Assumeğ‘£ğ‘˜
ğ‘¡hasğ‘›layers, we have ğ‘£ğ‘˜
ğ‘¡=ğ¿1âŠ•ğ¿2âŠ•...âŠ•ğ¿ğ‘›.
Letğ¿ğ‘–=[ğ‘ğ‘£ğ‘˜
ğ‘¡
(ğ‘–,0),ğ‘ğ‘£ğ‘˜
ğ‘¡
(ğ‘–,1),...,ğ‘ğ‘£ğ‘˜
ğ‘¡
(ğ‘–,|ğ¿ğ‘–|)], whereğ‘ğ‘£ğ‘˜
ğ‘¡
(ğ‘–,ğ‘—)denotes the ğ‘—ğ‘¡â„
parameter of the layer ğ¿ğ‘–in the model ğ‘£ğ‘˜
ğ‘¡. We have
ğ¾âˆ‘ï¸
ğ‘˜=1||ğ‘£ğ‘˜
ğ‘¡âˆ’ğ‘¥||2=ğ¾âˆ‘ï¸
ğ‘˜=1ğ‘›âˆ‘ï¸
ğ‘–=1|ğ¿ğ‘–|âˆ‘ï¸
ğ‘—=1||ğ‘ğ‘£ğ‘˜
ğ‘¡
(ğ‘–,ğ‘—)âˆ’ğ‘ğ‘¥
(ğ‘–,ğ‘—)||2(7)
ğ¾âˆ‘ï¸
ğ‘˜=1||ğ‘¤ğ‘˜
ğ‘¡âˆ’ğ‘¥||2=ğ¾âˆ‘ï¸
ğ‘˜=1ğ‘›âˆ‘ï¸
ğ‘–=1|ğ¿ğ‘–|âˆ‘ï¸
ğ‘—=1||ğ‘ğ‘¤ğ‘˜
ğ‘¡
(ğ‘–,ğ‘—)âˆ’ğ‘ğ‘¥
(ğ‘–,ğ‘—)||2(8)
Since model recombination only shuffles layers of models, the
parameters of recombined models are all from the models before
recombination and no parameters are discarded. We have
âˆ€ğ‘–âˆˆ[1,ğ‘›],ğ‘—âˆˆ[1,|ğ¿ğ‘–|]ğ¾âˆ‘ï¸
ğ‘˜=1ğ‘ğ‘£ğ‘˜
ğ‘¡
(ğ‘–,ğ‘—)=ğ¾âˆ‘ï¸
ğ‘˜=1ğ‘ğ‘¤ğ‘˜
ğ‘¡
(ğ‘–,ğ‘—)(9)
âˆ€ğ‘˜âˆˆ[1,ğ¾],ğ‘–âˆˆ[1,ğ‘›],ğ‘—âˆˆ[1,|ğ¿ğ‘–|]âˆƒğ‘âˆˆ[1,ğ¾]{ğ‘ğ‘£ğ‘˜
ğ‘¡
(ğ‘–,ğ‘—)=ğ‘ğ‘¤ğ‘
ğ‘¡
(ğ‘–,ğ‘—)} (10)âˆ€ğ‘˜âˆˆ[1,ğ¾],ğ‘–âˆˆ[1,ğ‘›],ğ‘—âˆˆ[1,|ğ¿ğ‘–|]âˆƒğ‘âˆˆ[1,ğ¾]{ğ‘ğ‘¤ğ‘˜
ğ‘¡
(ğ‘–,ğ‘—)=ğ‘ğ‘£ğ‘
ğ‘¡
(ğ‘–,ğ‘—)} (11)
According to Equations 9-11, we have
ğ¾âˆ‘ï¸
ğ‘˜=1||ğ‘£ğ‘˜
ğ‘¡âˆ’ğ‘¥||2=ğ¾âˆ‘ï¸
ğ‘˜=1ğ‘›âˆ‘ï¸
ğ‘–=1|ğ¿ğ‘–|âˆ‘ï¸
ğ‘—=1||ğ‘ğ‘£ğ‘˜
ğ‘¡
(ğ‘–,ğ‘—)âˆ’ğ‘ğ‘¥
(ğ‘–,ğ‘—)||2
=ğ¾âˆ‘ï¸
ğ‘˜=1||ğ‘¤ğ‘˜
ğ‘¡âˆ’ğ‘¥||2(12)
â–¡
A.3 Key Lemmas
To facilitate the proof of our Theorem 1, inspired by [ 29], we can
present the following two lemmas. Note that the following proofs
are general proofs for all the multi-model-based FL approaches that
satisfy Lemma 4.4.
Lemma A.1. (Results of one step SGD). If ğœ‚ğ‘¡â‰¤1
4ğ¿, we have
E||ğ‘£ğ‘¡+1âˆ’ğ‘¤â˜…||2â‰¤1
ğ¾ğ¾âˆ‘ï¸
ğ‘˜=1(1âˆ’ğœ‡ğœ‚ğ‘¡)||ğ‘£ğ‘˜
ğ‘¡âˆ’ğ‘¤â˜…||2
+1
ğ¾ğ¾âˆ‘ï¸
ğ‘˜=1||ğ‘¤ğ‘˜
ğ‘¡âˆ’ğ‘¤ğ‘˜
ğ‘¡0||2+10ğœ‚2
ğ‘¡ğ¿Î“.
Proof. According to Lemma 4.4 (i.e., Equation 3 and Equation
4), we have
||ğ‘£ğ‘¡+1âˆ’ğ‘¤â˜…||2â‰¤1
ğ¾ğ¾âˆ‘ï¸
ğ‘˜=1||ğ‘£ğ‘˜
ğ‘¡+1âˆ’ğ‘¤â˜…||2
=1
ğ¾ğ¾âˆ‘ï¸
ğ‘˜=1(||ğ‘£ğ‘˜
ğ‘¡âˆ’ğ‘¤â˜…||2âˆ’2ğœ‚ğ‘¡âŸ¨ğ‘¤ğ‘˜
ğ‘¡âˆ’ğ‘¤â˜…,ğ‘”ğ‘˜
ğ‘¡âŸ©
+ğœ‚2
ğ‘¡||ğ‘”ğ‘˜
ğ‘¡||2)(13)
Letğµ1=âˆ’2ğœ‚ğ‘¡âŸ¨ğ‘¤ğ‘˜
ğ‘¡âˆ’ğ‘¤â˜…,ğ‘”ğ‘˜
ğ‘¡âŸ©andğµ2=ğœ‚2
ğ‘¡Ãğ¾
ğ‘˜=1||ğ‘”ğ‘˜
ğ‘¡||2. According
to Assumption 4.2, we have
ğµ1â‰¤âˆ’2ğœ‚ğ‘¡(ğ‘“ğ‘˜(ğ‘¤ğ‘˜
ğ‘¡)âˆ’ğ‘“ğ‘˜(ğ‘¤â˜…))âˆ’ğœ‡ğœ‚ğ‘¡||ğ‘¤ğ‘˜
ğ‘¡âˆ’ğ‘¤â˜…||2(14)
According to Assumption 4.1, we have
ğµ2â‰¤2ğœ‚2
ğ‘¡ğ¿(ğ‘“ğ‘˜(ğ‘¤ğ‘˜
ğ‘¡)âˆ’ğ‘“â˜…
ğ‘˜) (15)
According to Equation 14 and 15, we have
||ğ‘£ğ‘¡+1âˆ’ğ‘¤â˜…||2â‰¤1
ğ¾ğ¾âˆ‘ï¸
ğ‘˜=1[(1âˆ’ğœ‡ğœ‚ğ‘¡)||ğ‘£ğ‘˜
ğ‘¡âˆ’ğ‘¤â˜…||2
âˆ’2ğœ‚ğ‘¡(ğ‘“ğ‘˜(ğ‘¤ğ‘˜
ğ‘¡)âˆ’ğ‘“ğ‘˜(ğ‘¤â˜…))+ 2ğœ‚2
ğ‘¡ğ¿(ğ‘“ğ‘˜(ğ‘¤ğ‘˜
ğ‘¡)âˆ’ğ‘“â˜…
ğ‘˜)]
(16)
Letğ¶=1
ğ¾Ãğ¾
ğ‘˜=1[âˆ’2ğœ‚ğ‘¡(ğ‘“ğ‘˜(ğ‘¤ğ‘˜
ğ‘¡)âˆ’ğ‘“ğ‘˜(ğ‘¤â˜…))+ 2ğœ‚2
ğ‘¡ğ¿(ğ‘“ğ‘˜(ğ‘¤ğ‘˜
ğ‘¡)âˆ’ğ‘“â˜…
ğ‘˜)].
We have
ğ¶=âˆ’2ğœ‚ğ‘¡
ğ¾ğ¾âˆ‘ï¸
ğ‘˜=1(ğ‘“ğ‘˜(ğ‘¤ğ‘˜
ğ‘¡)âˆ’ğ‘“ğ‘˜(ğ‘¤â˜…))+2ğœ‚2
ğ‘¡ğ¿
ğ¾ğ¾âˆ‘ï¸
ğ‘˜=1(ğ‘“ğ‘˜(ğ‘¤ğ‘˜
ğ‘¡)âˆ’ğ‘“â˜…
ğ‘˜)
=âˆ’2ğœ‚ğ‘¡(1âˆ’ğœ‚ğ‘¡ğ¿)
ğ¾ğ¾âˆ‘ï¸
ğ‘˜=1(ğ‘“ğ‘˜(ğ‘¤ğ‘˜
ğ‘¡)âˆ’ğ‘“â˜…)+2ğœ‚2
ğ‘¡ğ¿
ğ¾ğ¾âˆ‘ï¸
ğ‘˜=1(ğ‘“â˜…âˆ’ğ‘“â˜…
ğ‘˜)(17)
 
1106KDD â€™24, August 25â€“29, 2024, Barcelona, Spain. Ming Hu et al.
LetÎ“=ğ‘“â˜…âˆ’1
ğ¾Ãğ¾
ğ‘˜=1ğ‘“â˜…
ğ‘˜andğœ™=2ğœ‚ğ‘¡(1âˆ’ğ¿ğœ‚ğ‘¡). We have
ğ¶=âˆ’ğœ™
ğ¾ğ¾âˆ‘ï¸
ğ‘˜=1(ğ‘“ğ‘˜(ğ‘¤ğ‘˜
ğ‘¡)âˆ’ğ‘“â˜…)+2ğœ‚2
ğ‘¡ğ¿Î“ (18)
Letğ·=âˆ’1
ğ¾Ãğ¾
ğ‘˜=1(ğ‘“ğ‘˜(ğ‘¤ğ‘˜
ğ‘¡)âˆ’ğ‘“â˜…),ğ¸|ğ‘¡0andğ‘¡âˆ’ğ‘¡0â‰¤ğ¸. We have
ğ·=âˆ’1
ğ¾ğ¾âˆ‘ï¸
ğ‘˜=1(ğ‘“ğ‘˜(ğ‘¤ğ‘˜
ğ‘¡)âˆ’ğ‘“ğ‘˜(ğ‘¤ğ‘˜
ğ‘¡0)+ğ‘“ğ‘˜(ğ‘¤ğ‘˜
ğ‘¡0)âˆ’ğ‘“â˜…) (19)
By Cauchyâ€“Schwarz inequality, we have
ğ·â‰¤1
2ğ¾ğ¾âˆ‘ï¸
ğ‘˜=1(ğœ‚ğ‘¡||âˆ‡ğ‘“ğ‘˜(ğ‘¤ğ‘˜
ğ‘¡0)||2+1
ğœ‚ğ‘¡||ğ‘¤ğ‘˜
ğ‘¡âˆ’ğ‘¤ğ‘˜
ğ‘¡0||2)
âˆ’1
ğ¾ğ¾âˆ‘ï¸
ğ‘˜=1(ğ‘“ğ‘˜(ğ‘¤ğ‘˜
ğ‘¡0)âˆ’ğ‘“â˜…)
â‰¤1
2ğ¾ğ¾âˆ‘ï¸
ğ‘˜=1[2ğœ‚ğ‘¡ğ¿(ğ‘“ğ‘˜(ğ‘¤ğ‘˜
ğ‘¡0)âˆ’ğ‘“â˜…
ğ‘˜)+1
ğœ‚ğ‘¡||ğ‘¤ğ‘˜
ğ‘¡âˆ’ğ‘¤ğ‘˜
ğ‘¡0||2]
âˆ’1
ğ¾ğ¾âˆ‘ï¸
ğ‘˜=1(ğ‘“ğ‘˜(ğ‘¤ğ‘˜
ğ‘¡0)âˆ’ğ‘“â˜…)(20)
Note that since ğœ‚â‰¤1
4ğ¿,ğœ‚ğ‘¡â‰¤ğœ™â‰¤2ğœ‚ğ‘¡andğœ‚ğ‘¡ğ¿â‰¤1
4. According
to Equation 20, we have
ğ¶â‰¤ğœ™
2ğœ‚ğ‘¡ğ¾ğ¾âˆ‘ï¸
ğ‘˜=1||ğ‘¤ğ‘˜
ğ‘¡âˆ’ğ‘¤ğ‘˜
ğ‘¡0||2+(ğœ™ğœ‚ğ‘¡ğ¿+2ğœ‚2
ğ‘¡ğ¿)Î“+ğœ™
ğ¾ğ¾âˆ‘ï¸
ğ‘˜=1(ğ‘“â˜…âˆ’ğ‘“â˜…
ğ‘˜)
â‰¤ğœ™
2ğœ‚ğ‘¡ğ¾ğ¾âˆ‘ï¸
ğ‘˜=1||ğ‘¤ğ‘˜
ğ‘¡âˆ’ğ‘¤ğ‘˜
ğ‘¡0||2+(ğœ™ğœ‚ğ‘¡ğ¿+ğœ™+2ğœ‚2
ğ‘¡ğ¿)Î“
â‰¤1
ğ¾ğ¾âˆ‘ï¸
ğ‘˜=1||ğ‘¤ğ‘˜
ğ‘¡âˆ’ğ‘¤ğ‘˜
ğ‘¡0||2+10ğœ‚2
ğ‘¡ğ¿Î“
(21)
â–¡
Lemma A.2. According to Equation 2, the model recombination
occurs every ğ¸iterations. Assume that in each training round, ğ‘¡0is
the first iteration and iteration ğ‘¡âˆ’ğ‘¡0â‰¤ğ¸âˆ’1. Given the constraint on
learning rate from [ 29], we know that ğœ‚ğ‘¡â‰¤ğœ‚ğ‘¡0â‰¤2ğœ‚ğ‘¡. It follows that
1
ğ¾ğ¾âˆ‘ï¸
ğ‘˜=1||ğ‘¤ğ‘˜
ğ‘¡âˆ’ğ‘¤ğ‘˜
ğ‘¡0||2â‰¤4ğœ‚2
ğ‘¡(ğ¸âˆ’1)2ğº2.
Proof.
1
ğ¾ğ¾âˆ‘ï¸
ğ‘˜=1||ğ‘¤ğ‘˜
ğ‘¡âˆ’ğ‘¤ğ‘˜
ğ‘¡0||2=1
ğ¾ğ¾âˆ‘ï¸
ğ‘˜=1||ğ‘¡0+ğ¸âˆ’1âˆ‘ï¸
ğ‘¡=ğ‘¡0ğœ‚ğ‘¡âˆ‡ğ‘“ğ‘1(ğ‘¤ğ‘1
ğ‘¡;ğœ‰ğ‘1
ğ‘¡)||2
â‰¤(ğ‘¡âˆ’ğ‘¡0)ğ‘¡0+ğ¸âˆ’1âˆ‘ï¸
ğ‘¡=ğ‘¡0ğœ‚2
ğ‘¡ğº2
â‰¤(ğ¸âˆ’1)ğ‘¡0+ğ¸âˆ’1âˆ‘ï¸
ğ‘¡=ğ‘¡0ğœ‚2
ğ‘¡ğº2
â‰¤4ğœ‚2
ğ‘¡(ğ¸âˆ’1)2ğº2.
â–¡A.4 Proof of Theorem 1
Based on Lemmas A.1 and A.2, we can prove Theorem 1 using the
proof framework of FedAvg [ 29]. Due to space limitations, please
refer to the proof of FedAvg [29] for the details.
B Secure Model Recombination Mechanism
To avoid the risk of privacy leakage caused by exposing gradients
or models to the cloud server, we propose a secure model recombi-
nation mechanism for FedMR, which allows the random exchange
of model layers among clients before model training or upload. As
shown in Figure 13, within a round of the secure model recombina-
tion, the update of each model (i.e., ğ‘š) consists of four stages:
Stage2:Receiving LayersReceivefromğ’„ğ’ŠReceivefromğ’„ğ’‹ğ’Stage3:Shuffling LayersStage4:ModelRecombinationReceivefromğ’„ğœ¸Receivefromğ’„ğœ¶Receivefromğ’„ğœ·Receivefromğ’„ğœ¹Receivefromğ’„ğœº
ModelRecombineSendtoğ’„ğœ¸Sendtoğ’„ğœ¹Sendtoğ’„ğœºSendtoğ’„ğœ¶Sendtoğ’„ğœ·
RandomlySelectLayersSendtoğ’„ğ’ŠSendtoğ’„ğ’‹Stage1:Sending LayersBuffer-ğ’ğ’‚ğ’šğ’†ğ’“ğŸBuffer-ğ’ğ’‚ğ’šğ’†ğ’“ğŸBuffer-ğ’ğ’‚ğ’šğ’†ğ’“ğŸ‘Buffer-ğ’ğ’‚ğ’šğ’†ğ’“ğŸ’ğ’
Figure 13: Workflow of secure model recombination.
Stage 1: Assume that the local model has ğ‘™ğ‘’ğ‘›layer. Each client
maintains a buffer for each layer. Firstly, each client randomly
selects a part of its layers and sends them to other activated clients,
while the remaining layers are saved in their corresponding buffers.
Note that a selected layer can only be sent to one client. For example,
in Figure 13, the client ğ‘šsendsğ‘™ğ‘ğ‘¦ğ‘’ğ‘Ÿ 2andğ‘™ğ‘ğ‘¦ğ‘’ğ‘Ÿ 4toğ‘ğ‘–andğ‘ğ‘—,
respectively.
Stage 2: Once receiving a layer from another client, the receiving
clientğ‘šwill add the layer to its corresponding buffer. For example,
in Figure 13, the client ğ‘štotally receives five layers. Besides the
retained two layers in stage 1, ğ‘šnow has seven layers in total in
its buffers.
Stage 3: For each layer buffer of ğ‘š, if there contains one element
received from a client ğ‘in stage 2, our mechanism will randomly
select one layer in the buffer and return it back to ğ‘. For example,
in Figure 13, ğ‘šrandomly returns a layer in Buffer-layer1 back to a
clientğ‘ğ›¾.
Stage 4: Once receiving the returned layers from other clients,
our mechanism will recombine them with all the other layers in
the buffers to form a new model. Note that the recombined model
may significantly differ from the original model in Stage 1.
Note that each FL training round can perform multiple times
secure model recombination. Due to the randomness, it is hard
for adversaries to figure out the sources of client model layers. In
addition, the cloud server will broadcast a public key before the
secure recombination to prevent privacy leakage. By using the
public key to encrypt the model parameters of each layer, the other
clients cannot directly obtain their received parameters.
 
1107