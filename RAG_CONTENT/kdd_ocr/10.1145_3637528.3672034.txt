Learning the Covariance of Treatment Effects
Across Many Weak Experiments
AurÃ©lien Bibautâˆ—
Netflix
Los Gatos, CA, United StatesWinston Chou
Netflix
Los Gatos, CA, United States
Simon Ejdemyr
Netflix
Los Gatos, CA, United StatesNathan Kallus
Netflix
Los Gatos, CA, United States
Cornell University
New York, NY, United States
ABSTRACT
When primary objectives are insensitive or delayed, experimenters
may instead focus on proxy metrics derived from secondary out-
comes. For example, technology companies often infer the long-
term impacts of product interventions from their effects on short-
term user engagement signals. We consider the meta-analysis of
many historical experiments to learn the covariance of treatment ef-
fects on these outcomes, which can support the construction of such
proxies. Even when experiments are plentiful, if treatment effects
are weak, the covariance of estimated treatment effects across ex-
periments can be highly biased. We overcome this with techniques
inspired by weak instrumental variable analysis. We show that Lim-
ited Information Maximum Likelihood (LIML) learns a parameter
equivalent to fitting total least squares to a transformation of the
scatterplot of treatment effects, and that Jackknife Instrumental
Variables Estimation (JIVE) learns another parameter computable
from the average of Jackknifed covariance matrices across experi-
ments. We also present a total covariance estimator for the latter
estimand under homoskedasticity, which is equivalent to a ğ‘˜-class
estimator. We show how these parameters can be used to construct
unbiased proxy metrics under various structural models. Lastly, we
discuss the real-world application of our methods at Netflix.
CCS CONCEPTS
â€¢Computing methodologies â†’Learning linear models; â€¢
Mathematics of computing â†’Multivariate statistics .
KEYWORDS
surrogate outcomes, meta-analysis, weak instrumental variables
ACM Reference Format:
AurÃ©lien Bibaut, Winston Chou, Simon Ejdemyr, and Nathan Kallus. 2024.
Learning the Covariance of Treatment Effects Across Many Weak Experi-
ments. In Proceedings of the 30th ACM SIGKDD Conference on Knowledge
âˆ—Corresponding author, contact at abibaut@netflixcontractors.com.
This work is licensed under a Creative Commons Attribution
International 4.0 License.
KDD â€™24, August 25â€“29, 2024, Barcelona, Spain
Â©2024 Copyright held by the owner/author(s).
ACM ISBN 979-8-4007-0490-1/24/08.
https://doi.org/10.1145/3637528.3672034Discovery and Data Mining (KDD â€™24), August 25â€“29, 2024, Barcelona, Spain.
ACM, New York, NY, USA, 10 pages. https://doi.org/10.1145/3637528.3672034
1 INTRODUCTION
Projecting long-term treatment effects from short-term metrics is
a ubiquitous problem in experimentation. For example, technol-
ogy companies seek to optimize insensitive primary metrics (such
as habitual usage, subscriber retention, and long-term revenue),
but are unable or unwilling to measure treatment effects on these
metrics precisely.1To address this issue, they optimize a suite of
secondary metrics that are associated with the primary metrics, but
more sensitive in terms of signal-to-noise and easier to measure in
short-term experiments. Under certain assumptions, the treatment
effect on a â€œsurrogate indexâ€ of multiple secondary metrics yields a
precise estimate of the long-term treatment effect [4, 17].
A class of statistical parameters that intuitively relates to the
problem of constructing proxy metrics for a primary metric is
the covariance matrix of true average treatment effects (ATEs)
on primary and secondary metrics in previous experiments, and
functions thereof. For example, when constructing weighted indices
of secondary outcomes, it is intuitive to consider the Ordinary (OLS)
and Total Least Squares (TLS) regression of true ATEs on a primary
outcome on true ATEs on the secondary outcomes in the scatterplot
of true ATEs over available historical experiments. Here, by true
ATE, we mean the unobserved mean on the population, in contrast
to the estimated ATE actually observed on the experimental sample.
How these statistical parameters actually connect to the question
of proxy metrics or surrogates is the first question we investigate
in this paper. In Section 3, we demonstrate that statistical features
of the covariance matrix of true ATEs have causal interpretations
under different causal models. For instance, under these models,
they can support inference on effects of novel treatments on long-
term outcomes based on short-term observations.
The second question we study is the estimation of the covariance
matrix of the true ATEs when the signal-to-noise ratio is small in
each experiment, as is often the case in digital experimentation
[8,16,20]. The statistical challenges are analogous to the many
weak instrumental variables (IVs) setting. One question of interest
in the weak instrument literature is whether allowing the number
1For example, they may be interested in the effect of digital platform design on long-
term user retention [ 12], but unwilling to run a sufficiently large experiment for a long
time to measure treatment effects on long-term retention.
 
153
KDD â€™24, August 25â€“29, 2024, Barcelona, Spain AurÃ©lien Bibaut, Winston Chou, Simon Ejdemyr, and Nathan Kallus
of instruments to diverge while holding their strength fixed yields
consistent estimates [ 15]. Analogously, we show that increasing
the number of experiments, even if each maintains a low signal-to-
noise ratio, enables consistent estimation of the covariance matrix
of true treatment effects. In fact, each of the three methods we study
has a weak-instrument estimator counterpart.
Our results demonstrate that we can reliably estimate the co-
variance matrix of true treatment effects as a parameter at the
meta-analytic level, that is, from experiment-level aggregates. In
this way, we contribute to an emerging literature on meta-analytic
approaches to surrogacy [ 7,9,18], which is particularly relevant
given the large number of experiments conducted on modern on-
line experimentation platforms. The sheer volume of historical data
from these platforms often makes unit-level analysis computation-
ally challenging, if not prohibitive [ 19]. Therefore, our methods
are not only statistically robust, but also operationally feasible for
large-scale experimentation.
The paper is organized as follows:
â€¢In Section 2, we present the data collection process and the
statistical parameters.
â€¢In Section 3, we discuss the relationship of the statistical
parameters to causal parameters and the construction of
proxy metrics.
â€¢In Section 4, we present weak-IV-inspired estimators of the
covariance matrix of true treatment effects and the OLS and
TLS estimands in the scatterplot of true ATEs.
â€¢In Section 5, we conduct a simulation study to illustrate the
performance of our proposed estimators and provide visual
intuition on the mechanics of some of our estimators.
â€¢Lastly, in Section 6, we describe the real-world application
of our methods to derive a linear surrogate index for experi-
mentation at Netlix.
2 STATISTICAL SETUP AND NOTATION
2.1 Data
We observe ğ‘unit-level quadruples ğ‘‚=(ğ‘‡,ğ´,ğ‘†,ğ‘Œ)whereğ‘‡âˆˆ
{1,...,ğ¾}is the experiment index, ğ´âˆˆ{0,1}is the treatment arm
index,ğ‘†is a(ğºâˆ’1)-dimensional vector of secondary metrics, and
ğ‘Œis the primary metric of interest. We observe ğ‘=ğ¾ğ‘›units di-
vided between ğ¾experiments, each of which has two arms with
ğ‘›units.2Units in different experiments may be drawn from dif-
ferent superpopulations, but are assigned uniformly completely
at random to cells. The observations ğ‘‚1,...,ğ‘‚ğ‘âˆ¼ğ‘‚are each
identically distributed. They may not be independent due to the re-
striction of having exactly ğ‘›units in each experiment. Conditional
onğ‘‡1,...,ğ‘‡ğ‘andğ´1,...,ğ´ğ‘, any two observations are nonetheless
independent.
2.2 Treatment-effect Covariance Matrix
For anyğ‘¡=1,...,ğ¾ , letğœğ‘†(ğ‘¡)=ğ¸[ğ‘†|ğ´=1,ğ‘‡=ğ‘¡]âˆ’ğ¸[ğ‘†|ğ´=
0,ğ‘‡=ğ‘¡]andğœğ‘Œ(ğ‘¡)=ğ¸[ğ‘Œ|ğ´=1,ğ‘‡=ğ‘¡]âˆ’ğ¸[ğ‘Œ|ğ´=0,ğ‘‡=ğ‘¡]be
the true ATEs in experiment ğ‘¡on the vector ğ‘†and on the scalar ğ‘Œ,
2While our results extend to the more realistic setting of multiple treatment arms of
varying size per experiment, we focus on the two-arm, constant sample size case for
ease of exposition.respectively. Let
Î›ğ¾=Î›ğ‘Œğ‘Œ,ğ¾ Î›ğ‘‡
ğ‘†ğ‘Œ,ğ¾
Î›ğ‘†ğ‘Œ,ğ¾ Î›ğ‘†ğ‘†,ğ¾
with
Î›ğ‘Œğ‘Œ,ğ¾=1
ğ¾ğ¾âˆ‘ï¸
ğ‘¡=1ğœğ‘Œ(ğ‘¡)2âˆ’ 
1
ğ¾ğ¾âˆ‘ï¸
ğ‘¡=1ğœğ‘Œ(ğ‘¡)!2
,
Î›ğ‘†ğ‘Œ,ğ¾=1
ğ¾ğ¾âˆ‘ï¸
ğ‘¡=1ğœğ‘†(ğ‘¡)ğœğ‘Œ(ğ‘¡)âˆ’ 
1
ğ¾ğ¾âˆ‘ï¸
ğ‘¡=1ğœğ‘†(ğ‘¡)!  
1
ğ¾ğ¾âˆ‘ï¸
ğ‘¡=1ğœğ‘Œ(ğ‘¡)!
,
Î›ğ‘†ğ‘†,ğ¾=1
ğ¾ğ¾âˆ‘ï¸
ğ‘¡=1ğœğ‘†(ğ‘¡)ğœğ‘†(ğ‘¡)âŠ¤âˆ’ 
1
ğ¾ğ¾âˆ‘ï¸
ğ‘¡=1ğœğ‘†(ğ‘¡)!  
1
ğ¾ğ¾âˆ‘ï¸
ğ‘¡=1ğœğ‘†(ğ‘¡)!âŠ¤
.
That is, Î›ğ¾is the covariance matrix of true ATEs across the primary
metric and secondary metrics over the population of experiments.
We assume throughout that Î›ğ‘†ğ‘†,ğ¾ is positive definite, meaning all
its eigenvalues are strictly positive. Note that this requires at least
ğ¾â‰¥ğºâˆ’1tests.
2.3 Statistical Parameters
We consider two statistical parameters. Our first parameter is
ğœƒ1(Î›ğ¾)=Î›âˆ’1
ğ‘†ğ‘†,ğ¾Î›ğ‘†ğ‘Œ,ğ¾.
This is the OLS in the scatterplot of the ğ¾true treatment effects.
While we discuss the exact causal interpretation of this parameter
(which requires structural assumptions) in the next section, intu-
itively the OLS measures the statistical relationship between the
surrogate metrics and the long-term metric [18].
Our second parameter is more complex:
ğœƒ2,Î¨(Î›ğ¾)=âˆ’ğ›¾Î¨,ğ‘†(Î›ğ¾)/ğ›¾Î¨,ğ‘Œ(Î›ğ¾),
where[ğ›¾Î¨,ğ‘Œ(Î›ğ¾),ğ›¾Î¨,ğ‘†(Î›ğ¾)ğ‘‡]ğ‘‡is a generalized eigenvector solv-
ing(Î›ğ¾âˆ’ğœ…Î¨)ğ›¾=0for the smallest possible ğœ…â‰¥0for which a
solution exists, where Î¨is a given positive definite matrix. The pa-
rameterğœƒ2,Î¨(Î›ğ¾)is the TLS on the Î¨âˆ’1/2-transformed scatterplot
of true treatment effects. While this parameter is less intuitive, we
show below that it coincides with ğœƒ1(Î›ğ¾)under certain structural
assumptions.
We emphasize that these OLS and TLS parameters are defined
in terms of only ğ¾points in ağº-dimensional scatterplot. The lo-
cation of these points themselves (the true ATEs) are, nonetheless,
unknown population quantities. Therefore, ğœƒ1(Î›ğ¾)is a popula-
tion quantity, meaning it is a function of the unknown population
distribution of the data ğ‘‚(that is, of infinite draws of ğ‘‚).
3 CAUSAL MODELS AND RELATIONSHIP TO
PROXIES
We now consider various causal models and examine how the sta-
tistical parameters ğœƒ1(Î›ğ¾)andğœƒ2(Î›ğ¾)relate to causal parameters
in these models. Equivalently, this section derives the structural
assumptions under which these statistical parameters can be given
a causal interpretation in terms of the effect of ğ‘†onğ‘Œand thereby
used to construct proxy metrics for ğ‘Œ.
 
154Learning the Covariance of Treatment Effects Across Many Weak Experiments KDD â€™24, August 25â€“29, 2024, Barcelona, Spain
3.1 Linear Structural Model without Direct
Effects
Consider the following linear structural model with experiment-
level fixed-effects and unmeasured confounding ğ‘ˆbetweenğ‘†and
ğ‘Œ:
ğ‘†=ğœ‡ğ‘†(ğ‘‡)+ğœ‹ğ‘†(ğ‘‡)ğ´+ğ›¾ğ‘ˆ+ğœ‚
ğ‘Œ=ğœ‡ğ‘Œ(ğ‘‡)+ğ‘†ğ›½+ğ›¿ğ‘ˆ+ğœ–.
Here,ğœ‹ğ‘†(ğ‘‡)is the(ğºâˆ’1)Ã—1vector of first-stage effects in ex-
perimentğ‘‡(that is, the ATEs on the ğºâˆ’1secondary metrics ğ‘†of
the intervention trialed in experiment ğ‘‡),ğœ‡ğ‘†(ğ‘‡)is a(ğºâˆ’1)Ã—1
vector of per-experiment fixed effects on ğ‘†, andğœ‡ğ‘Œ(ğ‘‡)is a scalar
per-experiment fixed effect on ğ‘Œ.
Suppose that ğ´is randomized, and that the errors are such that
ğ¸[ğœ‚|ğ‘†,ğ‘ˆ,ğ´]=0andğ¸[ğœ–|ğ‘†,ğ‘ˆ,ğ´]=0. Then the statistical
estimandsğœğ‘†(ğ‘¡)andğœğ‘Œ(ğ‘¡)identify the causal parameters ğœ‹ğ‘†(ğ‘¡)and
ğœ‹ğ‘†(ğ‘¡)ğ›½. It is straightforward to check that under the data-generating
process induced by this structural model,
ğ›½=ğœƒ1(Î›ğ¾)=ğœƒ2,Î¨(Î›ğ¾)
for any positive definite Î¨. The equality of the two statistical param-
eters can be understood as follows. Under the DGP induced by the
above structural model, in which ğ‘†fully mediates the effect of ğ´on
ğ‘Œ,ğœğ‘Œ(ğ‘¡)=ğœğ‘†(ğ‘¡)ğ›½for everyğ‘¡âˆˆ[ğ¾]. This implies that[1,âˆ’ğ›½]ğ‘‡is an
eigenvector associated with eigenvalue 0, which must be the small-
est as Î›ğ¾is positive semi-definite. Therefore, the TLS estimand is
also the OLS estimand.
Relationship to proxies. Now consider a new experiment ğ‘‡=ğ¾+1,
in which we also randomize units equiprobably between treatment
(ğ´=1) and control ( ğ´=0). Denoting ğ‘†(ğ‘¡,ğ‘),ğ‘Œ(ğ‘¡,ğ‘)the potential
outcomes generated by the structural model (that is, the random
variables obtained by setting values ğ‘‡=ğ‘¡andğ´=ğ‘and sampling
ğ‘ˆand the error terms in the above equations), the ATE on ğ‘Œis
related to the difference in arm-specific means on ğ‘†as follows:
ğ¸[ğ‘Œ(ğ¾+1,1)âˆ’ğ‘Œ(ğ¾+1,0)]
=ğ¸[ğ‘†(ğ¾+1,1)âˆ’ğ‘†(ğ¾+1,0)]ğ›½
=(ğ¸[ğ‘†|ğ‘‡=ğ¾+1,ğ´=1]âˆ’ğ¸[ğ‘†|ğ‘‡=ğ¾+1,ğ´=0])ğœƒğ‘–(Î›ğ¾),
whereğ‘–=1orğ‘–=(2,Î¨). In words, given the data-generating
distribution in ğ¾historical experiments in which we observe ğ‘Œ
andğ‘†, and the data-generating distribution in an experiment in
which we observe only the short-term outcome ğ‘†, we can estimate
the ATE on the long-term outcome. That is, â„(ğ‘†)=ğœƒğ‘–(Î›ğ¾)ğ‘†is an
unbiased surrogate index for ğ‘Œ, meaning that ATEs on â„(ğ‘†)equal
ATEs onğ‘Œ.
3.2 Linear Structural Model with
INSIDE-consistent Direct Effects
We now enrich the above linear structural model with direct effects
ğœ‹ğ‘Œ(ğ‘‡)onğ‘Œthat are not mediated by ğ‘†:
ğ‘†=ğœ‡ğ‘†(ğ‘‡)+ğœ‹ğ‘†(ğ‘‡)ğ´+ğ›¾ğ‘ˆ+ğœ‚
ğ‘Œ=ğœ‡ğ‘Œ(ğ‘‡)+ğœ‹ğ‘Œ(ğ‘‡)ğ´+ğ‘†ğ›½+ğ›¿ğ‘ˆ+ğœ–.
It is generally impossible to disentangle the direct ( ğœ‹ğ‘Œ(ğ‘‡)) and
indirect/mediated ( ğœ‹ğ‘†(ğ‘‡)ğ›½) effects. Still, it is possible to estimatemeaningful causal parameters under the assumption of INstrument
Strength Independent of Direct Effect (INSIDE) from the Mendelian
randomization literature [ 5], which states that the first-stage effects
ofğ´onğ‘†are independent of the direct effects of ğ´onğ‘Œ. In par-
ticular, INSIDE requires that the vector ğ…ğ‘Œ=[ğœ‹ğ‘Œ(1),...,ğœ‹ğ‘Œ(ğ¾)]âŠ¤
of direct effects is orthogonal to the columns of the matrix ğš·ğ‘†=
[ğœ‹ğ‘†(1)âŠ¤,...,ğœ‹ğ‘†(ğ¾)ğ‘‡]âŠ¤of first-stage effects on ğ‘†, that is, ğ…ğ‘‡
ğ‘Œğš·ğ‘†=
0.
Under the data-generating distribution induced by randomized
treatment assignment and the INSIDE-consistent causal model, the
covariance matrix Î›ğ¾of true treatment effects is
Î›ğ¾=
ğ›½ğ‘‡Î›ğ‘†ğ‘†,ğ¾ğ›½(Î›ğ‘†ğ‘†,ğ¾ğ›½)âŠ¤
Î›ğ‘†ğ‘†,ğ¾ğ›½ Î›ğ‘†ğ‘†,ğ¾
+"ğœ‹âŠ¤
ğ‘Œğœ‹ğ‘Œ
ğ¾âˆ’(ğœ‹âŠ¤
ğ‘Œ1)2
ğ¾2 0
0 0 ,#
withÎ›ğ‘†ğ‘†,ğ¾=Î âŠ¤
ğ‘†Î ğ‘†
ğ¾âˆ’1âŠ¤Î ğ‘†Î âŠ¤
ğ‘†1
ğ¾2.
As can be seen from the above matrix expression, ğœƒ1(Î›ğ¾)=ğ›½
identifies the structural parameter ğ›½. However, with direct effects,
it is no longer the case in general that [1,âˆ’ğ›½]âŠ¤is an eigenvector of
Î›ğ¾and therefore the TLS estimand ğœƒ2,Î¨(Î›ğ¾)diverges in general
fromğ›½.
ğ‘†-mediated ATE. In the presence of direct effects, it is no longer
the case that ATEs on ğ‘Œare given by ATEs on ğ‘†timesğ›½, asğ‘†
no longer mediates the effect of the treatment fully. Still, ğ›½, which
coincides with the OLS estimand ğœƒ1(Î›ğ¾), has a causal interpretation
under the linear structural model. Let us introduce the potential
outcomesğ‘†(ğ‘¡,ğ‘)andğ‘Œ(ğ‘¡,ğ‘,ğ‘ )generated by the structural model
(that is, the random variables obtained by setting ğ‘‡=ğ‘¡,ğ´=ğ‘,ğ‘†=ğ‘ 
in the above equations and independently sampling ğ‘ˆand the error
terms). It holds that the natural indirect effect on ğ‘Œthroughğ‘†is
given by
ğ¸[ğ‘Œ(ğ¾+1,ğ‘,ğ‘†(ğ¾+1,1))âˆ’ğ‘Œ(ğ¾+1,ğ‘,ğ‘†(ğ¾+1,0)]
=ğ¸[ğ‘†(ğ¾+1,1)âˆ’ğ‘†(ğ¾+1,0)]ğ›½
=(ğ¸[ğ‘†|ğ‘‡=ğ¾+1,ğ´=1]âˆ’ğ¸[ğ‘†|ğ‘‡=ğ¾+1,ğ´=0])ğœƒ1(Î›ğ¾),
for eitherğ‘âˆˆ{0,1}. That is, we can identify from the population
distribution of historical experiments a proxy â„(ğ‘†)=ğœƒ1(Î›ğ¾)ğ‘†such
that in a new experiment, the ATE on â„(ğ‘†)equals the part of the
effect of the intervention on ğ‘Œthat is mediated by ğ‘†.
3.3 Nonparametric IV Model
Relaxing the assumption of linearity, we now consider the following
nonparametric IV model:
ğ‘†=ğœ‡ğ‘†(ğ‘‡)+ğœ‹ğ‘†(ğ‘‡)ğ´+ğœ‚
ğ‘Œ=ğœ‡ğ‘Œ(ğ‘‡)+â„(ğ‘†)+ğœ–,
whereğ¸[ğœ‚|ğ´,ğ‘‡]=0andğ¸[ğœ–|ğ´,ğ‘‡]=0. We now show that,
under some assumptions, ğœƒ1identifies a functional of â„.
Assumption 1 (Small effects).âˆ¥ğœ‹ğ‘†(ğ‘¡)âˆ¥âˆâ‰¤ğœ–for everyğ‘¡âˆˆ[ğ¾]
for someğœ–>0.
We will think of ğœ–as a small quantity, which is often reasonable
in digital experiments.
Assumption 2 (Bounded Hessian). â„is twice-differentiable andâˆ‡2â„â‰¤ğ‘€for someğ‘€>0, where the norm is the nuclear norm.
 
155KDD â€™24, August 25â€“29, 2024, Barcelona, Spain AurÃ©lien Bibaut, Winston Chou, Simon Ejdemyr, and Nathan Kallus
Proposition 1. Suppose that Assumptions 1-2 hold. Then,
ğœƒ1(Î›ğ¾)= ğ¾âˆ‘ï¸
ğ‘¡=1ğœ‹ğ‘†(ğ‘¡)ğœ‹ğ‘†(ğ‘¡)âŠ¤!âˆ’1ğ¾âˆ‘ï¸
ğ‘¡=1ğœ‹ğ‘†(ğ‘¡)ğœ‹ğ‘†(ğ‘¡)âŠ¤ğ¸[âˆ‡â„(ğ‘†(ğ‘¡,0))]
+ğ‘‚(ğ‘€ğœ–),
whereğ‘†(ğ‘¡,0)is the potential outcome generated by the structural
model under the control treatment in experiment ğ‘¡.
Proof. By definition of ğœƒ1(Î›ğ¾), the randomization of ğ´, and
from a second-order Taylor expansion,
ğœƒ1(Î›ğ¾)
= ğ¾âˆ‘ï¸
ğ‘¡=1ğœğ‘†(ğ‘¡)ğœğ‘†(ğ‘¡)âŠ¤!âˆ’1ğ¾âˆ‘ï¸
ğ‘¡=1ğœ‹ğ‘†(ğ‘¡)ğ¸[â„(ğ‘†(ğ‘¡,0)+ğœ‹ğ‘†(ğ‘¡))âˆ’â„(ğ‘†(ğ‘¡,0))]
= ğ¾âˆ‘ï¸
ğ‘¡=1ğœ‹ğ‘†(ğ‘¡)ğœ‹ğ‘†(ğ‘¡)âŠ¤!âˆ’1ğ¾âˆ‘ï¸
ğ‘¡=1ğœ‹ğ‘†(ğ‘¡)ğœ‹ğ‘†(ğ‘¡)âŠ¤ğ¸[âˆ‡â„(ğ‘†(ğ‘¡,0))]
+ ğ¾âˆ‘ï¸
ğ‘¡=1ğœ‹ğ‘†(ğ‘¡)ğœ‹ğ‘†(ğ‘¡)âŠ¤!âˆ’1ğ¾âˆ‘ï¸
ğ‘¡=1ğœ‹ğ‘†(ğ‘¡)ğœ‹ğ‘†(ğ‘¡)âŠ¤ğ¸[âˆ‡2â„(eğ‘†(ğ‘¡,0))ğœğ‘†(ğ‘¡)],
for some eğ‘†(ğ‘¡,0)on the segment[ğ‘†(ğ‘¡,0),ğ‘†(ğ‘¡,0)+ğœğ‘†(ğ‘¡)]. Assump-
tions 1 and 2 then yield that the second term above is ğ‘‚(ğ‘€ğœ–).â–¡
In words, Proposition 1 above tells us that under the NPIV
model above, the OLS statistical estimand identifies an instrument-
strength-weighted average of the expected gradient of the structural
functionâ„.
4 ESTIMATING TREATMENT EFFECT
COVARIANCES
In what follows, we will concatenate the variables ğ‘†andğ‘Œin the
vectorğ·=[ğ‘Œ,ğ‘†]and also write ğœ(ğ‘¡)=[ğœğ‘Œ(ğ‘¡),ğœğ‘†(ğ‘¡)].
4.1 A Naive Estimator
A naive estimator for the covariance matrix Î›ğ¾of true treatment
effects is simply the empirical covariance matrix Ë†Î£ğ¾of the estimated
ATEsbğœğ‘†(ğ‘¡)andbğœğ‘Œ(ğ‘¡):
bÎ£ğ¾=1
ğ¾ğ¾âˆ‘ï¸
ğ‘¡=1bğœ(ğ‘¡)bğœ(ğ‘¡)âŠ¤âˆ’ 
1
ğ¾ğ¾âˆ‘ï¸
ğ‘¡=1bğœ(ğ‘¡)!  
1
ğ¾ğ¾âˆ‘ï¸
ğ‘¡=1bğœ(ğ‘¡)!âŠ¤
,
withbğœ(ğ‘¡)=1
ğ‘›/2Ã
ğ‘–=1:ğ´ğ‘–=1,ğ‘‡ğ‘–=ğ‘¡ğ·ğ‘–âˆ’1
ğ‘›/2Ã
ğ‘–=1:ğ´ğ‘–=0,ğ‘‡ğ‘–=ğ‘¡ğ·ğ‘–.
What is the target estimand of bÎ£ğ¾? The total variance formula
yields that:
ğ¸bÎ£ğ¾=Î›ğ¾+4
ğ‘›Â¯Î©ğ¾,
where
Â¯Î©ğ¾=1
ğ¾ğ¾âˆ‘ï¸
ğ‘¡=1Î©ğ‘¡,1+Î©ğ‘¡,0
2
andÎ©ğ‘¡,ğ‘=Cov(ğ·|ğ‘‡=ğ‘¡,ğ´=ğ‘)is the within-cell covariance
matrix ofğ·. In other words, 4Â¯Î©ğ¾/ğ‘›is the covariance of the unit-
level sampling variance, or â€œnoise.â€In industrial (especially digital) experimentation, ATEs typically
exhibit a low signal-to-noise ratio. This implies that the term 4Â¯Î©ğ¾/ğ‘›
is often significant relative to Î›ğ¾[7,16]. As a result, under our first
or second structural model, the estimate of ğ›½based on the empirica
l covariance matrix, bğ›½=bÎ£âˆ’1
ğ‘†ğ‘†,ğ¾bÎ£ğ‘†ğ‘Œ,ğ¾ , is biased and remains incon-
sistent forğ›½even as we increase the number of experiments (that
is, asğ¾â†’âˆ ). Since the two-stage least squares estimator under
a categorical instrument equals OLS on the group means, it holds
thatbğ›½is 2SLS with
â€¢dependent variable (2ğ´âˆ’1)ğ‘Œ,
â€¢endogenous variable (2ğ´âˆ’1)ğ‘†,
â€¢instrumentğ‘‡.
The fact that bğ›½is biased when noise is non-negligible reflects the
well-established fact that 2SLS is inconsistent under weak instru-
ments [ 2]. This suggests that insights from the weak instrumental
variable literature could improve the estimation of Î›ğ¾. In the next
sections, we will consider three different methods inspired by weak
IV estimators: (1) the Jackknife Instrumental Variable estimator
(JIVE), (2) the Limited Information Maximum Likelihood (LIML)
estimator, and (3) the general form of ğ‘˜-class estimators.
4.2 Jackknifed Covariance Matrix of Treatment
Effects
We propose an estimator of Î›ğ¾inspired by the JIVE estimator [ 2].
Consider the transformed vector eğ·=2(2ğ´âˆ’1)ğ·. Observe that
ğ¸[eğ·|ğ‘‡=ğ‘¡]=ğœ(ğ‘¡)=ğ¸[ğ·|ğ‘‡=ğ‘¡,ğ´=1]âˆ’ğ¸[ğ¸|ğ‘‡=ğ‘¡,ğ´=0].
For anyğ‘¡,ğ‘,ğ‘– , let
bğœ(ğ‘¡)=1
ğ‘›âˆ‘ï¸
ğ‘–:ğ‘‡ğ‘–=ğ‘¡eğ·ğ‘– and bğœâˆ’ğ‘–(ğ‘¡)=1
ğ‘›âˆ’1âˆ‘ï¸
ğ‘—â‰ ğ‘–
ğ‘‡ğ‘—=ğ‘¡eğ·ğ‘—
be the estimated ATE on ğ·in experiment ğ‘¡, and its counterpart
that leaves out observation ğ‘–. Let
bÎ›2(ğ‘¡)=1
ğ‘›âˆ‘ï¸
ğ‘–:ğ‘‡ğ‘–=ğ‘¡bğœâˆ’ğ‘–(ğ‘¡)eğ·âŠ¤
ğ‘–
be the Jackknifed second-order moments matrix in experiment ğ‘¡,
and let
bÎ›JK
ğ¾=1
ğ¾ğ¾âˆ‘ï¸
ğ‘¡=1bÎ›2(ğ‘¡)âˆ’ 
1
ğ¾ğ¾âˆ‘ï¸
ğ‘¡=1bğœ(ğ‘¡)!  
1
ğ¾ğ¾âˆ‘ï¸
ğ‘¡=1bğœ(ğ‘¡)!âŠ¤
be the Jackknifed covariance matrix. The Jackknife construction
ensures that only the common source of variation between units in
the same experiments is captured: the variation due to the treatment
assignment, as opposed to unit-level noise. It is immediate that the
Jackknifed second-order moment matrix is an unbiased estimate of
the second-order moment matrix of the true treatment effects. It
can also readily be checked that under mild conditions the second
order term has bias ğ‘‚(ğ‘âˆ’1); in other words, the bias scales with
the total number of units in all experiments as opposed to the
number of observations per experiment. We state this formally in
the following proposition:
Proposition 2. Suppose that maxğ‘¡,ğ‘Î©ğ‘¡,ğ‘â‰¤ğ‘€for someğ‘€>0,
where the norm is any matrix norm. Then ğ¸[bÎ›JK
ğ¾]=Î›ğ¾+ğ‘‚(ğ‘€/ğ‘).
 
156Learning the Covariance of Treatment Effects Across Many Weak Experiments KDD â€™24, August 25â€“29, 2024, Barcelona, Spain
Proof. As the second-order moment Jackknifed matrix ğ¾âˆ’1
Ãğ¾
ğ‘¡=1bÎ›2(ğ‘¡)is an unbiased estimate of ğ¾âˆ’1Ã
ğ‘¡=1ğœ(ğ‘¡)ğœ(ğ‘¡)âŠ¤, the bias
reduces to that of the second term, which we rewrite as ğ‘âˆ’1ğ‘ğ‘ğ‘âŠ¤
ğ‘,
whereğ‘ğ‘=ğ‘âˆ’1/2Ã
ğ‘–=1eğ·ğ‘–âˆ’ğ¸[eğ·ğ‘–]. The (sequence of) random
variablesğ‘ğ‘can be controlled under various set of conditions.
For example, suppose 0â‰¤ğ‘šâ‰¼Î©ğ‘¡,ğ‘â‰¼ğ‘€<âˆfor everyğ‘¡,ğ‘,
and suppose that ğ¾âˆ’1Ã
ğ‘¡Î©ğ‘¡,1+Î©ğ‘¡,0â†’Î©in probability for some
Î©. Then, under a Lyapunov condition, a standard central limit
theorem guarantees that ğ‘ğ‘â‡ğ‘whereğ‘âˆ¼ N( 0,Î©). Then
ğ¸[(ğ‘ğ‘ğ‘âŠ¤
ğ‘)]â†’ğ¸[ğ‘ğ‘âŠ¤)]â‰¼ğ‘€ğ¼ğº, which implies the result. â–¡
As a corollary, if it admits a probability limit, the plug-in estima-
torğœƒğ‘–(bÎ›JK
ğ¾)for eitherğ‘–=1orğ‘–=(2,Î¨)is a consistent estimator of
the parameter ğœƒğ‘–(Î›ğ¾)as the number of experiments grows, ğ¾â†’âˆ ,
even as the size of each experiment remains fixed. The former is
equivalent to the JIVE estimator, while the latter is equivalent to
the estimator proposed in [11].
Note that the Jackknifed covariance matrix estimator does not
require homoskedasticity of the unit-level noise â€” that is, it does
not require Î©ğ‘,ğ‘¡=Î©for allğ‘¡,ğ‘â€” for consistency. However, it
does require us to Jackknife the unit-level data in every experiment,
which can be computationally prohibitive when ğ‘›andğ¾are large.
In the next two sections, we therefore consider how we can leverage
homoskedasticity when it is a reasonable assumption.
4.3 Estimating Treatment Effect Covariances by
Isotropizing Noise
In this section and the next, we assume a common noise covariance
matrix Î©across all experiments and treatment arms, that is, Î©ğ‘¡,ğ‘=
Î©for everyğ‘¡,ğ‘. We will further assume that we know Î©to a
high relative precision. These are often reasonable assumptions in
digital experiments: while treatment effects are small, correlations
across metrics tend to be (1) stable across experiments, and (2) non-
negligible, and thus easy to estimate with a high signal-to-noise
ratio by leveraging populations across multiple experiments (e.g.,
the entire user base). Furthermore, considering metrics that are
sufficiently nonredundant ensures that Î©is well-conditioned.
Under the homoskedasticity assumption, the total covariance
formula yields that
ğ¸bÎ£ğ¾=Î›ğ¾+4
ğ‘›Î©.
Under known Î©, we can multiply bÎ£ğ¾on both sides by Î©âˆ’1/2to
obtain a transformed Î›ğ¾plus isotropic noise:
ğ¸Î©âˆ’1/2bÎ£ğ¾Î©âˆ’1/2=Î©âˆ’1/2Î›ğ¾Î©âˆ’1/2+4
ğ‘›ğ¼ğº.
Because adding a multiple of the identity to a matrix does not affect
its eigenvectors nor the rank of their corresponding eigenvalues,
the smallest eigenvector of Î©âˆ’1/2Î›ğ¾Î©âˆ’1/2is the smallest eigen-
vector ofğ¸Î©âˆ’1/2bÎ£ğ¾Î©âˆ’1/2(where by smallest eigenvector we mean
an eigenvector assoicated with the smallest eigenvalue). Denote
this eigenvector by eğ›¾ğ¾. Because Î›ğ¾andÎ©both have non-negative
eigenvalues, applying the transformation Î©âˆ’1/2also does not affect
the ordering of their eigenvectors, so we can recover the smallest
eigenvector of Î›ğ¾by applying Î©âˆ’1/2toeğ›¾ğ¾. Denote by bğ›¾ğ¾the result
of this procedure applied to the estimate bÎ£ğ¾itself (that is, ratherthan its unknown expectation), and let bğœƒğ¿ğ¼ğ‘€ğ¿ğ¾=âˆ’bğ›¾ğ¾,ğ‘†/bğ›¾ğ¾,ğ‘Œ. Un-
der the existence of the appropriate probability limits, bğœƒğ¿ğ¼ğ‘€ğ¿ğ¾is a
consistent estimate of ğœƒ2,Î©(Î›ğ¾).
As our notation suggests, bğœƒğ¿ğ¼ğ‘€ğ¿ğ¾is equal to the LIMLK (LIML
with Known noise covariance matrix) estimate with dependent
variable eğ‘Œ=2(2ğ´âˆ’1)ğ‘Œ, endogenous predictors eğ‘†=2(2ğ´âˆ’1)ğ‘†,
and instrument ğ‘‡. (This can be observed directly from the definition
of LIMLK [1].)
As the smallest eigenvector of the covariance matrix of obser-
vations is the statistical target of Total Least Squares (TLS), the
procedure we just described, and thus LIMLK, can be implemented
by: (1) transforming the observations by applying Î©âˆ’1/2, (2) run-
ning TLS in the transformed space, and (3) transforming the smallest
eigenvector obtained from TLS by applying Î©âˆ’1/2. We illustrate
this procedure visually in Section 5.
A causal inference implication of this method is that, under the
linear structural model presented in subsection 3.1, the structural
coefficientğ›½equalsğœƒ2,Î©(Î›ğ¾), which we can estimate consistently
withbğœƒğ¿ğ¼ğ‘€ğ¿ğ¾. However, under the presence of direct effects, as men-
tioned in Section 3.2, ğœƒ2,Î©(Î›ğ¾)no longer equals ğ›½, and therefore
treatment effects on ğœƒ2,Î©(Î›ğ¾)ğ‘†cannot be interpreted as the part
of the treatment effect of ğ´onğ‘Œthat is mediated by ğ‘†.
4.4 Estimating Treatment Effect Covariances by
Subtracting Noise
In the previous subsection, we leveraged only the direction of the
known Î©but not its scale, allowing us to make a connection to
LIMLK. (Note that the above procedure would give the same result
if we usedğœŒÎ©forğœŒ>0instead of Î©.) Under known Î©, there
is a perhaps more straightforward estimation procedure for Î›ğ¾:
subtract(4/ğ‘›)Î©frombÎ£ğ¾. Formally, letting bÎ›TC
ğ¾=bÎ£ğ¾âˆ’(4/ğ‘›)Î©
(where TC stands for Total Covariance), we have that
ğ¸bÎ›TC
ğ¾=Î›ğ¾,
and therefore, under the existence of the appropriate probability
limits, the plug-in estimator ğœƒğ‘–(bÎ›TC
ğ¾), for eitherğ‘–=1orğ‘–=(2,Î¨),
provides a consistent estimator for ğœƒğ‘–(Î›ğ¾). In particular, when
eitherğ‘†fully mediates the effect of ğ´onğ‘Œ(no direct effects) or when
direct effects follow the INSIDE assumption, we can consistently
estimate the structural parameter ğ›½withğœƒ1(bÎ›TC
ğ¾).
Connection with IV-estimators. Defining the matrix of centered
observations eğ·0=[eğ‘Œ0,eğ‘†0]aseğ·0=ğ·(ğ¼âˆ’ğ‘âˆ’111âŠ¤)eğ·, and using
the empirical within-experiment covariance for Î©, we can readily
check that
ğœƒ1(bÎ›TC
ğ¾)=(eğ‘†0)âŠ¤(ğ¼âˆ’(1+4/ğ‘›)ğ‘€ğ‘‡)eğ‘Œ0
(eğ‘†0)âŠ¤(ğ¼âˆ’(1+4/ğ‘›)ğ‘€ğ‘‡)eğ‘†0, (1)
withğ‘€ğ‘‡=ğ¼âˆ’ğ‘ƒğ‘‡,ğ‘ƒğ‘‡=eğ‘‡(eğ‘‡âŠ¤eğ‘‡)âˆ’1eğ‘‡âŠ¤, andeğ‘‡is theğ‘Ã—ğ¾matrix
of one-hot encodings of experiment membership ğ‘‡(that is eğ‘‡ğ‘–,ğ‘¡=
1{ğ‘‡ğ‘–=ğ‘¡}). One might recognize from (1)thatğœƒ1(bÎ›TC
ğ¾)is a so-called
ğ‘˜-class IV estimator, with ğ‘˜=1+4/ğ‘›.
5 SIMULATION STUDY
To provide insight into our statistical setup and the performance of
our estimators, we conduct a simulation study. The parameters of
 
157KDD â€™24, August 25â€“29, 2024, Barcelona, Spain AurÃ©lien Bibaut, Winston Chou, Simon Ejdemyr, and Nathan Kallus
our simulations are chosen to reflect aspects of real-world data. The
unit-level noise, denoted by Î©in our statistical setup, is typically
large relative to the variance-covariance matrix of treatment effects,
denoted by Î›ğ¾, and is also potentially anti-correlated. For example,
clicks may be positively correlated with conversions outside of
any experiment, but treatments that increase â€œclick-baitinessâ€ can
reduce conversions.
Following this example, the top panel of Figure 1 depicts a situa-
tion where treatment effects on a proxy metric ğ‘†are negatively cor-
related with treatment effects on a primary objective ğ‘Œ. Throughout
the figure, the white arrow points in the direction of the covariance
in true treatment effects. In the middle panel, we plot the unit-level
noise, which is positively correlated between ğ‘†andğ‘Œ, represented
by the black line. Lastly, in the bottom panel, we plot the sampling
distribution of treatment effect estimates with a fixed sample size.
As bottom panel of Figure 1 shows, the unit-level noise can over-
whelm the treatment effect covariance when either the treatment
effect covariance or the sample size is relatively small. As a result,
naively estimating ğœƒ1(Î›ğ¾)using the covariance matrix of the esti-
mated treatment effects ğœƒ1(bÎ£ğ¾)will be biased in the direction of
ğœƒ1(Î©). In the absence of unit-level covariance (i.e., Î©=ğœ”ğ¼), this
bias is â€œmerelyâ€ attenuation bias that preserves the direction of the
relationship but biases estimates towards zero. In the presence of
unit-level covariance, the estimated covariance can be arbitrarily
biased, and this bias is worse for small experiments [7].
5.1 LIMLK as Total Least Squares
We now consider the LIMLK estimator as an alternative to the naive
estimator based on the covariance matrix of estimated treatment
effects. As described in Section 4.3, LIMLK is equivalent to perform-
ing Total Least Squares (TLS) after applying the linear transforma-
tionÎ©âˆ’1/2to the scatterplot of estimated treatment effects. Intu-
itively, this is because applying this transformation on both sides to
bÎ£ğ¾yields, in expectation, the transformed true covariance matrix
Î©âˆ’1/2Î›ğ¾Î©âˆ’1/2plus isotropic noise â€” a classic error-in-variables
setup. TLS is an effective method for addressing error-in-variables
as isotropic noise does not change the eigenvectors of bÎ£ğ¾.
We illustrate the effects of transforming bÎ£ğ¾byÎ©âˆ’1/2on least
squares estimators in Figure 2. In both panels, the blue arrow is the
statistical parameter ğœƒ1(Î©âˆ’1/2Î›ğ¾Î©âˆ’1/2), which we call the OLS
target. This is the OLS on the transformed scatterplot of true treat-
ment effects. In contrast, the orange line is the statistical parameter
ğœƒ1(Î©âˆ’1/2ğ¸bÎ£ğ¾Î©âˆ’1/2), which we call the OLS plim. In words, this is
the OLS on the transformed scatterplot of the estimated treatment
effects asğ¾â†’âˆ . The white arrow and gray line in Figure 2 are
the analogous TLS target, ğœƒ2,Î©(Î›ğ¾), and TLS plim,ğœƒ2,Î©(ğ¸bÎ£ğ¾),
respectively. To illustrate the effect of sample size, the upper panel
setsğ‘›=100, while the bottom panel sets ğ‘›=10000.
Because transforming the scatterplot of estimated treatment
effects isotropizes but does not eliminate the noise, the OLS plim of
the transformed scatterplot will suffer from attenuation bias relative
to the OLS target, with the magnitude of this bias decreasing in
ğ‘›(evidenced by the convergence of the estimand to the target as
ğ‘›â†’âˆ ). However, isotropic noise does not change the eigenvectors
of the covariance matrix, so increasing ğ‘›does not affect the TLS
plim, which always aligns with the TLS target. This motivates the
Figure 1: How Measurement Error Distorts Treatment Ef-
fect Covariances. This figure shows a hypothetical treatment
effect covariance matrix, a unit-level sampling covariance
matrix (â€œnoiseâ€), and the covariance of matrix of estimated
treatment effects, which is a weighted combination of these.
use of TLS on the transformed scatterplot, which we show in Section
4.3is equivalent to the LIMLK estimator.
5.2 Comparing the Naive, LIMLK, and TC
Estimators
We now present the results of a simulation study of the empirical
properties of our estimators. The estimators evaluated are the naive
OLS performed on the empirical covariance matrix of estimated
effects, LIMLK, and the Total Covariance (TC) estimator, which
 
158Learning the Covariance of Treatment Effects Across Many Weak Experiments KDD â€™24, August 25â€“29, 2024, Barcelona, Spain
Figure 2: Effect of Transforming Estimated Treatment Effects
byÎ©âˆ’1/2. Transforming the covariance of estimated treat-
ment effects renders the measurement error isotropic, so the
TLS plim on this scatterplot coincides with the TLS target,
whereas the OLS plim suffers from attenuation bias.
performs OLS on the covariance matrix obtained by subtracting
(4/ğ‘›)Î©frombÎ£ğ¾.
To illustrate the effects of unit-level noise on our estimators, we
simulate two surrogates ğ‘†1andğ‘†2with corresponding structural
parameters ğ›½1andğ›½2.ğ‘†1is highly correlated with the primary
outcomeğ‘Œin terms of the noise covariance matrix Î©, whileğ‘†2is
uncorrelated with ğ‘Œ. As a result, we expect the naive estimator to
perform relatively badly for ğ‘†1(as it ignores the unit-level covari-
ance) compared to ğ‘†2and the LIMLK and TC estimators. To assess
the robustness of our estimators to direct effects, we simulate dataaccording to the linear structural models in Subsections 3.1 (no
direct effects) and 3.2 (direct effects under INSIDE).3
As Figure 3 shows, the naive estimator is heavily biased. LIMLK
and TC are substantially much more accurate than the naive esti-
mator. The relative accuracy of LIMLK and TC is more apparent for
ğ›½1, which has the greater distortion from the unit-level covariance.
Without direct effects, LIMLK is more efficient compared to TC,
with a considerably smaller standard error at smaller values of ğ‘›.
However, LIMLK is highly sensitive to the assumption of no
direct effects. As Figure 4 shows, when we introduce direct effects,
LIMLK is clearly inconsistent for ğ›½. In contrast, TC is robust and
remains consistent for ğ›½. However, note that, regardless of estimator,
theinterpretation ofğ›½is sensitive to the presence of direct effects.
Ifğ‘†fully mediates the effect of ğ´onğ‘Œ,â„(ğ‘†)=ğ›½ğ‘†is a surrogate
index, and the ATE of a new treatment on ğ‘Œis equal to the ATE
onâ„(ğ‘†). Ifğ‘†does not fully mediate the effect of ğ´onğ‘Œ, and direct
effects follow the INSIDE assumption, then ğ›½can be interpreted as
the portion of the treatment effect of ğ‘Œthat is mediated by ğ‘†.
6 LINEAR MODELS OF TREATMENT EFFECT
COVARIANCES AT NETFLIX
This section discusses the real-world application of our methods
to construct linear proxy metric indices for experimentation at
Netflix. Netflix has a sophisticated experimentation platform that
runs thousands of experiments on millions of experimental units
[10]. Still, because the signal-to-noise ratio of each experiment is
small, measurement error poses challenges. This is shown in the
top panel of Figure 5, which plots the correlation between estimated
treatment effects on one Short-term Metric and one Long-term
Metric across 96 arbitrarily-chosen treatment-control comparisons.
The Short- and Long-term Metrics are highly correlated across
experimental units, introducing correlated measurement error that
exaggerates the correlation across treatment effects. To demonstrate
the effect of experiment size on this bias, we show the scatterplot of
estimated treatment effects after downsampling each experiment to
one million units (white circles) and 15 million units (gray circles).
The slope of the OLS in the former scatterplot is about 50% larger
than the equivalent slope in the latter scatterplot. Note that we have
hidden the x- and y-axis tick marks in this figure for confidentiality
reasons.
In the bottom panel of Figure 5, we plot the absolute bias of the
observed covariance between the Short- and Long-term Metrics at
various subsample sizes, using as ground truth the TC-corrected
covariance across non-downsampled experiments. We also plot the
absolute bias of the TC-corrected covariance for comparison. The
median absolute bias reduction from applying our TC estimator is
substantial â€” approximately 63%.
In addition to these empirical benefits, our method is also well-
suited to the decentralized and rapidly-evolving practice of exper-
imentation at Netflix. Netflix runs thousands of experiments per
year on many diverse parts of the business. Each area of experimen-
tation is staffed by independent data science and engineering teams.
While every team ultimately aims to lift the same north star metrics
3Code to replicate our simulations and all figures except those in Section 6 can be
found at https://github.com/winston-chou/linear-proxy-metrics.
 
159KDD â€™24, August 25â€“29, 2024, Barcelona, Spain AurÃ©lien Bibaut, Winston Chou, Simon Ejdemyr, and Nathan Kallus
Figure 3: Comparison of Naive, LIML, and Total Covariance Estimators Without Direct Effects. When there are no direct effects,
such that the secondary outcomes fully mediate the effect of the intervention on the primary outcome, our LIMLK ( limlk ) and
Total Covariance ( tc) estimators are substantially less biased than the naive regression of the estimated ATEs on the primary
outcome on the estimated ATEs on the secondary outcomes ( naive ). LIMLK has lower variance than TC, which is most apparent
at small sample sizes.
Figure 4: Comparison of Naive, LIML, and Total Covariance Estimators With Direct Effects. When the intervention directly
affects the primary outcome, LIMLK can be extremely biased. In contrast, TC is robust to direct effects, although the causal
interpretation of its estimand changes if there are direct effects. The naive estimator is biased regardless of whether there are
direct effects or not.
 
160Learning the Covariance of Treatment Effects Across Many Weak Experiments KDD â€™24, August 25â€“29, 2024, Barcelona, Spain
Figure 5: How Our Method Improves Treatment Effect Covari-
ance Estimation at Netflix. This figure shows how correlated
measurement error exaggerates the correlation between esti-
mated treatment effects, especially at smaller sample sizes
(top), and how our TC estimator reduces this bias by subtract-
ing a scaled estimate of the measurement error (bottom).
(e.g., long-term revenue), each has also developed secondary met-
rics that are more sensitive and practical to measure in short-term
A/B tests (e.g., user engagement or latency). To complicate matters
further, teams are constantly innovating on these secondary met-
rics to find the right balance of sensitivity and impact on the north
star metrics.
In this decentralized environment, linear models of relationships
between treatment effects are a highly useful tool for coordinating
these efforts and aligning them towards the same proxies for the
north star:
(1)Managing metric tradeoffs. Because experiments in one
area can affect metrics in another area, there is a need to
measure all secondary metrics in all tests, but also to under-
stand the relative impact of these metrics on the north star.This is so we can inform decision-making when one metric
trades off against another metric.
(2)Informing metrics innovation. To minimize wasted effort
on metric development, it is also important to understand
how metrics correlate with the north star â€œnet ofâ€ existing
metrics.
(3)Enabling teams to work independently. Lastly, teams
need simple tools in order to iterate on their own metrics.
Teams may come up with dozens of variations of secondary
metrics, and slow, complicated tools for evaluating these
variations are unlikely to be adopted.
Given these needs and the availability of statistics from historical
experiments, it has been common for teams to fit linear models to
estimated treatment effects to identify promising surrogates and
estimate their weights in a linear proxy metric index. While data
scientists are aware that these models can be highly biased, linear
models have a convenience and interpretability that is difficult to
replace. Our TC estimator provides a simple way to consistently
and robustly estimate the true treatment effect covariance matrix,
which supports the construction of these linear proxies, and is
actively used to develop proxy metrics at Netflix.
7 CONCLUSION
In this paper, we discuss the construction of proxy metrics via
meta-analysis of many experiments. A useful parameter in this
setting is the covariance matrix of treatment effects across metrics
in the population of experiments. While estimating this parameter is
computationally convenient, it presents challenges, especially when
treatment effects are small relative to unit-level noise. We present
estimators for overcoming these challenges and show how their
estimands relate to structural parameters under different causal
models.
Throughout, we have assumed that the unit-level covariance
matrix is correctly specified and constant across experiments. This
assumption is often reasonable given that it can be estimated on
vastly more units than are in any individual experiment (e.g., across
the entire user base). In cases where it is not reasonable, users can
also compute Jackknife covariance matrices. That being said, this is
a computationally expensive approach, and future work can explore
more scalable ways of relaxing this assumption.
We show that LIMLK is efficient but inconsistent under direct
effects while TC is consistent under direct and indirect effects. This
suggests that it is possible to construct a statistical test for direct
effects by comparing the LIMLK and TC residuals. We also leave
this as a direction for future research.
Beyond the construction of proxy metrics, there are other op-
portunities to leverage short-term observations for inference on
long-term outcomes. For example, [ 3,6,13] consider how short-
term observations from one randomized experiment can remove
confounding in an observational study with long-term observa-
tions, and [ 14] consider efficiency gains from including units with
no long-term observations. Considering the use of many, albeit
weak, experiments as instruments in these settings may uncover
new opportunities to target long-term outcomes under weaker
assumptions.
 
161KDD â€™24, August 25â€“29, 2024, Barcelona, Spain AurÃ©lien Bibaut, Winston Chou, Simon Ejdemyr, and Nathan Kallus
REFERENCES
[1]Anderson, T., Kunitomo, N., Matsushita, Y., et al. The limited information
maximum likelihood estimator as an angle. CIRJE No. CIRJE-F-619, CIRJE, Faculty
of Economics, University of Tokyo (2009).
[2]Angrist, J. D., Imbens, G. W., and Krueger, A. B. Jackknife instrumental
variables estimation. Journal of Applied Econometrics 14, 1 (1999), 57â€“67.
[3]Athey, S., Chetty, R., and Imbens, G. Combining experimental and observa-
tional data to estimate treatment effects on long term outcomes. arXiv preprint
arXiv:2006.09676 (2020).
[4]Athey, S., Chetty, R., Imbens, G., and Kang, H. Estimating treatment effects
using multiple surrogates: The role of the surrogate score and the surrogate index.
arXiv preprint arXiv:1603.09326 (2016).
[5]Burgess, S., and Thompson, S. G. Interpreting findings from mendelian random-
ization using the mr-egger method. European journal of epidemiology 32 (2017),
377â€“389.
[6]Chen, J., and Ritzwoller, D. M. Semiparametric estimation of long-term
treatment effects. Journal of Econometrics 237, 2 (2023), 105545.
[7]Cunningham, T., and Kim, J. Interpreting experiments with multiple outcomes.
[8]Deng, A., Xu, Y., Kohavi, R., and Walker, T. Improving the sensitivity of
online controlled experiments by utilizing pre-experiment data. In Proceedings
of the sixth ACM international conference on Web search and data mining (2013),
pp. 123â€“132.
[9]Elliott, M. R., Conlon, A. S., Li, Y., Kaciroti, N., and Taylor, J. M. Surrogacy
marker paradox measures in meta-analytic settings. Biostatistics 16, 2 (2015),
400â€“412.
[10] Forsell, E., Beckley, J., Ejdemyr, S., Hannan, V., Rhines, A., Tingley, M.,
Wardrop, M., and Wong, J. Success stories from a democratized experimentation
platform. arXiv preprint arXiv:2012.10403 (2020).[11] Hahn, J., Hausman, J., and Kuersteiner, G. Estimation with weak instruments:
Accuracy of higher-order bias and mse approximations. The Econometrics Journal
7, 1 (2004), 272â€“306.
[12] Hohnhold, H., Oâ€™Brien, D., and Tang, D. Focusing on the long-term: Itâ€™s good
for users and business. In Proceedings of the 21th ACM SIGKDD International
Conference on Knowledge Discovery and Data Mining (2015), pp. 1849â€“1858.
[13] Imbens, G., Kallus, N., Mao, X., and Wang, Y. Long-term causal inference under
persistent confounding via data combination. arXiv preprint arXiv:2202.07234
(2022).
[14] Kallus, N., and Mao, X. On the role of surrogates in the efficient estimation
of treatment effects with limited outcome data. arXiv preprint arXiv:2003.12408
(2020).
[15] Mikusheva, A., and Sun, L. Inference with many weak instruments. The Review
of Economic Studies 89, 5 (2022), 2663â€“2686.
[16] Peysakhovich, A., and Eckles, D. Learning causal effects from many random-
ized experiments using regularized instrumental variables. In Proceedings of the
2018 World Wide Web Conference (2018), pp. 699â€“707.
[17] Prentice, R. L. Surrogate endpoints in clinical trials: definition and operational
criteria. Statistics in medicine 8, 4 (1989), 431â€“440.
[18] Tripuraneni, N., Richardson, L., Dâ€™Amour, A., Soriano, J., and Yadlowsky, S.
Choosing a proxy metric from past experiments. arXiv preprint arXiv:2309.07893
(2023).
[19] Wong, J., Lewis, R., and Wardrop, M. Efficient computation of linear model
treatment effects in an experimentation platform. arXiv preprint arXiv:1910.01305
(2019).
[20] Xie, H., and Aurisset, J. Improving the sensitivity of online controlled ex-
periments: Case studies at netflix. In Proceedings of the 22nd ACM SIGKDD
International Conference on Knowledge Discovery and Data Mining (2016), pp. 645â€“
654.
 
162